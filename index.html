<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Zakhir McKinnon — Backend Arcade</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link
    href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Share+Tech+Mono&family=Rajdhani:wght@300;400;600;700&display=swap"
    rel="stylesheet">
  <style>
    :root {
      --blood: #8B0000;
      --crimson: #DC143C;
      --ember: #FF4444;
      --gold: #C9A84C;
      --bone: #E8E0D0;
      --ash: #A09890;
      --void: #050505;
      --dark: #0D0D0D;
      --panel: #110A0A;
      --border: #2A1515;
      --glow: rgba(220, 20, 60, 0.4);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html,
    body {
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      width: 100%;
      height: 100%;
      background: var(--void);
      color: var(--bone);
      font-family: 'Rajdhani', sans-serif;
      overflow: hidden;
      cursor: default;
    }

    /* ═══════════════════════════════════════
   CUSTOM CURSOR
═══════════════════════════════════════ */
    .cursor {
      width: 12px;
      height: 12px;
      background: var(--crimson);
      border-radius: 50%;
      position: fixed;
      pointer-events: none;
      z-index: 9999;
      transform: translate(-50%, -50%);
      transition: transform 0.1s, width 0.2s, height 0.2s;
      mix-blend-mode: screen;
    }

    .cursor-ring {
      width: 36px;
      height: 36px;
      border: 1px solid var(--crimson);
      border-radius: 50%;
      position: fixed;
      pointer-events: none;
      z-index: 9998;
      transform: translate(-50%, -50%);
      transition: all 0.15s ease;
      opacity: 0.6;
    }

    /* ═══════════════════════════════════════
   NOISE OVERLAY
═══════════════════════════════════════ */
    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.04'/%3E%3C/svg%3E");
      pointer-events: none;
      z-index: 9997;
      opacity: 0.3;
    }

    /* ═══════════════════════════════════════
   SCREENS
═══════════════════════════════════════ */
    .screen {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: opacity 0.6s ease;
    }

    .screen.hidden {
      opacity: 0;
      pointer-events: none;
    }

    /* ═══════════════════════════════════════
   INTRO SCREEN
═══════════════════════════════════════ */
    #intro {
      flex-direction: column;
      background: radial-gradient(ellipse at center, #1a0505 0%, var(--void) 70%);
    }

    .intro-sigil {
      width: 100px;
      height: 100px;
      margin-bottom: 2rem;
      animation: sigil-pulse 3s ease-in-out infinite;
    }

    @keyframes sigil-pulse {

      0%,
      100% {
        filter: drop-shadow(0 0 8px var(--crimson));
        transform: scale(1);
      }

      50% {
        filter: drop-shadow(0 0 25px var(--crimson)) drop-shadow(0 0 50px var(--blood));
        transform: scale(1.05);
      }
    }

    .intro-name {
      font-family: 'Cinzel', serif;
      font-size: clamp(2.5rem, 6vw, 5rem);
      font-weight: 900;
      letter-spacing: 0.15em;
      color: var(--bone);
      text-shadow: 0 0 30px var(--crimson), 0 0 60px var(--blood);
      animation: name-in 1.2s ease forwards;
      opacity: 0;
      margin-bottom: 0.5rem;
    }

    .intro-title {
      font-family: 'Share Tech Mono', monospace;
      font-size: clamp(0.7rem, 1.5vw, 1rem);
      color: var(--crimson);
      letter-spacing: 0.4em;
      text-transform: uppercase;
      animation: name-in 1.2s 0.3s ease forwards;
      opacity: 0;
      margin-bottom: 3rem;
    }

    @keyframes name-in {
      from {
        opacity: 0;
        transform: translateY(20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .enter-btn {
      font-family: 'Cinzel', serif;
      font-size: 0.9rem;
      letter-spacing: 0.3em;
      color: var(--bone);
      background: transparent;
      border: 1px solid var(--crimson);
      padding: 1rem 3rem;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      animation: name-in 1.2s 0.8s ease forwards;
      opacity: 0;
      transition: color 0.3s;
    }

    .enter-btn::before {
      content: '';
      position: absolute;
      inset: 0;
      background: var(--crimson);
      transform: translateX(-100%);
      transition: transform 0.3s ease;
      z-index: -1;
    }

    .enter-btn:hover::before {
      transform: translateX(0);
    }

    .enter-btn:hover {
      color: var(--void);
    }

    .intro-scan {
      position: absolute;
      inset: -100px 0;
      background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(220, 20, 60, 0.015) 2px, rgba(220, 20, 60, 0.015) 4px);
      pointer-events: none;
      animation: scan 8s linear infinite;
    }

    @keyframes scan {
      0% {
        transform: translateY(0);
      }

      100% {
        transform: translateY(-100px);
      }
    }

    /* ═══════════════════════════════════════
   CARD SELECTION SCREEN
═══════════════════════════════════════ */
    #card-select {
      flex-direction: column;
      background: radial-gradient(ellipse at 50% 30%, #150505 0%, var(--void) 60%);
    }

    .select-header {
      text-align: center;
      margin-bottom: 4rem;
      position: relative;
      z-index: 2;
    }

    .select-header h2 {
      font-family: 'Cinzel', serif;
      font-size: clamp(1.2rem, 2.5vw, 1.8rem);
      letter-spacing: 0.25em;
      color: var(--ash);
      text-transform: uppercase;
    }

    .select-header p {
      font-family: 'Share Tech Mono', monospace;
      font-size: 0.75rem;
      color: var(--blood);
      letter-spacing: 0.2em;
      margin-top: 0.5rem;
    }

    .cards-container {
      display: flex;
      gap: 2.5rem;
      perspective: 1200px;
      position: relative;
      z-index: 2;
    }

    .realm-card {
      width: 180px;
      height: 300px;
      position: relative;
      cursor: pointer;
      transform-style: preserve-3d;
      animation: card-float var(--float-dur, 4s) var(--float-delay, 0s) ease-in-out infinite;
      transition: transform 0.3s ease;
      transform: translateZ(0);
      backface-visibility: hidden;
    }

    @keyframes card-float {

      0%,
      100% {
        transform: translateY(0) rotateY(var(--tilt, -5deg));
      }

      50% {
        transform: translateY(-15px) rotateY(calc(var(--tilt, -5deg) * -1 * 0.3));
      }
    }

    .realm-card:hover {
      animation-play-state: paused;
      transform: translateY(-25px) rotateY(0deg) scale(1.08);
      z-index: 10;
    }

    .card-inner {
      width: 100%;
      height: 100%;
      border: 1px solid var(--border);
      background: linear-gradient(160deg, #1a0808 0%, #0a0505 50%, #150a0a 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: space-between;
      padding: 1.5rem 1rem;
      position: relative;
      overflow: hidden;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.8), inset 0 0 40px rgba(139, 0, 0, 0.1);
      transition: all 0.3s ease;
    }

    .realm-card:hover .card-inner {
      border-color: var(--crimson);
      box-shadow: 0 0 40px var(--glow), 0 0 80px rgba(220, 20, 60, 0.2), inset 0 0 40px rgba(220, 20, 60, 0.08);
    }

    .card-inner::before {
      content: '';
      position: absolute;
      inset: 4px;
      border: 1px solid rgba(139, 0, 0, 0.3);
      pointer-events: none;
    }

    .card-corner {
      position: absolute;
      font-family: 'Share Tech Mono', monospace;
      font-size: 0.6rem;
      color: var(--blood);
      letter-spacing: 0.1em;
    }

    .card-corner.tl {
      top: 8px;
      left: 10px;
    }

    .card-corner.br {
      bottom: 8px;
      right: 10px;
      transform: rotate(180deg);
    }

    .card-sigil {
      font-size: 3rem;
      filter: drop-shadow(0 0 8px var(--crimson));
      transition: filter 0.3s, transform 0.3s;
    }

    .realm-card:hover .card-sigil {
      filter: drop-shadow(0 0 20px var(--crimson)) drop-shadow(0 0 40px var(--ember));
      transform: scale(1.2);
    }

    .card-name {
      font-family: 'Cinzel', serif;
      font-size: 0.75rem;
      letter-spacing: 0.2em;
      color: var(--bone);
      text-align: center;
      text-transform: uppercase;
    }

    .card-desc {
      font-size: 0.65rem;
      color: var(--ash);
      text-align: center;
      line-height: 1.6;
      letter-spacing: 0.05em;
    }

    .card-tag {
      font-family: 'Share Tech Mono', monospace;
      font-size: 0.55rem;
      color: var(--crimson);
      letter-spacing: 0.15em;
      text-transform: uppercase;
      border: 1px solid rgba(220, 20, 60, 0.3);
      padding: 0.2rem 0.5rem;
    }

    .card-lines {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 60%;
      background: repeating-linear-gradient(90deg,
          transparent 0px, transparent 8px,
          rgba(139, 0, 0, 0.08) 8px, rgba(139, 0, 0, 0.08) 9px);
      pointer-events: none;
    }

    /* Floating particles behind cards */
    .particles-bg {
      position: absolute;
      inset: 0;
      overflow: hidden;
      pointer-events: none;
    }

    .particle {
      position: absolute;
      width: 2px;
      height: 2px;
      background: var(--crimson);
      border-radius: 50%;
      animation: particle-drift var(--dur) var(--delay) linear infinite;
      opacity: 0;
    }

    @keyframes particle-drift {
      0% {
        transform: translate(var(--sx), 100vh);
        opacity: 0;
      }

      10% {
        opacity: 0.8;
      }

      90% {
        opacity: 0.4;
      }

      100% {
        transform: translate(calc(var(--sx) + var(--dx)), -100px);
        opacity: 0;
      }
    }

    /* ═══════════════════════════════════════
   WARP TUNNEL
═══════════════════════════════════════ */
    #warp-overlay {
      position: fixed;
      inset: 0;
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
      pointer-events: none;
      opacity: 0;
    }

    #warp-canvas {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
    }

    .warp-card-clone {
      position: absolute;
      width: 180px;
      height: 300px;
      border: 1px solid var(--crimson);
      background: linear-gradient(160deg, #1a0808 0%, #0a0505 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 3rem;
      box-shadow: 0 0 40px var(--crimson);
      transform-origin: center center;
      z-index: 2;
    }

    /* ═══════════════════════════════════════
   REALM SCREEN BASE
═══════════════════════════════════════ */
    .realm-screen {
      flex-direction: column;
      overflow: hidden;
      background: var(--void);
    }

    .realm-header {
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1.2rem 2rem;
      border-bottom: 1px solid var(--border);
      background: rgba(10, 0, 0, 0.9);
      backdrop-filter: blur(10px);
      flex-shrink: 0;
      z-index: 100;
      position: relative;
    }

    .realm-header-left {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .back-btn {
      font-family: 'Share Tech Mono', monospace;
      font-size: 0.7rem;
      color: var(--ash);
      background: transparent;
      border: 1px solid var(--border);
      padding: 0.4rem 0.8rem;
      cursor: pointer;
      letter-spacing: 0.1em;
      transition: all 0.2s;
    }

    .back-btn:hover {
      border-color: var(--crimson);
      color: var(--crimson);
    }

    .realm-title-bar {
      font-family: 'Cinzel', serif;
      font-size: 1rem;
      letter-spacing: 0.3em;
      color: var(--bone);
    }

    .xp-bar-container {
      display: flex;
      align-items: center;
      gap: 0.8rem;
    }

    .xp-label {
      font-family: 'Share Tech Mono', monospace;
      font-size: 0.65rem;
      color: var(--crimson);
      letter-spacing: 0.1em;
    }

    .xp-bar {
      width: 120px;
      height: 4px;
      background: var(--border);
      position: relative;
      overflow: hidden;
    }

    .xp-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--blood), var(--crimson));
      transition: width 0.5s ease;
      will-change: width;
      box-shadow: 0 0 8px var(--crimson);
    }

    .realm-content {
      flex: 1;
      overflow: hidden;
      position: relative;
      display: flex;
    }

    /* ═══════════════════════════════════════
   SYSTEM REALM
═══════════════════════════════════════ */
    #realm-system .realm-content {
      display: grid;
      grid-template-columns: 1fr 280px;
      gap: 0;
    }

    .system-canvas-area {
      position: relative;
      overflow: hidden;
      border-right: 1px solid var(--border);
    }

    #system-canvas {
      width: 100%;
      height: 100%;
      cursor: crosshair;
    }

    .sys-toolbar {
      position: absolute;
      top: 1rem;
      left: 1rem;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      z-index: 10;
    }

    .node-btn {
      font-family: 'Share Tech Mono', monospace;
      font-size: 0.6rem;
      letter-spacing: 0.1em;
      padding: 0.5rem 0.8rem;
      background: rgba(10, 0, 0, 0.9);
      border: 1px solid var(--border);
      color: var(--ash);
      cursor: pointer;
      transition: all 0.2s;
      text-align: left;
      white-space: nowrap;
    }

    .node-btn:hover,
    .node-btn.active {
      border-color: var(--crimson);
      color: var(--crimson);
      background: rgba(139, 0, 0, 0.15);
    }

    .system-panel {
      padding: 1.5rem;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 1.2rem;
    }

    .panel-section h3 {
      font-family: 'Cinzel', serif;
      font-size: 0.7rem;
      letter-spacing: 0.2em;
      color: var(--crimson);
      text-transform: uppercase;
      margin-bottom: 0.8rem;
      padding-bottom: 0.4rem;
      border-bottom: 1px solid var(--border);
    }

    .metric {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }

    .metric-name {
      font-family: 'Share Tech Mono', monospace;
      font-size: 0.65rem;
      color: var(--ash);
      letter-spacing: 0.05em;
    }

    .metric-value {
      font-family: 'Share Tech Mono', monospace;
      font-size: 0.75rem;
      color: var(--bone);
      font-weight: bold;
    }

    .metric-value.warn {
      color: #ff8c00;
    }

    .metric-value.danger {
      color: var(--crimson);
    }

    .metric-value.good {
      color: #00cc66;
    }

    .metric-bar {
      width: 100%;
      height: 3px;
      background: var(--border);
      margin-top: 0.2rem;
      margin-bottom: 0.6rem;
    }

    .metric-bar-fill {
      height: 100%;
      transition: width 0.5s ease, background 0.3s;
    }

    .traffic-control {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .traffic-slider {
      width: 100%;
      -webkit-appearance: none;
      height: 4px;
      background: var(--border);
      outline: none;
      cursor: pointer;
    }

    .traffic-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 14px;
      height: 14px;
      background: var(--crimson);
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 0 8px var(--crimson);
    }

    .event-log {
      font-family: 'Share Tech Mono', monospace;
      font-size: 0.6rem;
      color: var(--ash);
      line-height: 1.8;
      max-height: 120px;
      overflow-y: auto;
    }

    .event-log .log-entry {
      margin-bottom: 0.2rem;
    }

    .event-log .log-entry.warn {
      color: #ff8c00;
    }

    .event-log .log-entry.danger {
      color: var(--crimson);
    }

    .event-log .log-entry.good {
      color: #00cc66;
    }

    .sys-action-btn {
      font-family: 'Share Tech Mono', monospace;
      font-size: 0.65rem;
      padding: 0.5rem 1rem;
      background: transparent;
      border: 1px solid var(--crimson);
      color: var(--crimson);
      cursor: pointer;
      letter-spacing: 0.1em;
      transition: all 0.2s;
      width: 100%;
    }

    .sys-action-btn:hover {
      background: rgba(139, 0, 0, 0.2);
    }

    /* ═══════════════════════════════════════
   DATABASE DUNGEON
═══════════════════════════════════════ */
    #realm-database .realm-content {
      display: grid;
      grid-template-columns: 1fr 300px;
    }

    .db-arena {
      padding: 2rem;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
      border-right: 1px solid var(--border);
    }

    .boss-container {
      text-align: center;
    }

    .boss-name {
      font-family: 'Cinzel', serif;
      font-size: 1.5rem;
      color: var(--crimson);
      letter-spacing: 0.2em;
      text-shadow: 0 0 20px var(--crimson);
      margin-bottom: 0.5rem;
    }

    .boss-subtitle {
      font-family: 'Share Tech Mono', monospace;
      font-size: 0.7rem;
      color: var(--ash);
      letter-spacing: 0.1em;
      margin-bottom: 1rem;
    }

    .boss-hp-bar {
      width: 100%;
      height: 20px;
      background: var(--border);
      border: 1px solid var(--blood);
      position: relative;
      overflow: hidden;
    }

    .boss-hp-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--blood), var(--crimson), var(--ember));
      transition: width 1s ease;
      will-change: width;
      box-shadow: 0 0 10px var(--crimson);
    }

    .boss-hp-text {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: 'Share Tech Mono', monospace;
      font-size: 0.65rem;
      color: var(--bone);
      letter-spacing: 0.1em;
    }

    .query-display {
      background: #0a0505;
      border: 1px solid var(--border);
      padding: 1.2rem;
      font-family: 'Share Tech Mono', monospace;
      font-size: 0.75rem;
      color: #ff8c00;
      line-height: 1.8;
      position: relative;
    }

    .query-display::before {
      content: '-- QUERY BOSS';
      display: block;
      color: var(--blood);
      font-size: 0.6rem;
      margin-bottom: 0.5rem;
      letter-spacing: 0.15em;
    }

    .query-stat {
      font-family: 'Share Tech Mono', monospace;
      font-size: 0.7rem;
      color: var(--crimson);
      text-align: center;
      padding: 0.5rem;
      border: 1px solid var(--border);
      margin-top: 0.5rem;
    }

    .solution-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.8rem;
    }

    .solution-btn {
      font-family: 'Rajdhani', sans-serif;
      font-weight: 600;
      font-size: 0.8rem;
      padding: 0.8rem;
      background: rgba(10, 0, 0, 0.8);
      border: 1px solid var(--border);
      color: var(--ash);
      cursor: pointer;
      letter-spacing: 0.05em;
      transition: all 0.2s;
      text-align: left;
      position: relative;
      overflow: hidden;
    }

    .solution-btn:hover {
      border-color: var(--crimson);
      color: var(--bone);
      background: rgba(139, 0, 0, 0.15);
    }

    .solution-btn.correct {
      border-color: #00cc66;
      color: #00cc66;
      background: rgba(0, 100, 50, 0.2);
    }

    .solution-btn.wrong {
      border-color: var(--crimson);
      color: var(--crimson);
      background: rgba(139, 0, 0, 0.2);
      animation: shake 0.3s;
    }

    .solution-btn .btn-icon {
      font-size: 1.2rem;
      display: block;
      margin-bottom: 0.3rem;
    }

    .solution-btn .btn-label {
      display: block;
      font-size: 0.65rem;
      color: var(--ash);
      margin-top: 0.2rem;
    }

    @keyframes shake {

      0%,
      100% {
        transform: translateX(0);
      }

      25% {
        transform: translateX(-5px);
      }

      75% {
        transform: translateX(5px);
      }
    }

    .db-panel {
      padding: 1.5rem;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 1.2rem;
    }

    .level-indicator {
      font-family: 'Cinzel', serif;
      font-size: 0.8rem;
      letter-spacing: 0.2em;
      color: var(--gold);
      text-align: center;
    }

    .db-score {
      font-family: 'Share Tech Mono', monospace;
      font-size: 2rem;
      color: var(--bone);
      text-align: center;
    }

    .db-score-label {
      font-size: 0.6rem;
      color: var(--ash);
      text-align: center;
      letter-spacing: 0.15em;
    }

    .knowledge-tag {
      font-family: 'Share Tech Mono', monospace;
      font-size: 0.6rem;
      padding: 0.3rem 0.6rem;
      border: 1px solid rgba(220, 20, 60, 0.3);
      color: var(--crimson);
      display: inline-block;
      margin: 0.2rem;
      letter-spacing: 0.08em;
    }

    .feedback-box {
      background: #0a0505;
      border: 1px solid var(--border);
      padding: 1rem;
      font-family: 'Share Tech Mono', monospace;
      font-size: 0.65rem;
      color: var(--ash);
      line-height: 1.8;
      min-height: 80px;
    }

    /* ═══════════════════════════════════════
   ML LAB
═══════════════════════════════════════ */
    #realm-ml .realm-content {
      display: grid;
      grid-template-columns: 200px 1fr 240px;
    }

    .ml-nav {
      border-right: 1px solid var(--border);
      padding: 1.5rem 1rem;
      overflow-y: auto;
    }

    .ml-nav-item {
      display: flex;
      align-items: center;
      gap: 0.6rem;
      padding: 0.7rem 0.8rem;
      cursor: pointer;
      font-family: 'Rajdhani', sans-serif;
      font-size: 0.8rem;
      font-weight: 600;
      letter-spacing: 0.05em;
      color: var(--ash);
      border: 1px solid transparent;
      margin-bottom: 0.3rem;
      transition: all 0.2s;
    }

    .ml-nav-item:hover {
      color: var(--bone);
      border-color: var(--border);
    }

    .ml-nav-item.active {
      color: var(--crimson);
      border-color: var(--crimson);
      background: rgba(139, 0, 0, 0.1);
    }

    .ml-nav-item .nav-icon {
      font-size: 1rem;
    }

    .ml-nav-item .nav-locked {
      margin-left: auto;
      font-size: 0.6rem;
      color: var(--border);
    }

    .ml-workspace {
      padding: 2rem;
      overflow-y: auto;
      position: relative;
    }

    .ml-challenge-header {
      margin-bottom: 1.5rem;
    }

    .ml-challenge-title {
      font-family: 'Cinzel', serif;
      font-size: 1.3rem;
      color: var(--bone);
      letter-spacing: 0.15em;
      margin-bottom: 0.4rem;
    }

    .ml-challenge-subtitle {
      font-family: 'Share Tech Mono', monospace;
      font-size: 0.65rem;
      color: var(--blood);
      letter-spacing: 0.1em;
    }

    .ml-target {
      font-family: 'Share Tech Mono', monospace;
      font-size: 0.7rem;
      color: var(--gold);
      padding: 0.5rem 1rem;
      border: 1px solid rgba(201, 168, 76, 0.3);
      display: inline-block;
      margin-bottom: 1.5rem;
      letter-spacing: 0.1em;
    }

    #ml-canvas {
      width: 100%;
      height: 280px;
      border: 1px solid var(--border);
      background: #080303;
      display: block;
      margin-bottom: 1.5rem;
    }

    .algo-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
      gap: 0.6rem;
      margin-bottom: 1.5rem;
    }

    .algo-btn {
      font-family: 'Share Tech Mono', monospace;
      font-size: 0.6rem;
      padding: 0.7rem 0.5rem;
      background: rgba(10, 0, 0, 0.8);
      border: 1px solid var(--border);
      color: var(--ash);
      cursor: pointer;
      letter-spacing: 0.08em;
      text-align: center;
      transition: all 0.2s;
    }

    .algo-btn:hover {
      border-color: var(--crimson);
      color: var(--crimson);
    }

    .algo-btn.selected {
      border-color: var(--gold);
      color: var(--gold);
      background: rgba(201, 168, 76, 0.1);
    }

    .run-btn {
      font-family: 'Cinzel', serif;
      font-size: 0.8rem;
      letter-spacing: 0.2em;
      padding: 0.8rem 2rem;
      background: transparent;
      border: 1px solid var(--crimson);
      color: var(--crimson);
      cursor: pointer;
      position: relative;
      overflow: hidden;
      transition: all 0.2s;
    }

    .run-btn::before {
      content: '';
      position: absolute;
      inset: 0;
      background: var(--crimson);
      transform: scaleX(0);
      transform-origin: left;
      transition: transform 0.3s;
      z-index: -1;
    }

    .run-btn:hover::before {
      transform: scaleX(1);
    }

    .run-btn:hover {
      color: var(--void);
    }

    .accuracy-display {
      text-align: center;
      padding: 1rem;
      border: 1px solid var(--border);
      margin-top: 1rem;
    }

    .accuracy-number {
      font-family: 'Cinzel', serif;
      font-size: 2.5rem;
      color: var(--bone);
      display: block;
    }

    .accuracy-label {
      font-family: 'Share Tech Mono', monospace;
      font-size: 0.6rem;
      color: var(--ash);
      letter-spacing: 0.15em;
    }

    .ml-stats-panel {
      border-left: 1px solid var(--border);
      padding: 1.5rem;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    /* ═══════════════════════════════════════
   CHATBOT
═══════════════════════════════════════ */
    .chat-orb {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: radial-gradient(circle, var(--blood) 0%, #3a0000 100%);
      border: 1px solid var(--crimson);
      cursor: pointer;
      z-index: 500;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.4rem;
      box-shadow: 0 0 20px var(--glow);
      transition: all 0.3s;
      animation: orb-pulse 3s ease-in-out infinite;
    }

    .chat-orb:hover {
      transform: scale(1.15);
      box-shadow: 0 0 40px var(--crimson);
    }

    @keyframes orb-pulse {

      0%,
      100% {
        box-shadow: 0 0 20px var(--glow);
      }

      50% {
        box-shadow: 0 0 35px var(--crimson), 0 0 60px rgba(220, 20, 60, 0.3);
      }
    }

    #chat-panel {
      position: fixed;
      bottom: 5rem;
      right: 2rem;
      width: 360px;
      height: 480px;
      background: rgba(8, 3, 3, 0.97);
      border: 1px solid var(--crimson);
      z-index: 499;
      display: flex;
      flex-direction: column;
      transform: translateY(20px) scale(0.95);
      opacity: 0;
      pointer-events: none;
      transition: all 0.3s ease;
      box-shadow: 0 0 40px rgba(139, 0, 0, 0.4);
      backdrop-filter: blur(20px);
    }

    #chat-panel.open {
      transform: translateY(0) scale(1);
      opacity: 1;
      pointer-events: all;
    }

    .chat-header {
      padding: 1rem 1.2rem;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .chat-header-title {
      font-family: 'Cinzel', serif;
      font-size: 0.8rem;
      letter-spacing: 0.2em;
      color: var(--bone);
    }

    .chat-header-sub {
      font-family: 'Share Tech Mono', monospace;
      font-size: 0.55rem;
      color: var(--crimson);
      letter-spacing: 0.1em;
    }

    .chat-close {
      background: transparent;
      border: none;
      color: var(--ash);
      cursor: pointer;
      font-size: 1rem;
      transition: color 0.2s;
    }

    .chat-close:hover {
      color: var(--crimson);
    }

    .chat-mode-btns {
      display: flex;
      border-bottom: 1px solid var(--border);
    }

    .chat-mode-btn {
      flex: 1;
      font-family: 'Share Tech Mono', monospace;
      font-size: 0.6rem;
      padding: 0.5rem;
      background: transparent;
      border: none;
      border-right: 1px solid var(--border);
      color: var(--ash);
      cursor: pointer;
      letter-spacing: 0.05em;
      transition: all 0.2s;
    }

    .chat-mode-btn:last-child {
      border-right: none;
    }

    .chat-mode-btn.active {
      color: var(--crimson);
      background: rgba(139, 0, 0, 0.1);
    }

    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 1rem;
      display: flex;
      flex-direction: column;
      gap: 0.8rem;
      scrollbar-width: thin;
      scrollbar-color: var(--border) transparent;
    }

    .chat-msg {
      max-width: 85%;
      font-family: 'Rajdhani', sans-serif;
      font-size: 0.82rem;
      line-height: 1.5;
      padding: 0.6rem 0.8rem;
    }

    .chat-msg.user {
      align-self: flex-end;
      background: rgba(139, 0, 0, 0.25);
      border: 1px solid var(--blood);
      color: var(--bone);
    }

    .chat-msg.bot {
      align-self: flex-start;
      background: rgba(10, 5, 5, 0.9);
      border: 1px solid var(--border);
      color: var(--ash);
    }

    .chat-msg.bot.typing {
      color: var(--blood);
      font-style: italic;
    }

    .chat-input-area {
      padding: 0.8rem;
      border-top: 1px solid var(--border);
      display: flex;
      gap: 0.5rem;
    }

    .chat-input {
      flex: 1;
      background: rgba(10, 0, 0, 0.8);
      border: 1px solid var(--border);
      color: var(--bone);
      font-family: 'Rajdhani', sans-serif;
      font-size: 0.8rem;
      padding: 0.5rem 0.8rem;
      outline: none;
      transition: border-color 0.2s;
    }

    .chat-input:focus {
      border-color: var(--crimson);
    }

    .chat-send {
      font-family: 'Share Tech Mono', monospace;
      font-size: 0.6rem;
      padding: 0.5rem 0.8rem;
      background: transparent;
      border: 1px solid var(--crimson);
      color: var(--crimson);
      cursor: pointer;
      letter-spacing: 0.05em;
      transition: all 0.2s;
    }

    .chat-send:hover {
      background: rgba(139, 0, 0, 0.2);
    }

    /* ═══════════════════════════════════════
   DEVOPS REALM
═══════════════════════════════════════ */
    #realm-devops .realm-content {
      display: grid;
      grid-template-columns: 1fr 280px;
    }

    .pipeline-area {
      padding: 2rem;
      border-right: 1px solid var(--border);
      overflow-y: auto;
    }

    .pipeline-stage-pool {
      display: flex;
      gap: 0.8rem;
      flex-wrap: wrap;
      margin-bottom: 1.5rem;
    }

    .pipeline-stage {
      font-family: 'Share Tech Mono', monospace;
      font-size: 0.6rem;
      padding: 0.6rem 1rem;
      background: rgba(10, 0, 0, 0.8);
      border: 1px solid var(--border);
      color: var(--ash);
      cursor: grab;
      letter-spacing: 0.08em;
      transition: all 0.2s;
      user-select: none;
    }

    .pipeline-stage:hover {
      border-color: var(--crimson);
      color: var(--crimson);
    }

    .pipeline-stage.dragging {
      opacity: 0.5;
      cursor: grabbing;
    }

    .pipeline-track {
      min-height: 80px;
      border: 1px dashed var(--border);
      padding: 1rem;
      display: flex;
      gap: 0.8rem;
      align-items: center;
      flex-wrap: wrap;
      background: rgba(5, 0, 0, 0.5);
      margin-bottom: 1rem;
      transition: border-color 0.2s;
    }

    .pipeline-track.drag-over {
      border-color: var(--crimson);
      background: rgba(139, 0, 0, 0.05);
    }

    .pipeline-track.empty::after {
      content: 'DRAG STAGES HERE TO BUILD PIPELINE';
      font-family: 'Share Tech Mono', monospace;
      font-size: 0.6rem;
      color: var(--border);
      letter-spacing: 0.1em;
    }

    .pipeline-stage-placed {
      font-family: 'Share Tech Mono', monospace;
      font-size: 0.6rem;
      padding: 0.5rem 0.8rem;
      border: 1px solid var(--border);
      color: var(--ash);
      position: relative;
      cursor: pointer;
      transition: all 0.2s;
    }

    .pipeline-stage-placed.running {
      border-color: #ff8c00;
      color: #ff8c00;
      animation: blink 1s infinite;
    }

    .pipeline-stage-placed.passed {
      border-color: #00cc66;
      color: #00cc66;
    }

    .pipeline-stage-placed.failed {
      border-color: var(--crimson);
      color: var(--crimson);
      animation: shake 0.5s;
    }

    @keyframes blink {

      0%,
      100% {
        opacity: 1;
      }

      50% {
        opacity: 0.5;
      }
    }

    .devops-panel {
      padding: 1.5rem;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 1.2rem;
    }

    .streak-display {
      text-align: center;
      padding: 1rem;
      border: 1px solid var(--border);
    }

    .streak-number {
      font-family: 'Cinzel', serif;
      font-size: 3rem;
      color: var(--bone);
      display: block;
    }

    .streak-label {
      font-family: 'Share Tech Mono', monospace;
      font-size: 0.6rem;
      color: var(--crimson);
      letter-spacing: 0.15em;
    }

    /* ═══════════════════════════════════════
   SCROLLBARS
═══════════════════════════════════════ */
    ::-webkit-scrollbar {
      width: 4px;
    }

    ::-webkit-scrollbar-track {
      background: transparent;
    }

    ::-webkit-scrollbar-thumb {
      background: var(--border);
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--blood);
    }

    /* ═══════════════════════════════════════
   TOAST NOTIFICATIONS
═══════════════════════════════════════ */
    .toast-container {
      position: fixed;
      top: 2rem;
      right: 2rem;
      z-index: 9990;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      pointer-events: none;
    }

    .toast {
      font-family: 'Share Tech Mono', monospace;
      font-size: 0.65rem;
      padding: 0.8rem 1.2rem;
      background: rgba(8, 3, 3, 0.95);
      border-left: 3px solid var(--crimson);
      color: var(--bone);
      letter-spacing: 0.08em;
      animation: toast-in 0.3s ease;
      backdrop-filter: blur(10px);
      max-width: 300px;
    }

    .toast.success {
      border-left-color: #00cc66;
    }

    .toast.warn {
      border-left-color: #ff8c00;
    }

    @keyframes toast-in {
      from {
        transform: translateX(20px);
        opacity: 0;
      }

      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    /* ═══════════════════════════════════════
   TECH STACK BADGES
═══════════════════════════════════════ */
    .tech-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      font-family: 'Share Tech Mono', monospace;
      font-size: 0.52rem;
      letter-spacing: 0.08em;
      padding: 0.2rem 0.5rem;
      border-radius: 2px;
      font-weight: bold;
      white-space: nowrap;
    }

    .tech-badge.python {
      background: rgba(55, 118, 171, 0.2);
      border: 1px solid #3776AB;
      color: #4ea6e0;
    }

    .tech-badge.java {
      background: rgba(234, 90, 44, 0.2);
      border: 1px solid #EA5A2C;
      color: #f07050;
    }

    .tech-badge.js {
      background: rgba(247, 223, 30, 0.2);
      border: 1px solid #F7DF1E;
      color: #f7df1e;
    }

    .tech-badge.bash {
      background: rgba(80, 200, 120, 0.2);
      border: 1px solid #50C878;
      color: #50c878;
    }

    .tech-badge.sql {
      background: rgba(0, 160, 210, 0.2);
      border: 1px solid #00A0D2;
      color: #00c8ff;
    }

    .tech-badge.docker {
      background: rgba(0, 100, 220, 0.2);
      border: 1px solid #0064DC;
      color: #4488ff;
    }

    .tech-badge.sklearn {
      background: rgba(249, 130, 49, 0.2);
      border: 1px solid #F98231;
      color: #f9a060;
    }

    .tech-badge.numpy {
      background: rgba(77, 171, 207, 0.2);
      border: 1px solid #4DABCF;
      color: #4dabcf;
    }

    .tech-badge.canvas {
      background: rgba(220, 20, 60, 0.2);
      border: 1px solid #DC143C;
      color: #ff4466;
    }

    .card-tech-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.3rem;
      margin-top: 0.4rem;
    }

    /* ═══════════════════════════════════════
   CODE SNIPPET DRAWER
═══════════════════════════════════════ */
    .code-drawer {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: 0;
      background: rgba(5, 0, 0, 0.97);
      border-top: 1px solid var(--crimson);
      z-index: 400;
      transition: height 0.4s cubic-bezier(0.16, 1, 0.3, 1);
      overflow: hidden;
      backdrop-filter: blur(20px);
    }

    .code-drawer.open {
      height: 320px;
    }

    .code-drawer-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.6rem 1.5rem;
      border-bottom: 1px solid var(--border);
    }

    .code-drawer-tabs {
      display: flex;
      gap: 0;
    }

    .code-tab {
      font-family: 'Share Tech Mono', monospace;
      font-size: 0.6rem;
      padding: 0.35rem 0.9rem;
      background: transparent;
      border: 1px solid var(--border);
      border-right: none;
      color: var(--ash);
      cursor: pointer;
      letter-spacing: 0.08em;
      transition: all 0.2s;
    }

    .code-tab:last-child {
      border-right: 1px solid var(--border);
    }

    .code-tab.active {
      background: rgba(139, 0, 0, 0.2);
      color: var(--crimson);
      border-color: var(--crimson);
    }

    .code-drawer-close {
      background: none;
      border: none;
      color: var(--ash);
      cursor: pointer;
      font-size: 0.9rem;
      transition: color 0.2s;
    }

    .code-drawer-close:hover {
      color: var(--crimson);
    }

    .code-drawer-body {
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      display: flex;
      height: calc(100% - 40px);
    }

    .code-drawer-info {
      width: 260px;
      flex-shrink: 0;
      padding: 1rem 1.2rem;
      border-right: 1px solid var(--border);
      overflow-y: auto;
    }

    .code-drawer-info h4 {
      font-family: 'Cinzel', serif;
      font-size: 0.75rem;
      letter-spacing: 0.2em;
      color: var(--bone);
      margin-bottom: 0.5rem;
    }

    .code-drawer-info p {
      font-family: 'Rajdhani', sans-serif;
      font-size: 0.78rem;
      color: var(--ash);
      line-height: 1.6;
      margin-bottom: 0.8rem;
    }

    .code-drawer-info .stack-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.3rem;
      margin-bottom: 0.8rem;
    }

    .code-area {
      flex: 1;
      padding: 1rem 1.5rem;
      overflow-y: auto;
      font-family: 'Share Tech Mono', monospace;
      font-size: 0.68rem;
      line-height: 1.9;
      color: #c9c2b4;
      white-space: pre;
    }

    .code-area .kw {
      color: #cc6666;
    }

    /* keywords - crimson */
    .code-area .fn {
      color: #c9a84c;
    }

    /* functions - gold */
    .code-area .str {
      color: #80c080;
    }

    /* strings - green */
    .code-area .cm {
      color: #556055;
    }

    /* comments - muted */
    .code-area .num {
      color: #9988cc;
    }

    /* numbers - purple */
    .code-area .cls {
      color: #e8a060;
    }

    /* class names - orange */
    .code-area .dec {
      color: #4488ff;
    }

    /* decorators - blue */

    .code-trigger-btn {
      font-family: 'Share Tech Mono', monospace;
      font-size: 0.58rem;
      padding: 0.3rem 0.7rem;
      background: rgba(10, 0, 0, 0.9);
      border: 1px solid var(--border);
      color: var(--blood);
      cursor: pointer;
      letter-spacing: 0.08em;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
    }

    .code-trigger-btn:hover {
      border-color: var(--crimson);
      color: var(--crimson);
    }

    /* ═══════════════════════════════════════
   PROJECTS CARD  (5th tarot card)
═══════════════════════════════════════ */
    .project-card-outer {
      position: relative;
    }

    /* Project screen */
    #realm-projects .realm-content {
      display: flex;
      flex-direction: column;
      padding: 2rem 3rem;
      overflow-y: auto;
      gap: 2rem;
      align-items: center;
    }

    .projects-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1.5rem;
      width: 100%;
      max-width: 1100px;
    }

    .project-tile {
      background: linear-gradient(160deg, #140808 0%, #0a0505 100%);
      border: 1px solid var(--border);
      padding: 1.5rem;
      position: relative;
      overflow: hidden;
      transition: all 0.3s;
      cursor: pointer;
      transform: translateZ(0);
      backface-visibility: hidden;
    }

    .project-tile::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg, transparent, var(--crimson), transparent);
      opacity: 0;
      transition: opacity 0.3s;
    }

    .project-tile:hover {
      border-color: var(--crimson);
      transform: translateY(-4px);
      box-shadow: 0 8px 30px rgba(139, 0, 0, 0.3);
    }

    .project-tile:hover::before {
      opacity: 1;
    }

    .project-tile-num {
      font-family: 'Cinzel', serif;
      font-size: 0.6rem;
      color: var(--blood);
      letter-spacing: 0.2em;
      margin-bottom: 0.5rem;
    }

    .project-tile-name {
      font-family: 'Cinzel', serif;
      font-size: 1rem;
      color: var(--bone);
      letter-spacing: 0.1em;
      margin-bottom: 0.4rem;
    }

    .project-tile-desc {
      font-family: 'Rajdhani', sans-serif;
      font-size: 0.82rem;
      color: var(--ash);
      line-height: 1.6;
      margin-bottom: 1rem;
    }

    .project-tile-stack {
      display: flex;
      flex-wrap: wrap;
      gap: 0.3rem;
      margin-bottom: 1rem;
    }

    .project-tile-link {
      font-family: 'Share Tech Mono', monospace;
      font-size: 0.6rem;
      color: var(--crimson);
      text-decoration: none;
      letter-spacing: 0.1em;
      border-bottom: 1px solid rgba(220, 20, 60, 0.3);
      padding-bottom: 1px;
      transition: border-color 0.2s;
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
    }

    .project-tile-link:hover {
      border-color: var(--crimson);
    }

    .project-tile-highlight {
      position: absolute;
      top: 1.5rem;
      right: 1.5rem;
      font-size: 1.8rem;
      opacity: 0.15;
      transition: opacity 0.3s;
    }

    .project-tile:hover .project-tile-highlight {
      opacity: 0.35;
    }

    /* ═══════════════════════════════════════
   HIRE ME PAGE
═══════════════════════════════════════ */
    .hire-toggle {
      flex: 1;
      max-width: 280px;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 1rem 1.5rem 1.2rem;
      background: transparent;
      border: none;
      border-bottom: 3px solid transparent;
      cursor: pointer;
      gap: 0.25rem;
      transition: all 0.25s;
      position: relative;
    }

    .hire-toggle:hover {
      background: rgba(139, 0, 0, 0.06);
    }

    .hire-toggle.active {
      border-bottom-color: var(--crimson);
      background: rgba(139, 0, 0, 0.1);
    }

    .ht-icon {
      font-size: 1.4rem;
    }

    .ht-label {
      font-family: 'Cinzel', serif;
      font-size: 0.75rem;
      letter-spacing: 0.15em;
      color: var(--bone);
      text-transform: uppercase;
    }

    .ht-sub {
      font-family: 'Share Tech Mono', monospace;
      font-size: 0.55rem;
      color: var(--blood);
      letter-spacing: 0.1em;
    }

    .hire-toggle.active .ht-label {
      color: var(--crimson);
    }

    /* Hire content pieces */
    .hire-headline {
      font-family: 'Cinzel', serif;
      font-size: clamp(1.1rem, 2.5vw, 1.7rem);
      color: var(--bone);
      letter-spacing: 0.1em;
      line-height: 1.4;
      margin-bottom: 0.6rem;
    }

    .hire-subline {
      font-family: 'Rajdhani', sans-serif;
      font-size: 1rem;
      color: var(--ash);
      line-height: 1.7;
      max-width: 640px;
      margin-bottom: 2rem;
    }

    .hire-subline strong {
      color: var(--bone);
    }

    .hire-grid {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .hire-card {
      padding: 1.2rem;
      border: 1px solid var(--border);
      background: rgba(10, 3, 3, 0.7);
      transition: border-color 0.2s, transform 0.2s;
    }

    .hire-card:hover {
      border-color: var(--crimson);
      transform: translateY(-2px);
    }

    .hire-card-icon {
      font-size: 1.4rem;
      margin-bottom: 0.5rem;
    }

    .hire-card-title {
      font-family: 'Rajdhani', sans-serif;
      font-weight: 700;
      font-size: 0.85rem;
      color: var(--bone);
      letter-spacing: 0.05em;
      margin-bottom: 0.4rem;
    }

    .hire-card-body {
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      font-family: 'Share Tech Mono', monospace;
      font-size: 0.58rem;
      color: var(--ash);
      line-height: 1.7;
    }

    .hire-card-body .proof {
      color: var(--crimson);
      display: block;
      margin-top: 0.4rem;
    }

    .hire-evidence {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .evidence-item {
      display: flex;
      gap: 0.8rem;
      align-items: flex-start;
      padding: 0.8rem;
      border: 1px solid var(--border);
      background: rgba(5, 0, 0, 0.5);
    }

    .evidence-check {
      font-family: 'Share Tech Mono', monospace;
      font-size: 0.65rem;
      color: #00cc66;
      flex-shrink: 0;
      padding-top: 2px;
    }

    .evidence-text {
      font-family: 'Rajdhani', sans-serif;
      font-size: 0.82rem;
      color: var(--ash);
      line-height: 1.5;
    }

    .evidence-text strong {
      color: var(--bone);
      display: block;
      margin-bottom: 0.15rem;
    }

    .hire-cta {
      display: flex;
      gap: 1rem;
      align-items: center;
      flex-wrap: wrap;
      padding: 1.5rem 0;
      border-top: 1px solid var(--border);
    }

    .hire-cta-btn {
      font-family: 'Cinzel', serif;
      font-size: 0.75rem;
      letter-spacing: 0.2em;
      padding: 0.8rem 2rem;
      background: transparent;
      border: 1px solid var(--crimson);
      color: var(--crimson);
      cursor: pointer;
      text-decoration: none;
      display: inline-block;
      transition: all 0.2s;
      position: relative;
      overflow: hidden;
    }

    .hire-cta-btn::before {
      content: '';
      position: absolute;
      inset: 0;
      background: var(--crimson);
      transform: translateX(-100%);
      transition: transform 0.25s;
      z-index: -1;
    }

    .hire-cta-btn:hover::before {
      transform: translateX(0);
    }

    .hire-cta-btn:hover {
      color: var(--void);
    }

    .hire-cta-note {
      font-family: 'Share Tech Mono', monospace;
      font-size: 0.6rem;
      color: var(--blood);
      letter-spacing: 0.08em;
    }

    .hire-mode-tag {
      display: inline-block;
      font-family: 'Share Tech Mono', monospace;
      font-size: 0.55rem;
      padding: 0.2rem 0.6rem;
      border: 1px solid var(--crimson);
      color: var(--crimson);
      letter-spacing: 0.12em;
      margin-bottom: 1rem;
    }

    .reveal {
      opacity: 0;
      transform: translateY(30px);
      transition: all 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      will-change: opacity, transform;
    }

    .reveal.active {
      opacity: 1;
      transform: translateY(0);
    }

    .contact-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: 36px;
      background: rgba(5, 0, 0, 0.95);
      border-top: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 2.5rem;
      z-index: 300;
      backdrop-filter: blur(10px);
    }

    .contact-bar.hide {
      display: none;
    }

    .contact-link {
      display: flex;
      align-items: center;
      gap: 0.4rem;
      font-family: 'Share Tech Mono', monospace;
      font-size: 0.58rem;
      color: var(--ash);
      text-decoration: none;
      letter-spacing: 0.1em;
      transition: color 0.2s;
      transform: translateZ(0);
      backface-visibility: hidden;
    }

    .contact-link:hover {
      color: var(--crimson);
    }

    .contact-link .cl-icon {
      font-size: 0.85rem;
    }

    .select-bottom-row {
      display: flex;
      align-items: center;
      gap: 1.5rem;
      margin-top: 2.5rem;
      opacity: 0.7;
    }

    .select-bottom-link {
      display: flex;
      align-items: center;
      gap: 0.4rem;
      font-family: 'Share Tech Mono', monospace;
      font-size: 0.6rem;
      color: var(--ash);
      text-decoration: none;
      letter-spacing: 0.1em;
      transition: color 0.2s;
      border: 1px solid var(--border);
      padding: 0.4rem 0.8rem;
    }

    .select-bottom-link:hover {
      color: var(--crimson);
      border-color: var(--crimson);
    }

    /* ═══════════════════════════════════════
       MOBILE & ACCESSIBILITY OVERRIDES
    ═══════════════════════════════════════ */
    @media (max-width: 768px) {
      body {
        overflow-y: auto !important;
        overflow-x: hidden;
      }

      .cards-container {
        flex-direction: column;
        align-items: center;
        gap: 1.5rem;
      }

      .select-bottom-row {
        flex-direction: column;
      }

      .intro-name {
        font-size: 2.5rem;
      }
    }

    @media (pointer: coarse) {

      .cursor,
      .cursor-ring {
        display: none !important;
      }
    }

    :focus-visible {
      outline: 2px solid var(--crimson);
      outline-offset: 4px;
    }

    /* ═══════════════════════════════════════
       RECRUITER MODE & METRICS
    ═══════════════════════════════════════ */
    .mode-toggle-container {
      position: fixed;
      top: 1.5rem;
      right: 2.5rem;
      z-index: 10000;
      display: flex;
      gap: 0;
      border: 1px solid var(--crimson);
      background: rgba(10,0,0,0.8);
      backdrop-filter: blur(5px);
    }
    
    @media (max-width: 768px) {
      .mode-toggle-container {
        top: 0.5rem;
        right: 0.5rem;
        transform: scale(0.85);
        transform-origin: top right;
      }
    }

    .mode-btn {
      font-family: 'Share Tech Mono', monospace;
      font-size: 0.7rem;
      color: var(--ash);
      background: transparent;
      border: none;
      padding: 0.6rem 1.2rem;
      cursor: pointer;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      transition: all 0.2s;
    }
    .mode-btn.active {
      background: var(--crimson);
      color: var(--void);
      font-weight: bold;
    }
    .mode-btn:hover:not(.active) {
      background: rgba(220,20,60,0.2);
      color: var(--bone);
    }

    #recruiter-mode {
      position: fixed;
      inset: 0;
      z-index: 9500;
      background: #0a0a0a;
      overflow-y: auto;
      padding: 6rem 2rem 4rem 2rem;
      color: #e0e0e0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    }
    #recruiter-mode.hidden {
      display: none;
    }
    
    .cv-container {
      max-width: 800px;
      margin: 0 auto;
    }
    .cv-header h1 {
      font-size: clamp(2rem, 5vw, 3rem);
      margin-bottom: 0.5rem;
      color: #fff;
      font-family: 'Cinzel', serif;
      letter-spacing: 0.1em;
    }
    .cv-roles {
      font-size: 1.1rem;
      color: var(--crimson);
      margin-bottom: 1.5rem;
      font-family: 'Share Tech Mono', monospace;
      letter-spacing: 0.05em;
    }
    .cv-links {
      display: flex;
      flex-wrap: wrap;
      gap: 1.5rem;
      margin-bottom: 2rem;
      font-family: 'Share Tech Mono', monospace;
    }
    .cv-links a {
      color: #4da6ff;
      text-decoration: none;
      font-weight: 500;
      border-bottom: 1px solid transparent;
      transition: border 0.2s;
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }
    .cv-links a:hover {
      border-bottom-color: #4da6ff;
    }
    .cv-stats {
      display: flex;
      flex-direction: column;
      gap: 0.8rem;
      padding: 1.5rem;
      background: #111;
      border-left: 3px solid var(--crimson);
      font-size: 1rem;
      margin-bottom: 3rem;
      line-height: 1.5;
    }
    .cv-section {
      margin-bottom: 3rem;
    }
    .cv-section h2 {
      font-size: 1.5rem;
      border-bottom: 1px solid #333;
      padding-bottom: 0.8rem;
      margin-bottom: 1.5rem;
      color: #fff;
      font-family: 'Rajdhani', sans-serif;
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }
    .cv-job {
      margin-bottom: 2rem;
    }
    .cv-job h3 {
      font-size: 1.2rem;
      color: #fff;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 0.5rem;
    }
    .cv-job h3 span {
      font-size: 0.9rem;
      color: #888;
      font-weight: normal;
    }
    .cv-date {
      color: #aaa;
      font-size: 0.95rem;
      margin: 0.5rem 0 1rem 0;
      font-family: 'Share Tech Mono', monospace;
    }
    .cv-job ul {
      padding-left: 1.2rem;
      line-height: 1.6;
      color: #ccc;
    }
    .cv-job li {
      margin-bottom: 0.6rem;
    }
    
    .perf-metrics-overlay {
      position: fixed;
      bottom: 1rem;
      left: 1rem;
      z-index: 10000;
      background: rgba(0,0,0,0.75);
      border: 1px solid var(--border);
      padding: 0.5rem 0.8rem;
      font-family: 'Share Tech Mono', monospace;
      font-size: 0.65rem;
      color: var(--bone);
      display: flex;
      gap: 1rem;
      pointer-events: none;
      backdrop-filter: blur(3px);
    }
    .perf-item span {
      color: #00cc66;
    }
    
    @media (max-width: 768px) {
      .perf-metrics-overlay {
        bottom: 0.5rem;
        left: 0.5rem;
        flex-direction: column;
        gap: 0.3rem;
        font-size: 0.6rem;
      }
    }


    .real-project-card {
      margin-top: 0.5rem;
      margin-bottom: 1rem;
      padding: 1.2rem;
      background: rgba(139,0,0,0.05);
      border: 1px solid var(--border);
      font-family: 'Share Tech Mono', monospace;
      font-size: 0.75rem;
      color: var(--bone);
      line-height: 1.6;
      border-radius: 4px;
      transition: all 0.2s;
    }
    .real-project-card:hover {
      border-color: var(--crimson);
      background: rgba(139,0,0,0.1);
      box-shadow: 0 0 15px rgba(220,20,60,0.15);
    }
    .real-project-card .rp-tag {
      color: var(--crimson);
      font-weight: bold;
      margin-bottom: 0.5rem;
      letter-spacing: 0.05em;
    }
    .real-project-card h4 {
      font-family: 'Cinzel', serif;
      font-size: 0.9rem;
      color: #fff;
      margin-bottom: 0.5rem;
      letter-spacing: 0.1em;
    }
    .real-project-card p {
      margin-bottom: 0.25rem;
    }
    .real-project-card span {
      color: var(--ash);
      margin-right: 0.3rem;
    }

  </style>
</head>

<body>

  <!-- PERFORMANCE METRICS OVERLAY -->
  <div class="perf-metrics-overlay">
    <div class="perf-item">Page Load: <span>1.3s</span></div>
    <div class="perf-item">Lighthouse: <span>95</span></div>
    <div class="perf-item">Bundle: <span>180kb</span></div>
  </div>

  <!-- MODE TOGGLE -->
  <div class="mode-toggle-container">
    <button id="btn-arcade-mode" class="mode-btn active" onclick="setMode('arcade')">Arcade Mode</button>
    <button id="btn-rec-mode" class="mode-btn" onclick="setMode('recruiter')">Recruiter Mode</button>
  </div>

  <!-- RECRUITER MODE CONTAINER -->
  <div id="recruiter-mode" class="hidden">
    <div class="cv-container">
      <header class="cv-header">
        <h1>Zakhir Keane McKinnon</h1>
        <p class="cv-roles">Targeting: Full-Stack Developer | RPA & Automation | AI Integration | Backend Systems</p>
        
        <div class="cv-links">
          <a href="https://github.com/flyinginsectsunpig" target="_blank" rel="noopener">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg>
            GitHub
          </a>
          <a href="https://linkedin.com/in/zakhir-mckinnon-ba20ab300" target="_blank" rel="noopener">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle></svg>
            LinkedIn
          </a>
          <a href="mailto:Zakhirmckinnon2016@gmail.com" target="_blank">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
            Email
          </a>
        </div>

        <div class="cv-stats">
          <span><strong>Experience:</strong> Enterprise WIL (5 months) + Projects</span>
          <span><strong>Key Stack:</strong> Java, Python, TypeScript, SQL, C#, Azure DevOps, Blue Prism RPA</span>
        </div>
      </header>

      <section class="cv-section">
        <h2>Experience</h2>
        <div class="cv-job">
          <h3>Work Integrated Learning | COGENT <span>(Aug 2025 - Dec 2025)</span></h3>
          <p class="cv-date"><strong>Focus:</strong> Azure DevOps, RPA, Backend Integration, AI Systems</p>
          <ul>
            <li><strong>RPA & Automation:</strong> Translated business requirements into PDDs/SDDs. Built robust <strong>Blue Prism</strong> RPA solutions to automate complex workflows.</li>
            <li><strong>AI-Assisted Tools:</strong> Leveraged <strong>Copilot agents</strong> and <strong>Stubber</strong> to radically accelerate automation development and intelligent business workflows.</li>
            <li><strong>DevOps & Backend:</strong> Maintained version control workflows in <strong>Azure DevOps</strong> and implemented backend solutions in <strong>C# using ABP Framework</strong>.</li>
            <li>Rotated across Analyst, Automation, Azure DevOps, and APA teams, balancing both structural technical architecture and business needs.</li>
          </ul>
        </div>
      </section>

      <section class="cv-section">
        <h2>Featured Projects</h2>
        
        <div class="cv-job">
          <h3>PrintIt101 — 3D E-Commerce Platform</h3>
          <p class="cv-date"><strong>Stack:</strong> TypeScript, React, Three.js, Java Spring Boot</p>
          <ul>
            <li>Full-stack enterprise application allowing users to fully customize a 3D t-shirt model in real time.</li>
            <li>Maneuvered real-time 3D rendering alongside rigid backend integration (Java Spring Boot) to calculate transformation outputs.</li>
            <li>Applied Builder and Factory design patterns for robust code architecture within team Git workflows.</li>
          </ul>
        </div>

        <div class="cv-job">
          <h3>League Patch Notes Viewer & Impact Classification</h3>
          <p class="cv-date"><strong>Stack:</strong> Python, HTML/CSS, Machine Learning</p>
          <ul>
            <li>Scraped and parsed intricate official patch notes into a streamlined, high-level impact overview UI.</li>
            <li>Integrated machine learning models to classify and predict the competitive impact of buffs and nerfs across millions of instances.</li>
          </ul>
        </div>
        
        <div class="cv-job">
          <h3>Backend Arcade — Interactive Portfolio <span>(You are here)</span></h3>
          <p class="cv-date"><strong>Stack:</strong> Vanilla JS, Canvas API, HTML5/CSS3, Gemini AI</p>
          <ul>
            <li>A gamified, multi-realm interactive portfolio handling custom continuous loop logic, animation transitions, and state management.</li>
            <li>Features a context-aware <strong>Gemini Chatbot</strong>, a pipeline orchestrator showing CI/CD workflows, and playable backend theory.</li>
          </ul>
        </div>
      </section>

      <section class="cv-section">
        <h2>Education & Certifications</h2>
        <div class="cv-job">
          <h3>Diploma: ICT in Applications Development <span>(2025)</span></h3>
          <p>Cape Peninsula University of Technology</p>
          <ul style="margin-top: 5px;">
            <li><strong>Certifications:</strong> Azure Fundamentals (AZ900)</li>
            <li><strong>Completed Bootcamps:</strong> Ethereum Blockchain Developer Bootcamp with Solidity, Machine Learning A-Z (Python & R)</li>
          </ul>
        </div>
      </section>
    </div>
  </div>


  <div class="cursor" id="cursor"></div>
  <div class="cursor-ring" id="cursor-ring"></div>
  <div class="toast-container" id="toasts"></div>

  <!-- ═══════════════════════════════════════
   INTRO SCREEN
═══════════════════════════════════════ -->
  <div class="screen" id="intro">
    <div class="intro-scan"></div>
    <svg class="intro-sigil" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
      <polygon points="50,5 95,27.5 95,72.5 50,95 5,72.5 5,27.5" stroke="#DC143C" stroke-width="1" fill="none"
        opacity="0.4" />
      <polygon points="50,15 85,32.5 85,67.5 50,85 15,67.5 15,32.5" stroke="#DC143C" stroke-width="0.5" fill="none"
        opacity="0.6" />
      <line x1="50" y1="5" x2="50" y2="95" stroke="#8B0000" stroke-width="0.5" opacity="0.5" />
      <line x1="5" y1="27.5" x2="95" y2="72.5" stroke="#8B0000" stroke-width="0.5" opacity="0.5" />
      <line x1="95" y1="27.5" x2="5" y2="72.5" stroke="#8B0000" stroke-width="0.5" opacity="0.5" />
      <circle cx="50" cy="50" r="8" fill="#DC143C" opacity="0.8" />
      <circle cx="50" cy="50" r="15" stroke="#DC143C" stroke-width="0.5" fill="none" opacity="0.4" />
    </svg>
    <div class="intro-name">ZAKHIR MCKINNON</div>
    <div class="intro-title">Full-Stack Engineer · Backend Depth · Applied ML</div>
    <button class="enter-btn" aria-label="Enter Arcade"  onclick="enterArcade()">ENTER THE ARCADE</button>
  </div>

  <!-- ═══════════════════════════════════════
   CARD SELECTION SCREEN
═══════════════════════════════════════ -->
  <div class="screen hidden" id="card-select">
    <canvas id="webgl-bg"
      style="position: absolute; inset: 0; width: 100%; height: 100%; pointer-events: none; opacity: 0.6; z-index: 0;"></canvas>
    <div class="select-header">
      <h2>Choose Your Realm</h2>
      <p>SYSTEMS · BACKEND · ML · DEVOPS · PROJECTS</p>
    </div>
    <div class="cards-container" id="cards-container">

      <div class="realm-card" role="button" tabindex="0" aria-label="Enter Realm"  style="--float-dur:4.2s;--float-delay:0s;--tilt:-6deg" onclick="enterRealm('system')"
        data-sigil="⚡">
        <div class="card-inner">
          <div class="card-corner tl">I</div>
          <div class="card-corner br">I</div>
          <div class="card-lines"></div>
          <div class="card-sigil">⚡</div>
          <div>
            <div class="card-name">System Realm</div>
          </div>
          <div class="card-desc">Survive the traffic wave. Scale your infrastructure before it collapses.</div>
          <div class="card-tech-row">
            <span class="tech-badge js">JS</span>
            <span class="tech-badge canvas">Canvas API</span>
            <span class="tech-badge java">Java</span>
          </div>
          <div class="card-tag">BACKEND · SYSTEMS</div>
        </div>
      </div>

      <div class="realm-card" role="button" tabindex="0" aria-label="Enter Realm"  style="--float-dur:3.8s;--float-delay:0.5s;--tilt:4deg" onclick="enterRealm('database')"
        data-sigil="🗄">
        <div class="card-inner">
          <div class="card-corner tl">II</div>
          <div class="card-corner br">II</div>
          <div class="card-lines"></div>
          <div class="card-sigil">🗄</div>
          <div>
            <div class="card-name">DB Dungeon</div>
          </div>
          <div class="card-desc">Query boss fights. Defeat slow queries with the right optimization.</div>
          <div class="card-tech-row">
            <span class="tech-badge sql">PostgreSQL</span>
            <span class="tech-badge python">Python</span>
            <span class="tech-badge java">JDBC</span>
          </div>
          <div class="card-tag">SQL · INDEXING</div>
        </div>
      </div>

      <div class="realm-card" role="button" tabindex="0" aria-label="Enter Realm"  style="--float-dur:4.5s;--float-delay:1s;--tilt:-3deg" onclick="enterRealm('ml')"
        data-sigil="🧠">
        <div class="card-inner">
          <div class="card-corner tl">III</div>
          <div class="card-corner br">III</div>
          <div class="card-lines"></div>
          <div class="card-sigil">🧠</div>
          <div>
            <div class="card-name">ML Lab</div>
          </div>
          <div class="card-desc">Beat the target accuracy. Choose your algorithm and train to win.</div>
          <div class="card-tech-row">
            <span class="tech-badge python">Python</span>
            <span class="tech-badge sklearn">sklearn</span>
            <span class="tech-badge numpy">NumPy</span>
          </div>
          <div class="card-tag">ML · ALGORITHMS</div>
        </div>
      </div>

      <div class="realm-card" role="button" tabindex="0" aria-label="Enter Realm"  style="--float-dur:4s;--float-delay:1.5s;--tilt:7deg" onclick="enterRealm('devops')"
        data-sigil="🚀">
        <div class="card-inner">
          <div class="card-corner tl">IV</div>
          <div class="card-corner br">IV</div>
          <div class="card-lines"></div>
          <div class="card-sigil">🚀</div>
          <div>
            <div class="card-name">DevOps Arena</div>
          </div>
          <div class="card-desc">Build CI/CD pipelines without breaking production.</div>
          <div class="card-tech-row">
            <span class="tech-badge bash">Bash</span>
            <span class="tech-badge docker">Docker</span>
            <span class="tech-badge python">Python</span>
          </div>
          <div class="card-tag">DEVOPS · CICD</div>
        </div>
      </div>

      <div class="realm-card" role="button" tabindex="0" aria-label="Enter Realm"  style="--float-dur:4.3s;--float-delay:2s;--tilt:-4deg" onclick="enterRealm('projects')"
        data-sigil="📁">
        <div class="card-inner">
          <div class="card-corner tl">V</div>
          <div class="card-corner br">V</div>
          <div class="card-lines"></div>
          <div class="card-sigil">📁</div>
          <div>
            <div class="card-name">Projects</div>
          </div>
          <div class="card-desc">Real code. Real systems. Built and shipped.</div>
          <div class="card-tech-row">
            <span class="tech-badge python">Python</span>
            <span class="tech-badge java">Java</span>
            <span class="tech-badge js">JS</span>
          </div>
          <div class="card-tag">BUILT · SHIPPED</div>
        </div>
      </div>

      <div class="realm-card" role="button" tabindex="0" aria-label="Enter Realm"  style="--float-dur:3.9s;--float-delay:2.5s;--tilt:5deg" onclick="enterRealm('hire')"
        data-sigil="🎯">
        <div class="card-inner">
          <div class="card-corner tl">VI</div>
          <div class="card-corner br">VI</div>
          <div class="card-lines"></div>
          <div class="card-sigil">🎯</div>
          <div>
            <div class="card-name">Hire Me</div>
          </div>
          <div class="card-desc">See how I fit your team. Three lenses. One engineer.</div>
          <div class="card-tech-row">
            <span class="tech-badge java">Backend</span>
            <span class="tech-badge js">Full Stack</span>
            <span class="tech-badge sklearn">ML</span>
          </div>
          <div class="card-tag">RECRUIT · CONTACT</div>
        </div>
      </div>

    </div>
  </div>

  <!-- WARP OVERLAY -->
  <div id="warp-overlay">
    <canvas id="warp-canvas"></canvas>
    <div class="warp-card-clone" id="warp-card-clone"></div>
  </div>

  <!-- ═══════════════════════════════════════
   CODE SNIPPET DRAWER (global)
═══════════════════════════════════════ -->
  <div class="code-drawer" id="code-drawer">
    <div class="code-drawer-header">
      <div class="code-drawer-tabs" id="code-tabs"></div>
      <button class="code-drawer-close" onclick="closeCodeDrawer()">✕ CLOSE</button>
    </div>
    <div class="code-drawer-body">
      <div class="code-drawer-info" id="code-info"></div>
      <div class="code-area" id="code-area"></div>
    </div>
  </div>

  <!-- ═══════════════════════════════════════
   PROJECTS REALM
═══════════════════════════════════════ -->
  <div class="screen hidden realm-screen" id="realm-projects">
    <div class="realm-header">
      <div class="realm-header-left">
        <button class="back-btn" onclick="backToCards()">← REALMS</button>
        <div class="realm-title-bar">📁 PROJECTS — REAL CODE, REAL SYSTEMS</div>
      </div>
      <div style="display:flex;gap:1.2rem;align-items:center">
        <a href="https://www.linkedin.com/in/zakhir-mckinnon-ba20ab300" target="_blank" class="contact-link"
          style="font-size:0.6rem"><i data-lucide="linkedin"
            style="width:1em;height:1em;display:inline-block;vertical-align:middle;margin-right:0.2rem"></i>
          LinkedIn</a>
        <a href="mailto:zakhirmckinnon2016@gmail.com" class="contact-link" style="font-size:0.6rem"><i
            data-lucide="mail"
            style="width:1em;height:1em;display:inline-block;vertical-align:middle;margin-right:0.2rem"></i> Email</a>
        <a href="https://github.com/flyinginsectsunpig" target="_blank" class="contact-link" style="font-size:0.6rem">⌥
          GitHub</a>
      </div>
    </div>
    <div class="realm-content" style="display:block;overflow-y:auto;padding:2.5rem 3rem">

      <!-- POSITIONING STATEMENT -->
      <div class="reveal"
        style="max-width:1100px;margin:0 auto 2.5rem auto;padding:1.8rem 2rem;border:1px solid var(--border);background:linear-gradient(135deg,#0f0505 0%,#080303 100%);position:relative;overflow:hidden">
        <div
          style="position:absolute;top:0;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,var(--crimson),transparent)">
        </div>
        <div
          style="font-family:'Share Tech Mono',monospace;font-size:0.55rem;color:var(--blood);letter-spacing:0.2em;margin-bottom:0.8rem">
          // WHO I AM</div>
        <div
          style="font-family:'Cinzel',serif;font-size:clamp(0.95rem,2vw,1.3rem);color:var(--bone);letter-spacing:0.08em;line-height:1.6;margin-bottom:0.8rem">
          I build systems — the kind that handle load,<br>make intelligent decisions, and don't break in production.
        </div>
        <div
          style="font-family:'Rajdhani',sans-serif;font-size:0.9rem;color:var(--ash);line-height:1.7;max-width:700px">
          Full-stack engineer specialising in scalable backend architecture, interactive technical interfaces, and
          applied machine learning.
          My strongest lever is <span style="color:var(--bone);font-weight:600">systems thinking</span> — I approach
          every problem asking how it performs under pressure, not just whether it works.
        </div>
      </div>

      <!-- WHAT I ENJOY BUILDING -->
      <div style="max-width:1100px;margin:0 auto 2.5rem auto">
        <div
          style="font-family:'Cinzel',serif;font-size:0.75rem;letter-spacing:0.25em;color:var(--crimson);margin-bottom:1.2rem">
          WHAT I ENJOY BUILDING</div>
        <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:0.8rem">
          <div
            style="padding:1rem;border:1px solid var(--border);background:rgba(10,3,3,0.6);transition:border-color 0.2s"
            onmouseenter="this.style.borderColor='var(--crimson)'"
            onmouseleave="this.style.borderColor='var(--border)'">
            <div style="font-size:1.3rem;margin-bottom:0.5rem">⚡</div>
            <div
              style="font-family:'Rajdhani',sans-serif;font-weight:600;font-size:0.85rem;color:var(--bone);margin-bottom:0.3rem">
              High-Performance APIs</div>
            <div style="font-family:'Share Tech Mono',monospace;font-size:0.58rem;color:var(--ash);line-height:1.6">
              Systems built to handle real load — connection pools, caching layers, async queues</div>
          </div>
          <div
            style="padding:1rem;border:1px solid var(--border);background:rgba(10,3,3,0.6);transition:border-color 0.2s"
            onmouseenter="this.style.borderColor='var(--crimson)'"
            onmouseleave="this.style.borderColor='var(--border)'">
            <div style="font-size:1.3rem;margin-bottom:0.5rem">🧠</div>
            <div
              style="font-family:'Rajdhani',sans-serif;font-weight:600;font-size:0.85rem;color:var(--bone);margin-bottom:0.3rem">
              Intelligent Automation</div>
            <div style="font-family:'Share Tech Mono',monospace;font-size:0.58rem;color:var(--ash);line-height:1.6">ML
              pipelines, decision systems, models that do something useful in the real world</div>
          </div>
          <div
            style="padding:1rem;border:1px solid var(--border);background:rgba(10,3,3,0.6);transition:border-color 0.2s"
            onmouseenter="this.style.borderColor='var(--crimson)'"
            onmouseleave="this.style.borderColor='var(--border)'">
            <div style="font-size:1.3rem;margin-bottom:0.5rem">🎮</div>
            <div
              style="font-family:'Rajdhani',sans-serif;font-weight:600;font-size:0.85rem;color:var(--bone);margin-bottom:0.3rem">
              Technical Interfaces</div>
            <div style="font-family:'Share Tech Mono',monospace;font-size:0.58rem;color:var(--ash);line-height:1.6">
              Canvas engines, simulation systems, UIs where the complexity lives under the surface</div>
          </div>
          <div
            style="padding:1rem;border:1px solid var(--border);background:rgba(10,3,3,0.6);transition:border-color 0.2s"
            onmouseenter="this.style.borderColor='var(--crimson)'"
            onmouseleave="this.style.borderColor='var(--border)'">
            <div style="font-size:1.3rem;margin-bottom:0.5rem">🏗</div>
            <div
              style="font-family:'Rajdhani',sans-serif;font-weight:600;font-size:0.85rem;color:var(--bone);margin-bottom:0.3rem">
              Scalable Architecture</div>
            <div style="font-family:'Share Tech Mono',monospace;font-size:0.58rem;color:var(--ash);line-height:1.6">
              Designing for failure, horizontal scaling, systems that survive the traffic spike</div>
          </div>
          <div
            style="padding:1rem;border:1px solid var(--border);background:rgba(10,3,3,0.6);transition:border-color 0.2s"
            onmouseenter="this.style.borderColor='var(--crimson)'"
            onmouseleave="this.style.borderColor='var(--border)'">
            <div style="font-size:1.3rem;margin-bottom:0.5rem">🔧</div>
            <div
              style="font-family:'Rajdhani',sans-serif;font-weight:600;font-size:0.85rem;color:var(--bone);margin-bottom:0.3rem">
              Developer Tooling</div>
            <div style="font-family:'Share Tech Mono',monospace;font-size:0.58rem;color:var(--ash);line-height:1.6">
              Tools that make other engineers faster — pipelines, scripts, internal systems with good UX</div>
          </div>
        </div>
      </div>

      <div style="text-align:center;margin-bottom:2rem">
        <div style="font-family:'Share Tech Mono',monospace;font-size:0.65rem;color:var(--blood);letter-spacing:0.15em">
          // SELECTED WORKS — CLICK ANY CARD TO VIEW CODE</div>
      </div>
      <div class="projects-grid">

        <!-- PROJECT 1 -->
        <div class="project-tile reveal"
          onclick="window.open('https://github.com/flyinginsectsunpig/LoL-Skin-Buff-Nerf', '_blank')">
          <div class="project-tile-highlight">⚔️</div>
          <div class="project-tile-num">PROJECT · 01</div>
          <div class="project-tile-name">LoL Skin Buff/Nerf</div>
          <div class="project-tile-desc">A League of Legends tool to track and visualize the impact of Champion Skins on
            performance.</div>
          <div class="project-tile-stack">
            <span class="tech-badge python">Python</span>
            <span class="tech-badge canvas">Data Analysis</span>
          </div>
          <a href="https://github.com/flyinginsectsunpig/LoL-Skin-Buff-Nerf" target="_blank" class="project-tile-link"
            onclick="event.stopPropagation()">⌥ View on GitHub →</a>
        </div>

        <!-- PROJECT 2 -->
        <div class="project-tile reveal"
          onclick="window.open('https://github.com/flyinginsectsunpig/PrintIt101', '_blank')">
          <div class="project-tile-highlight">🖨️</div>
          <div class="project-tile-num">PROJECT · 02</div>
          <div class="project-tile-name">PrintIt101 API</div>
          <div class="project-tile-desc">Backend API service for the PrintIt101 application, handling document
            processing and user management.</div>
          <div class="project-tile-stack">
            <span class="tech-badge java">Java</span>
            <span class="tech-badge sql">SQL</span>
          </div>
          <a href="https://github.com/flyinginsectsunpig/PrintIt101" target="_blank" class="project-tile-link"
            onclick="event.stopPropagation()">⌥ View on GitHub →</a>
        </div>

        <!-- PROJECT 3 -->
        <div class="project-tile reveal"
          onclick="window.open('https://github.com/flyinginsectsunpig/printit101client1', '_blank')">
          <div class="project-tile-highlight">💻</div>
          <div class="project-tile-num">PROJECT · 03</div>
          <div class="project-tile-name">PrintIt101 Client</div>
          <div class="project-tile-desc">Frontend client application for PrintIt101, integrating with the backend API.
          </div>
          <div class="project-tile-stack">
            <span class="tech-badge js">JS</span>
            <span class="tech-badge canvas">UI</span>
          </div>
          <a href="https://github.com/flyinginsectsunpig/printit101client1" target="_blank" class="project-tile-link"
            onclick="event.stopPropagation()">⌥ View on GitHub →</a>
        </div>

        <!-- PROJECT 4 -->
        <div class="project-tile reveal"
          onclick="window.open('https://github.com/flyinginsectsunpig/game_demo', '_blank')">
          <div class="project-tile-highlight">🎮</div>
          <div class="project-tile-num">PROJECT · 04</div>
          <div class="project-tile-name">Game Demo</div>
          <div class="project-tile-desc">An interactive game demonstration showcasing game loops, rendering, and logic.
          </div>
          <div class="project-tile-stack">
            <span class="tech-badge python">Python</span>
            <span class="tech-badge canvas">Game Engine</span>
          </div>
          <a href="https://github.com/flyinginsectsunpig/game_demo" target="_blank" class="project-tile-link"
            onclick="event.stopPropagation()">⌥ View on GitHub →</a>
        </div>

      </div>

      <div style="text-align:center;margin-top:2.5rem;">
        <a href="https://github.com/flyinginsectsunpig" target="_blank"
          style="font-family:'Cinzel',serif;font-size:0.8rem;letter-spacing:0.2em;padding:0.8rem 2rem;background:transparent;border:1px solid var(--crimson);color:var(--crimson);cursor:pointer;text-decoration:none;display:inline-block;transition:all 0.2s;position:relative;overflow:hidden;"
          onmouseenter="this.style.background='var(--crimson)';this.style.color='var(--void)'"
          onmouseleave="this.style.background='transparent';this.style.color='var(--crimson)'">
          <i data-lucide="github"
            style="width:1.2em;height:1.2em;display:inline-block;vertical-align:middle;margin-right:0.5rem"></i> VIEW
          MORE GITHUB PROJECTS <i data-lucide="github"
            style="width:1.2em;height:1.2em;display:inline-block;vertical-align:middle;margin-left:0.5rem"></i>
        </a>
      </div>

      <!-- Skills summary -->
      <div style="margin-top:3rem;padding-top:2rem;border-top:1px solid var(--border)">
        <div
          style="font-family:'Cinzel',serif;font-size:0.8rem;letter-spacing:0.25em;color:var(--crimson);margin-bottom:1.5rem;text-align:center">
          LANGUAGES & TOOLS</div>
        <div style="display:flex;flex-wrap:wrap;gap:0.6rem;justify-content:center;max-width:800px;margin:0 auto">
          <span class="tech-badge python">🐍 Python</span>
          <span class="tech-badge java">☕ Java</span>
          <span class="tech-badge js">⚡ JavaScript</span>
          <span class="tech-badge sql">🗄 PostgreSQL / SQL</span>
          <span class="tech-badge docker">🐳 Docker</span>
          <span class="tech-badge bash">💻 Bash / Linux</span>
          <span class="tech-badge sklearn">🤖 scikit-learn</span>
          <span class="tech-badge numpy">📊 NumPy / Pandas</span>
          <span class="tech-badge canvas">🎨 Canvas API</span>
        </div>
      </div>

    </div>
  </div>

  <!-- ═══════════════════════════════════════
   HIRE ME REALM
═══════════════════════════════════════ -->
  <div class="screen hidden realm-screen" id="realm-hire">
    <div class="realm-header">
      <div class="realm-header-left">
        <button class="back-btn" onclick="backToCards()">← REALMS</button>
        <div class="realm-title-bar">🎯 HIRE ME — THREE LENSES, ONE ENGINEER</div>
      </div>
      <div style="display:flex;gap:1.2rem;align-items:center">
        <a href="https://www.linkedin.com/in/zakhir-mckinnon-ba20ab300" target="_blank" class="contact-link">💼
          LinkedIn</a>
        <a href="mailto:zakhirmckinnon2016@gmail.com" class="contact-link"><i data-lucide="mail"
            style="width:1em;height:1em;display:inline-block;vertical-align:middle;margin-right:0.2rem"></i>
          zakhirmckinnon2016@gmail.com</a>
        <a href="https://github.com/flyinginsectsunpig" target="_blank" class="contact-link"><i data-lucide="github"
            style="width:1em;height:1em;display:inline-block;vertical-align:middle;margin-right:0.2rem"></i> GitHub</a>
      </div>
    </div>
    <div class="realm-content" style="display:block;overflow-y:auto">

      <!-- ROLE TOGGLES -->
      <div id="hire-toggle-bar"
        style="display:flex;justify-content:center;gap:0;padding:1.5rem 2rem 0;border-bottom:1px solid var(--border);background:rgba(5,0,0,0.6)">
        <button class="hire-toggle active" id="toggle-backend" onclick="setHireMode('backend')">
          <span class="ht-icon"><i data-lucide="settings"></i></span>
          <span class="ht-label">Backend Engineer</span>
          <span class="ht-sub">APIs · Databases · Scale</span>
        </button>
        <button class="hire-toggle" id="toggle-fullstack" onclick="setHireMode('fullstack')">
          <span class="ht-icon"><i data-lucide="zap"></i></span>
          <span class="ht-label">Full Stack Engineer</span>
          <span class="ht-sub">End-to-End · Systems · UI</span>
        </button>
        <button class="hire-toggle" id="toggle-ml" onclick="setHireMode('ml')">
          <span class="ht-icon"><i data-lucide="brain"></i></span>
          <span class="ht-label">ML Engineer</span>
          <span class="ht-sub">Models · Pipelines · Data</span>
        </button>
      </div>

      <!-- DYNAMIC CONTENT AREA -->
      <div id="hire-content" style="padding:2rem 3rem;max-width:1200px;margin:0 auto"></div>

    </div>
  </div>

  <!-- ═══════════════════════════════════════
   SYSTEM REALM
═══════════════════════════════════════ -->
  <div class="screen hidden realm-screen" id="realm-system">
    <div class="realm-header">
      <div class="realm-header-left">
        <button class="back-btn" onclick="backToCards()">← REALMS</button>
        <div class="realm-title-bar">⚡ SYSTEM REALM — SURVIVE THE TRAFFIC</div>
        <button class="code-trigger-btn" onclick="openCodeDrawer('system')">⌥ VIEW CODE</button>
      </div>
      <div class="xp-bar-container">
        <span class="xp-label">XP</span>
        <div class="xp-bar">
          <div class="xp-fill" id="sys-xp-fill" style="width:0%"></div>
        </div>
        <span class="xp-label" id="sys-xp-val">0</span>
      </div>
    </div>
    <div class="realm-content">
      <div class="system-canvas-area">
        <div class="sys-toolbar">
          <div
            style="font-family:'Share Tech Mono',monospace;font-size:0.55rem;color:var(--blood);letter-spacing:0.1em;margin-bottom:0.3rem">
            PLACE NODE →</div>
          <button class="node-btn" onclick="selectNode('load-balancer')" id="btn-load-balancer">⚖ LOAD BALANCER</button>
          <button class="node-btn" onclick="selectNode('api-server')" id="btn-api-server">🖥 API SERVER</button>
          <button class="node-btn" onclick="selectNode('cache')" id="btn-cache">⚡ CACHE</button>
          <button class="node-btn" onclick="selectNode('database')" id="btn-database-node">🗄 DATABASE</button>
          <button class="node-btn" onclick="selectNode('queue')" id="btn-queue">📬 QUEUE</button>
          <button class="node-btn" onclick="selectNode('replica')" id="btn-replica">📋 REPLICA</button>
          <div style="height:0.5rem"></div>
          <button class="node-btn" onclick="clearConnecting()" id="btn-connect"
            style="color:var(--gold);border-color:rgba(201,168,76,0.4)">🔗 CONNECT [C]</button>
          <button class="node-btn" onclick="clearNodes()" style="color:var(--ash)">🗑 CLEAR ALL</button>
        </div>
        <canvas id="system-canvas"></canvas>
      </div>
      <div class="system-panel">
        <div class="panel-section">
          <h3>Traffic Wave</h3>
          <div class="traffic-control">
            <div style="display:flex;justify-content:space-between">
              <span class="metric-name">REQUESTS/S</span>
              <span class="metric-value" id="traffic-rps">0</span>
            </div>
            <input type="range" class="traffic-slider" id="traffic-slider" min="0" max="100" value="0"
              oninput="updateTraffic(this.value)">
            <div
              style="font-family:'Share Tech Mono',monospace;font-size:0.55rem;color:var(--blood);letter-spacing:0.05em"
              id="traffic-label">IDLE</div>
          </div>
        </div>
        <div class="panel-section">
          <h3>System Metrics</h3>
          <div class="metric"><span class="metric-name">LATENCY</span><span class="metric-value" id="m-latency">—</span>
          </div>
          <div class="metric-bar">
            <div class="metric-bar-fill" id="b-latency" style="width:0%;background:var(--crimson)"></div>
          </div>
          <div class="metric"><span class="metric-name">ERROR RATE</span><span class="metric-value"
              id="m-error">—</span></div>
          <div class="metric-bar">
            <div class="metric-bar-fill" id="b-error" style="width:0%;background:var(--crimson)"></div>
          </div>
          <div class="metric"><span class="metric-name">THROUGHPUT</span><span class="metric-value"
              id="m-throughput">—</span></div>
          <div class="metric-bar">
            <div class="metric-bar-fill" id="b-throughput" style="width:0%;background:#00cc66"></div>
          </div>
          <div class="metric"><span class="metric-name">CACHE HIT</span><span class="metric-value" id="m-cache">—</span>
          </div>
          <div class="metric-bar">
            <div class="metric-bar-fill" id="b-cache" style="width:0%;background:#00cc66"></div>
          </div>
          <div class="metric"><span class="metric-name">QUEUE DEPTH</span><span class="metric-value"
              id="m-queue">—</span></div>
          <div class="metric"><span class="metric-name">CPU LOAD</span><span class="metric-value" id="m-cpu">—</span>
          </div>
        </div>
        <div class="panel-section">
          <h3>Simulate Event</h3>
          <button class="sys-action-btn" onclick="triggerEvent('spike')">💥 FLASH SALE SPIKE</button>
          <br><br>
          <button class="sys-action-btn" onclick="triggerEvent('crash')">💀 WORKER CRASH</button>
          <br><br>
          <button class="sys-action-btn" onclick="triggerEvent('cache-miss')">⚡ CACHE MISS STORM</button>
        </div>
        <div class="panel-section">
          <h3>Event Log</h3>
          <div class="event-log" id="event-log">
            <div class="log-entry">// system ready</div>
            <div class="log-entry">// place nodes to begin</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ═══════════════════════════════════════
   DATABASE DUNGEON
═══════════════════════════════════════ -->
  <div class="screen hidden realm-screen" id="realm-database">
    <div class="realm-header">
      <div class="realm-header-left">
        <button class="back-btn" onclick="backToCards()">← REALMS</button>
        <div class="realm-title-bar">🗄 DATABASE DUNGEON — QUERY BOSS FIGHTS</div>
        <button class="code-trigger-btn" onclick="openCodeDrawer('database')">⌥ VIEW CODE</button>
      </div>
      <div class="xp-bar-container">
        <span class="xp-label">XP</span>
        <div class="xp-bar">
          <div class="xp-fill" id="db-xp-fill" style="width:20%"></div>
        </div>
        <span class="xp-label" id="db-xp-val">20</span>
      </div>
    </div>
    <div class="realm-content">
      <div class="db-arena">
        <div class="boss-container">
          <div class="boss-name" id="boss-name">THE FULL TABLE SCAN</div>
          <div class="boss-subtitle" id="boss-subtitle">RESPONSE TIME: <span id="boss-ms"
              style="color:var(--crimson)">1200ms</span></div>
          <div class="boss-hp-bar">
            <div class="boss-hp-fill" id="boss-hp" style="width:100%"></div>
            <div class="boss-hp-text" id="boss-hp-text">1200ms</div>
          </div>
        </div>
        <div class="query-display" id="query-display">
          SELECT * FROM users WHERE email = 'user@test.com';

          -- 847,293 rows scanned
          -- No index found
          -- Query time: 1200ms
        </div>
        <div class="query-stat" id="query-stat">⚠ Sequential scan on users table (847K rows) — this scales O(n)</div>
        <div class="solution-grid" id="solution-grid">
          <!-- populated by JS -->
        </div>
      </div>
      <div class="db-panel">
        <div class="level-indicator" id="db-level">LEVEL 1 OF 5</div>
        <div>
          <div class="db-score" id="db-score">0</div>
          <div class="db-score-label">TOTAL SCORE</div>
        </div>
        <div class="panel-section">
          <h3>Concepts Mastered</h3>
          <div id="knowledge-tags">
            <span class="knowledge-tag" style="opacity:0.3">INDEXING</span>
            <span class="knowledge-tag" style="opacity:0.3">CACHING</span>
            <span class="knowledge-tag" style="opacity:0.3">NORMALIZATION</span>
            <span class="knowledge-tag" style="opacity:0.3">READ REPLICA</span>
            <span class="knowledge-tag" style="opacity:0.3">N+1 FIX</span>
            <span class="knowledge-tag" style="opacity:0.3">SHARDING</span>
          </div>
        </div>
        <div class="panel-section">
          <h3>System Feedback</h3>
          <div class="feedback-box" id="db-feedback">
            // choose a solution to defeat the boss
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ═══════════════════════════════════════
   ML LAB
═══════════════════════════════════════ -->
  <div class="screen hidden realm-screen" id="realm-ml">
    <div class="realm-header">
      <div class="realm-header-left">
        <button class="back-btn" onclick="backToCards()">← REALMS</button>
        <div class="realm-title-bar">🧠 ML LAB — BEAT THE TARGET</div>
        <button class="code-trigger-btn" onclick="openCodeDrawer('ml')">⌥ VIEW CODE</button>
      </div>
      <div class="xp-bar-container">
        <span class="xp-label">XP</span>
        <div class="xp-bar">
          <div class="xp-fill" id="ml-xp-fill" style="width:0%"></div>
        </div>
        <span class="xp-label" id="ml-xp-val">0</span>
      </div>
    </div>
    <div class="realm-content">
      <div class="ml-nav">
        <div
          style="font-family:'Share Tech Mono',monospace;font-size:0.55rem;color:var(--blood);letter-spacing:0.1em;margin-bottom:1rem">
          // MODULES</div>
        <div class="ml-nav-item active" onclick="switchML('regression')" id="nav-regression">
          <span class="nav-icon">📈</span> Regression
        </div>
        <div class="ml-nav-item" onclick="switchML('classification')" id="nav-classification">
          <span class="nav-icon">🔍</span> Classification
        </div>
        <div class="ml-nav-item" onclick="switchML('clustering')" id="nav-clustering">
          <span class="nav-icon">🔵</span> Clustering
        </div>
        <div class="ml-nav-item" onclick="switchML('rl')" id="nav-rl">
          <span class="nav-icon">🎰</span> Reinforcement
        </div>
        <div class="ml-nav-item" onclick="switchML('nn')" id="nav-nn">
          <span class="nav-icon">🧬</span> Neural Net
        </div>
      </div>
      <div class="ml-workspace">
        <div class="ml-challenge-header">
          <div class="ml-challenge-title" id="ml-title">Regression Arena</div>
          <div class="ml-challenge-subtitle" id="ml-subtitle">// Predict house prices. Minimize RMSE.</div>
        </div>
        <div class="ml-target" id="ml-target">🎯 TARGET: R² > 0.85 to unlock next module</div>
        <canvas id="ml-canvas"></canvas>
        <div class="algo-grid" id="algo-grid"></div>
        <div style="display:flex;gap:1rem;align-items:center">
          <button class="run-btn" onclick="runML()">▶ RUN ALGORITHM</button>
          <div id="ml-run-status" style="font-family:'Share Tech Mono',monospace;font-size:0.65rem;color:var(--ash)">
          </div>
        </div>
        <div class="accuracy-display" id="accuracy-display" style="display:none">
          <span class="accuracy-number" id="accuracy-number">—</span>
          <span class="accuracy-label" id="accuracy-label">R² SCORE</span>
        </div>
      </div>
      <div class="ml-stats-panel">
        <div class="panel-section">
          <h3>Model Stats</h3>
          <div class="metric"><span class="metric-name">TRAIN ACC</span><span class="metric-value"
              id="ml-train">—</span></div>
          <div class="metric"><span class="metric-name">TEST ACC</span><span class="metric-value" id="ml-test">—</span>
          </div>
          <div class="metric"><span class="metric-name">OVERFIT</span><span class="metric-value"
              id="ml-overfit">—</span></div>
          <div class="metric"><span class="metric-name">BIAS</span><span class="metric-value" id="ml-bias">—</span>
          </div>
          <div class="metric"><span class="metric-name">VARIANCE</span><span class="metric-value" id="ml-var">—</span>
          </div>
        </div>
        <div class="panel-section">
          <h3>Insight</h3>
          <div class="feedback-box" id="ml-insight" style="min-height:100px">
            // select an algorithm and run to see analysis
          </div>
        </div>
        <div class="panel-section">
          <h3>Modules Cleared</h3>
          <div id="ml-cleared">
            <div style="font-family:'Share Tech Mono',monospace;font-size:0.6rem;color:var(--border)">// none yet</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ═══════════════════════════════════════
   DEVOPS ARENA
═══════════════════════════════════════ -->
  <div class="screen hidden realm-screen" id="realm-devops">
    <div class="realm-header">
      <div class="realm-header-left">
        <button class="back-btn" onclick="backToCards()">← REALMS</button>
        <div class="realm-title-bar">🚀 DEVOPS ARENA — DEPLOY WITHOUT BREAKING PROD</div>
        <button class="code-trigger-btn" onclick="openCodeDrawer('devops')">⌥ VIEW CODE</button>
      </div>
      <div class="xp-bar-container">
        <span class="xp-label">XP</span>
        <div class="xp-bar">
          <div class="xp-fill" id="devops-xp-fill" style="width:0%"></div>
        </div>
        <span class="xp-label" id="devops-xp-val">0</span>
      </div>
    </div>
    <div class="realm-content">
      <div class="pipeline-area">
        <div style="margin-bottom:1rem">
          <div
            style="font-family:'Cinzel',serif;font-size:1rem;letter-spacing:0.2em;color:var(--bone);margin-bottom:0.3rem">
            Build Your Pipeline</div>
          <div style="font-family:'Share Tech Mono',monospace;font-size:0.65rem;color:var(--blood)">// drag stages into
            the pipeline track below, then commit</div>
        </div>
        <div class="pipeline-stage-pool" id="stage-pool">
          <div class="pipeline-stage" draggable="true" data-stage="source">📁 SOURCE CHECKOUT</div>
          <div class="pipeline-stage" draggable="true" data-stage="lint">🔍 LINT</div>
          <div class="pipeline-stage" draggable="true" data-stage="unit-test">🧪 UNIT TESTS</div>
          <div class="pipeline-stage" draggable="true" data-stage="integration">🔗 INTEGRATION TEST</div>
          <div class="pipeline-stage" draggable="true" data-stage="security">🔐 SECURITY SCAN</div>
          <div class="pipeline-stage" draggable="true" data-stage="build">🏗 BUILD</div>
          <div class="pipeline-stage" draggable="true" data-stage="docker">🐳 DOCKERIZE</div>
          <div class="pipeline-stage" draggable="true" data-stage="staging">🌐 DEPLOY STAGING</div>
          <div class="pipeline-stage" draggable="true" data-stage="canary">🐦 CANARY DEPLOY</div>
          <div class="pipeline-stage" draggable="true" data-stage="prod">🚀 DEPLOY PROD</div>
          <div class="pipeline-stage" draggable="true" data-stage="monitor">📊 MONITOR</div>
        </div>
        <div
          style="font-family:'Share Tech Mono',monospace;font-size:0.6rem;color:var(--ash);margin-bottom:0.5rem;letter-spacing:0.1em">
          ▸ PIPELINE TRACK</div>
        <div class="pipeline-track" id="pipeline-track"></div>
        <div style="display:flex;gap:1rem;margin-top:1rem">
          <button class="run-btn" onclick="runPipeline()">▶ COMMIT & TRIGGER</button>
          <button class="run-btn" onclick="clearPipeline()"
            style="border-color:var(--border);color:var(--ash)">CLEAR</button>
        </div>
        <div id="pipeline-result" style="margin-top:1.5rem"></div>
      </div>
      <div class="devops-panel">
        <div class="streak-display">
          <span class="streak-number" id="deploy-streak">0</span>
          <span class="streak-label">STABLE DEPLOYS</span>
        </div>
        <div class="panel-section">
          <h3>DORA Metrics</h3>
          <div class="metric"><span class="metric-name">DEPLOY FREQ</span><span class="metric-value"
              id="dv-freq">—</span></div>
          <div class="metric"><span class="metric-name">LEAD TIME</span><span class="metric-value" id="dv-lead">—</span>
          </div>
          <div class="metric"><span class="metric-name">FAILURE RATE</span><span class="metric-value"
              id="dv-fail">—</span></div>
          <div class="metric"><span class="metric-name">MTTR</span><span class="metric-value" id="dv-mttr">—</span>
          </div>
        </div>
        <div class="panel-section">
          <h3>Pipeline Log</h3>
          <div class="event-log" id="pipeline-log">
            <div class="log-entry">// awaiting pipeline...</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ═══════════════════════════════════════
   CHATBOT
═══════════════════════════════════════ -->
  <div class="chat-orb" id="chat-orb" onclick="toggleChat()" title="Ask the Oracle"
    style="display:flex;align-items:center;justify-content:center"><i data-lucide="bot"
      style="width:24px;height:24px"></i></div>
  <div id="chat-panel">
    <div class="chat-header">
      <div>
        <div class="chat-header-title">THE ORACLE</div>
        <div class="chat-header-sub">GEMINI-POWERED · SYSTEM ADVISOR</div>
      </div>
      <button class="chat-close" onclick="toggleChat()">✕</button>
    </div>
    <div class="chat-mode-btns">
      <button class="chat-mode-btn" onclick="setChatMode('explain')" id="mode-explain">EXPLAIN</button>
      <button class="chat-mode-btn" onclick="setChatMode('interview')" id="mode-interview">INTERVIEW</button>
      <button class="chat-mode-btn active" onclick="setChatMode('about')" id="mode-about">ABOUT ME</button>
    </div>
    <div class="chat-messages" id="chat-messages">
      <div class="chat-msg bot">Welcome. I am the Oracle — powered by Gemini. Ask me to explain any algorithm, quiz you
        on backend concepts, or advise your current realm. What do you seek?</div>
    </div>
    <div class="chat-input-area">
      <input class="chat-input" id="chat-input" placeholder="Ask anything..."
        onkeydown="if(event.key==='Enter')sendChat()">
      <button class="chat-send" onclick="sendChat()">SEND</button>
    </div>
  </div>

  <script>
    'use strict';

// ═══════════════════════════════════════
// NAMED CONSTANTS  (no more magic numbers)
// ═══════════════════════════════════════
const WARP_LINE_COUNT      = 60;
const WARP_SPEED           = 0.025;
const PARTICLE_COUNT       = 40;
const SIM_TICK_MS          = 600;
const AUTO_EVENT_COOLDOWN  = 15_000;
const AUTO_EVENT_CHANCE    = 0.12;
const MAX_QUEUE_DEPTH      = 9_999;
const CURSOR_HOVER_SIZE    = 20;
const CURSOR_DEFAULT_SIZE  = 12;
const CURSOR_LERP          = 0.15;
const GEMINI_MODEL         = 'gemini-2.5-flash';
/**
 * Your deployed Cloudflare Worker URL.
 * After running `wrangler deploy` in the gemini-proxy/ folder,
 * replace the placeholder below with the real URL.
 * Never put your API key here — it lives as a Worker secret.
 */
const GEMINI_PROXY_URL     = 'https://gemini-proxy.zm-portfolio2026.workers.dev';
const GEMINI_MAX_TOKENS    = 1600;
const GEMINI_TEMP_BOSS     = 0.9;
const GEMINI_TEMP_CHAT     = 0.8;
const XP_MAX               = 100;
const TOAST_DURATION_MS    = 3_000;
const TOAST_FADE_MS        = 500;

    // ═══════════════════════════════════════
    // DOM CACHE  (single source of truth — no repeated getElementById)
    // Query once, reuse everywhere. Grouped by realm.
    // ═══════════════════════════════════════
    const $ = id => document.getElementById(id);

    /** @type {Object.<string, HTMLElement|null>} */
    const DOM = {
      // Global
      cursor: $('cursor'),
      cursorRing: $('cursor-ring'),
      toasts: $('toasts'),
      particles: $('particles'),
      chatPanel: $('chat-panel'),
      chatInput: $('chat-input'),
      chatMessages: $('chat-messages'),
      codeDrawer: $('code-drawer'),
      codeTabs: $('code-tabs'),
      codeInfo: $('code-info'),
      codeArea: $('code-area'),
      warpOverlay: $('warp-overlay'),
      warpCanvas: $('warp-canvas'),
      warpClone: $('warp-card-clone'),
      hireContent: $('hire-content'),

      // System realm
      sysCanvas: $('system-canvas'),
      trafficSlider: $('traffic-slider'),
      trafficRps: $('traffic-rps'),
      trafficLabel: $('traffic-label'),
      eventLog: $('event-log'),
      mLatency: $('m-latency'), bLatency: $('b-latency'),
      mError: $('m-error'), bError: $('b-error'),
      mThroughput: $('m-throughput'), bThroughput: $('b-throughput'),
      mCache: $('m-cache'), bCache: $('b-cache'),
      mQueue: $('m-queue'),
      mCpu: $('m-cpu'),
      sysXpFill: $('sys-xp-fill'), sysXpVal: $('sys-xp-val'),

      // DB realm
      bossName: $('boss-name'),
      bossMs: $('boss-ms'),
      bossHp: $('boss-hp'),
      bossHpText: $('boss-hp-text'),
      queryDisplay: $('query-display'),
      queryStat: $('query-stat'),
      dbLevel: $('db-level'),
      dbFeedback: $('db-feedback'),
      dbScore: $('db-score'),
      solutionGrid: $('solution-grid'),
      knowledgeTags: $('knowledge-tags'),
      dbXpFill: $('db-xp-fill'), dbXpVal: $('db-xp-val'),

      // ML realm
      mlTitle: $('ml-title'),
      mlSubtitle: $('ml-subtitle'),
      mlTarget: $('ml-target'),
      algoGrid: $('algo-grid'),
      mlRunStatus: $('ml-run-status'),
      accuracyDisplay: $('accuracy-display'),
      accuracyNumber: $('accuracy-number'),
      accuracyLabel: $('accuracy-label'),
      mlTrain: $('ml-train'),
      mlTest: $('ml-test'),
      mlOverfit: $('ml-overfit'),
      mlBias: $('ml-bias'),
      mlVar: $('ml-var'),
      mlInsight: $('ml-insight'),
      mlCleared: $('ml-cleared'),
      mlXpFill: $('ml-xp-fill'), mlXpVal: $('ml-xp-val'),

      // DevOps realm
      stagePool: $('stage-pool'),
      pipelineTrack: $('pipeline-track'),
      pipelineLog: $('pipeline-log'),
      deployStreak: $('deploy-streak'),
      dvFreq: $('dv-freq'),
      dvLead: $('dv-lead'),
      dvFail: $('dv-fail'),
      dvMttr: $('dv-mttr'),
      devXpFill: $('devops-xp-fill'), devXpVal: $('devops-xp-val'),
    };

    // ───────────────────────────────────────
    // Null-safe DOM helper — set text + optional class
    // ───────────────────────────────────────
    /** @param {HTMLElement|null} el @param {string} text @param {string} [cls] */
    function setText(el, text, cls) {
      if (!el) return;
      el.textContent = text;
      if (cls !== undefined) el.className = cls;
    }

    /**
     * Update a metric display + its progress bar in one call.
     * @param {HTMLElement|null} label @param {HTMLElement|null} bar
     * @param {string} text @param {string} cls @param {number} pct 0-100
     */
    function setMetricDisplay(label, bar, text, cls, pct) {
      setText(label, text, 'metric-value ' + cls);
      if (bar) {
        bar.style.width = Math.min(100, pct) + '%';
        bar.style.background = cls === 'good' ? '#00cc66' : cls === 'warn' ? '#ff8c00' : 'var(--crimson)';
      }
    }

    /**
     * Single entry-point for all Gemini API calls.
     * Calls your Cloudflare Worker proxy — the API key never touches the browser.
     * Strips markdown fences and returns the raw text string.
     * @param {string} prompt
     * @param {number} [temperature=GEMINI_TEMP_CHAT]
     * @param {number} [maxTokens=GEMINI_MAX_TOKENS]
     * @returns {Promise<string>}
     */
    async function callGemini(prompt, temperature = GEMINI_TEMP_CHAT, maxTokens = GEMINI_MAX_TOKENS) {
      const res = await fetch(GEMINI_PROXY_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          contents: [{ role: 'user', parts: [{ text: prompt }] }],
          generationConfig: { temperature, maxOutputTokens: maxTokens },
        }),
      });
      if (!res.ok) {
        const err = await res.json().catch(() => ({}));
        throw new Error(err?.error?.message || `HTTP ${res.status}`);
      }
      const data = await res.json();
      const raw = data?.candidates?.[0]?.content?.parts?.[0]?.text ?? '';
      return raw.replace(/```json|```/g, '').trim();
    }


    // ═══════════════════════════════════════
    // CURSOR
    // ═══════════════════════════════════════
    let mx = 0, my = 0, rx = 0, ry = 0;

    document.addEventListener('mousemove', e => { mx = e.clientX; my = e.clientY; });

    function animateCursor() {
      rx += (mx - rx) * CURSOR_LERP;
      ry += (my - ry) * CURSOR_LERP;
      DOM.cursor.style.left = mx + 'px';
      DOM.cursor.style.top = my + 'px';
      DOM.cursorRing.style.left = rx + 'px';
      DOM.cursorRing.style.top = ry + 'px';
      requestAnimationFrame(animateCursor);
    }
    animateCursor();

    document.querySelectorAll('button, .realm-card, .algo-btn, .solution-btn, .pipeline-stage')
      .forEach(el => {
        el.addEventListener('mouseenter', () => {
          DOM.cursor.style.width = DOM.cursor.style.height = CURSOR_HOVER_SIZE + 'px';
        });
        el.addEventListener('mouseleave', () => {
          DOM.cursor.style.width = DOM.cursor.style.height = CURSOR_DEFAULT_SIZE + 'px';
        });
      });

    // ═══════════════════════════════════════
    // PARTICLES
    // ═══════════════════════════════════════
    function createParticles() {
      if (!DOM.particles) return;
      for (let i = 0; i < PARTICLE_COUNT; i++) {
        const p = document.createElement('div');
        p.className = 'particle';
        const sx = (Math.random() * 100).toFixed(1);
        const dx = ((Math.random() - 0.5) * 200).toFixed(1);
        const dur = (6 + Math.random() * 10).toFixed(2);
        const delay = (Math.random() * 8).toFixed(2);
        p.style.cssText = `--sx:${sx}vw;--dx:${dx}px;--dur:${dur}s;--delay:${delay}s;left:0;top:0;`;
        DOM.particles.appendChild(p);
      }
    }

    // ═══════════════════════════════════════
    // SCREEN MANAGEMENT
    // ═══════════════════════════════════════
    let currentScreen = 'intro';
    let currentRealm = null;

    function showScreen(id) {
      document.querySelectorAll('.screen').forEach(s => s.classList.add('hidden'));
      const target = $(id);
      if (target) target.classList.remove('hidden');
      currentScreen = id;
    }

    function enterArcade() {
      createParticles();
      const intro = $('intro');
      if (intro) intro.style.opacity = '0';
      setTimeout(() => showScreen('card-select'), 600);
    }

    /** Stop any running system simulation — single place for teardown. */
    function stopSystemSim() {
      if (sysTickInterval) { clearInterval(sysTickInterval); sysTickInterval = null; }
      if (sysAnimFrame) { cancelAnimationFrame(sysAnimFrame); sysAnimFrame = null; }
    }

    function backToCards() {
      DOM.chatPanel?.classList.remove('open');
      DOM.codeDrawer?.classList.remove('open');
      stopSystemSim();
      showScreen('card-select');
      currentRealm = null;
    }

    // ═══════════════════════════════════════
    // WARP TUNNEL
    // ═══════════════════════════════════════
    let warpAnim = null;

    function enterRealm(realm) {
      const cardEl = [...document.querySelectorAll('.realm-card')]
        .find(c => c.getAttribute('onclick')?.includes(realm));
      if (!cardEl) { launchRealm(realm); return; }

      const rect = cardEl.getBoundingClientRect();
      const overlay = DOM.warpOverlay;
      const clone = DOM.warpClone;
      const warpCanvas = DOM.warpCanvas;
      const ctx = warpCanvas.getContext('2d');

      const dpr = window.devicePixelRatio || 1;
      warpCanvas.width = window.innerWidth * dpr;
      warpCanvas.style.width = window.innerWidth + 'px';
      ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
      warpCanvas.height = window.innerHeight * dpr;
      warpCanvas.style.height = window.innerHeight + 'px';

      clone.textContent = cardEl.getAttribute('data-sigil') || '⚡';
      clone.style.cssText = `left:${rect.left}px;top:${rect.top}px;width:${rect.width}px;height:${rect.height}px;transform-origin:center center;transition:none;`;

      overlay.style.opacity = '1';
      overlay.style.pointerEvents = 'all';

      let progress = 0;
      const cx = rect.left + rect.width / 2;
      const cy = rect.top + rect.height / 2;

      const stars = Array.from({ length: 150 }, () => ({
        x: Math.random() * window.innerWidth,
        y: Math.random() * window.innerHeight,
        speed: 1 + Math.random() * 3,
      }));

      // Calculate the scale needed to make the card cover the entire screen
      const targetScale = Math.max(window.innerWidth / rect.width, window.innerHeight / rect.height) * 1.5;

      function warpFrame() {
        progress += WARP_SPEED;
        // Apply an ease-in exponential curve to progress for the dramatic zoom rush
        const easedProgress = progress < 1 ? Math.pow(progress, 3) : 1;

        ctx.clearRect(0, 0, window.innerWidth, window.innerHeight);

        ctx.fillStyle = `rgba(5,0,0,${Math.min(progress * 0.8, 0.85)})`;
        ctx.fillRect(0, 0, window.innerWidth, window.innerHeight);

        // Radial speed lines
        for (let i = 0; i < WARP_LINE_COUNT; i++) {
          const angle = (i / WARP_LINE_COUNT) * Math.PI * 2;
          const speed = progress * progress * 800;
          const sx = cx + Math.cos(angle) * speed * 0.1;
          const sy = cy + Math.sin(angle) * speed * 0.1;
          const ex = cx + Math.cos(angle) * (speed + 50 + Math.random() * 30);
          const ey = cy + Math.sin(angle) * (speed + 50 + Math.random() * 30);
          ctx.beginPath();
          ctx.strokeStyle = `rgba(220,20,60,${Math.max(0, 0.8 - progress * 0.3)})`;
          ctx.lineWidth = 0.5 + progress;
          ctx.moveTo(sx, sy);
          ctx.lineTo(ex, ey);
          ctx.stroke();
        }

        // Stars rushing outward
        stars.forEach(star => {
          const dx = star.x - cx;
          const dy = star.y - cy;
          const dist = Math.sqrt(dx * dx + dy * dy);
          ctx.beginPath();
          ctx.fillStyle = `rgba(220,20,60,${0.6 * progress})`;
          ctx.arc(
            star.x + (dx / dist) * star.speed * progress * 15,
            star.y + (dy / dist) * star.speed * progress * 15,
            1 + progress, 0, Math.PI * 2
          );
          ctx.fill();
        });

        // 3D Teleport camera rush into the card
        const currentScale = 1 + (targetScale - 1) * easedProgress;

        // Move the card center towards the true center of the screen as it scales
        const screenCenterX = window.innerWidth / 2;
        const screenCenterY = window.innerHeight / 2;

        // Calculate translation needed to center the zooming card
        const tx = (screenCenterX - cx) * easedProgress;
        const ty = (screenCenterY - cy) * easedProgress;

        clone.style.transform = `translate(${tx}px, ${ty}px) scale(${currentScale})`;

        // Fade card content out at the very end to seamlessly transition to the realm background
        clone.style.opacity = Math.max(0, 1 - easedProgress * 1.5);
        clone.style.boxShadow = `0 0 ${easedProgress * 200}px rgba(220,20,60, ${Math.min(1, easedProgress * 2)})`;

        if (progress < 1) {
          warpAnim = requestAnimationFrame(warpFrame);
        } else {
          ctx.clearRect(0, 0, window.innerWidth, window.innerHeight);
          overlay.style.opacity = '0';
          overlay.style.pointerEvents = 'none';
          clone.style.cssText = 'left:;top:;width:180px;height:300px;opacity:1;transform:none;';
          launchRealm(realm);
        }
      }

      warpAnim = requestAnimationFrame(warpFrame);
    }

    /** Realm initialiser registry — Open/Closed: add new realms without touching launchRealm. */
    const REALM_INITS = {
      system: initSystemRealm,
      database: initDBRealm,
      ml: initMLRealm,
      devops: initDevOps,
      hire: initHireRealm,
      // 'projects' has no init needed
    };

    function launchRealm(realm) {
      currentRealm = realm;
      showScreen('realm-' + realm);
      REALM_INITS[realm]?.();
    }

    // Enter key on chat
    DOM.chatInput?.addEventListener('keydown', e => { if (e.key === 'Enter') sendChat(); });

    // ═══════════════════════════════════════
    // TOAST  — single responsibility: show a timed notification
    // ═══════════════════════════════════════
    function toast(msg, type = 'info') {
      const t = document.createElement('div');
      t.className = `toast ${type}`;
      t.textContent = msg;
      DOM.toasts.appendChild(t);
      setTimeout(() => {
        t.style.opacity = '0';
        t.style.transition = `opacity ${TOAST_FADE_MS}ms`;
        setTimeout(() => t.remove(), TOAST_FADE_MS);
      }, TOAST_DURATION_MS);
    }

    // ═══════════════════════════════════════
    // SYSTEM REALM
    // ═══════════════════════════════════════
    let sysCanvas, sysCtx;
    let nodes = [], connections = [], selectedNodeType = null;
    let connectingFrom = null, trafficLevel = 0;
    let sysMetrics = { latency: 0, error: 0, throughput: 0, cache: 0 };
    let sysXP = 0;
    let sysAnimFrame = null;
    let sysTickInterval = null;
    let lastAutoEvent = 0;
    let eventLog = [];

    // Mutable simulation state — updated each tick
    const simState = { queueDepth: 0, cpuLoad: 0, memLoad: 0 };

    const NODE_TYPES = {
      'load-balancer': { color: '#DC143C', label: 'LB', full: 'Load Balancer' },
      'api-server': { color: '#C9A84C', label: 'API', full: 'API Server' },
      'cache': { color: '#00cc66', label: '⚡', full: 'Cache' },
      'database': { color: '#4488ff', label: 'DB', full: 'Database' },
      'queue': { color: '#ff8c00', label: '📬', full: 'Queue' },
      'replica': { color: '#aa66ff', label: 'R', full: 'DB Replica' },
    };

    // Traffic label per 20-unit band — index = Math.floor(trafficLevel / 20)
    const TRAFFIC_LABELS = ['IDLE', 'LOW TRAFFIC', 'MODERATE', 'HIGH LOAD', 'DANGER ZONE', '💀 OVERLOAD'];

    function initSystemRealm() {
      sysCanvas = $('system-canvas');
      sysCtx = sysCanvas.getContext('2d');
      resizeSysCanvas();
      window.addEventListener('resize', resizeSysCanvas);
      sysCanvas.addEventListener('click', onSysCanvasClick);

      nodes = []; connections = []; trafficLevel = 0;
      simState.queueDepth = 0; simState.cpuLoad = 0; simState.memLoad = 0;
      lastAutoEvent = 0;

      const slider = $('traffic-slider');
      if (slider) slider.value = 0;

      addLog('// system canvas ready');
      addLog('// place nodes, connect them, then increase traffic');
      stopSystemSim();
      drawSystem();
      sysTickInterval = setInterval(sysSimTick, SIM_TICK_MS);
    }

    function resizeSysCanvas() {
      if (!sysCanvas) return;
      const area = sysCanvas.parentElement;
      const dpr = window.devicePixelRatio || 1;
      sysCanvas.width = area.clientWidth * dpr;
      sysCanvas.style.width = area.clientWidth + 'px';
      sysCtx.setTransform(dpr, 0, 0, dpr, 0, 0);
      sysCanvas.height = area.clientHeight * dpr;
      sysCanvas.style.height = area.clientHeight + 'px';
    }

    function updateTraffic(val) {
      trafficLevel = parseInt(val);
      const rps = trafficLevel * 120;
      const label = TRAFFIC_LABELS[Math.floor(trafficLevel / 20)] ?? TRAFFIC_LABELS[TRAFFIC_LABELS.length - 1];
      const rpsEl = $('traffic-rps');
      const lblEl = $('traffic-label');
      if (rpsEl) rpsEl.textContent = rps;
      if (lblEl) lblEl.textContent = label;
      sysSimTick();
    }

    function selectNode(type) {
      selectedNodeType = type;
      connectingFrom = null;
      document.querySelectorAll('.node-btn').forEach(b => b.classList.remove('active'));
      $('btn-' + (type === 'database' ? 'database-node' : type))?.classList.add('active');
    }

    function clearConnecting() {
      connectingFrom = null; selectedNodeType = null;
      document.querySelectorAll('.node-btn').forEach(b => b.classList.remove('active'));
      toast('Click a node to start connection, then click another to connect', 'info');
    }

    function clearNodes() {
      nodes = []; connections = [];
      connectingFrom = null; selectedNodeType = null;
      document.querySelectorAll('.node-btn').forEach(b => b.classList.remove('active'));
      addLog('// canvas cleared');
    }

    function onSysCanvasClick(e) {
      const rect = sysCanvas.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      const clicked = nodes.find(n => Math.hypot(n.x - x, n.y - y) < 30);

      // Mode: completing a connection
      if (connectingFrom !== null) {
        if (clicked && clicked !== connectingFrom) {
          const alreadyLinked = connections.some(c =>
            (c.a === connectingFrom && c.b === clicked) ||
            (c.a === clicked && c.b === connectingFrom)
          );
          if (!alreadyLinked) {
            connections.push({ a: connectingFrom, b: clicked });
            addLog(`// connected: ${connectingFrom.full} → ${clicked.full}`);
            toast(`Connected: ${connectingFrom.full} ↔ ${clicked.full}`, 'success');
            gainXP('sys', 10);
            sysSimTick();
          }
        }
        connectingFrom = null;
        $('btn-connect')?.classList.remove('active');
        return;
      }

      // Mode: starting a connection from an existing node
      if (clicked) {
        connectingFrom = clicked;
        $('btn-connect')?.classList.add('active');
        toast(`Connecting from ${clicked.full} — click another node`, 'info');
        return;
      }

      // Mode: placing a new node
      if (selectedNodeType) {
        const type = NODE_TYPES[selectedNodeType];
        nodes.push({ x, y, type: selectedNodeType, ...type, id: Date.now(), health: 100 });
        addLog(`// placed: ${type.full} at (${Math.round(x)}, ${Math.round(y)})`);
        gainXP('sys', 5);
        sysSimTick();
      }
    }

    // ── Simulation — each function has one job ───────────────────────────────────

    /** Read node topology once per tick; all sim functions consume this. */
    function getTopology() {
      return {
        hasLB: nodes.some(n => n.type === 'load-balancer'),
        apiCount: nodes.filter(n => n.type === 'api-server' && n.health > 0).length,
        hasCache: nodes.some(n => n.type === 'cache'),
        hasQueue: nodes.some(n => n.type === 'queue'),
        rps: trafficLevel * 120,
      };
    }

    /** Mutate simState: queue depth, CPU load, memory load. */
    function stepSimState({ apiCount, hasLB, hasQueue, rps }) {
      const capacity = apiCount * 800 + (hasLB ? 400 : 0) + (hasQueue ? 600 : 0);
      const overflow = Math.max(0, rps - capacity);
      simState.queueDepth = Math.min(
        MAX_QUEUE_DEPTH,
        Math.max(0, simState.queueDepth + overflow * 0.1 - capacity * 0.05)
      );
      const perServer = apiCount > 0 ? rps / apiCount : rps;
      simState.cpuLoad = Math.min(100, perServer / 12 + (hasLB ? -8 : 0) + (Math.random() - 0.5) * 5);
      simState.memLoad = Math.min(100, simState.queueDepth / 50 + apiCount * 8 + (Math.random() - 0.5) * 3);
    }

    /** Derive latency, error rate, throughput and cache hit from topology + sim state. */
    function deriveMetrics({ hasLB, apiCount, hasCache, hasQueue }) {
      // Latency: queueing formula + jitter, dampened by architecture
      let latency = 60 + trafficLevel * 8 + simState.queueDepth * 0.8 + (Math.random() - 0.5) * 40;
      if (hasLB) latency *= 0.55;
      if (apiCount > 1) latency /= (0.4 + apiCount * 0.35);
      if (hasCache) latency *= 0.45;
      if (hasQueue) latency *= 0.65;
      latency = Math.max(2, Math.round(latency));

      // Error rate: grows with overload, dampened by LB + multi-API
      let error = trafficLevel > 40 ? (trafficLevel - 40) * 0.6 : 0;
      if (simState.queueDepth > 200) error += simState.queueDepth / 80;
      if (!hasLB && trafficLevel > 60) error += 15;
      if (apiCount === 0) error = 100;
      if (hasLB) error *= 0.35;
      if (apiCount > 1) error *= 0.25;
      error = Math.min(100, Math.round(error + (Math.random() - 0.5) * 3));

      const throughput = Math.min(100, Math.round(
        (connections.length * 10 + (hasLB ? 25 : 0) + (hasQueue ? 18 : 0) + apiCount * 12)
        * Math.max(0, 1 - error / 150) + (Math.random() - 0.5) * 4
      ));
      const cacheHit = hasCache
        ? Math.min(97, 35 + connections.length * 7 + (Math.random() - 0.5) * 4)
        : 0;

      return { latency, error, throughput, cacheHit };
    }

    /** Flush metrics to DOM using the shared setMetricDisplay helper. */
    function renderSysMetrics({ latency, error, throughput, cacheHit }) {
      const lClass = latency > 800 ? 'danger' : latency > 300 ? 'warn' : 'good';
      const eClass = error > 20 ? 'danger' : error > 5 ? 'warn' : 'good';
      const tClass = throughput > 60 ? 'good' : 'warn';
      const cpuCls = simState.cpuLoad > 80 ? 'danger' : simState.cpuLoad > 50 ? 'warn' : 'good';

      const mL = $('m-latency'), bL = $('b-latency');
      const mE = $('m-error'), bE = $('b-error');
      const mT = $('m-throughput'), bTh = $('b-throughput');
      const mC = $('m-cache'), bC = $('b-cache');

      if (mL) { mL.textContent = latency + 'ms'; mL.className = 'metric-value ' + lClass; }
      if (bL) { bL.style.width = Math.min(100, latency / 20) + '%'; bL.style.background = lClass === 'good' ? '#00cc66' : lClass === 'warn' ? '#ff8c00' : 'var(--crimson)'; }
      if (mE) { mE.textContent = error + '%'; mE.className = 'metric-value ' + eClass; }
      if (bE) { bE.style.width = error + '%'; bE.style.background = eClass === 'good' ? '#00cc66' : eClass === 'warn' ? '#ff8c00' : 'var(--crimson)'; }
      if (mT) { mT.textContent = throughput + '%'; mT.className = 'metric-value ' + tClass; }
      if (bTh) { bTh.style.width = throughput + '%'; bTh.style.background = '#00cc66'; }
      if (mC) { mC.textContent = cacheHit ? cacheHit.toFixed(0) + '%' : 'N/A'; }
      if (bC) { bC.style.width = cacheHit + '%'; }

      const qEl = $('m-queue');
      const cpuEl = $('m-cpu');
      if (qEl) qEl.textContent = Math.round(simState.queueDepth);
      if (cpuEl) { cpuEl.textContent = simState.cpuLoad.toFixed(0) + '%'; cpuEl.className = 'metric-value ' + cpuCls; }
    }

    /** Probabilistically fire a random operational event. */
    function maybeFireAutoEvent(apiCount) {
      const now = Date.now();
      if (trafficLevel <= 30) return;
      if (now - lastAutoEvent < AUTO_EVENT_COOLDOWN) return;
      if (Math.random() >= AUTO_EVENT_CHANCE) return;

      lastAutoEvent = now;
      const pool = [
        () => addLog('⚡ Cache eviction — miss storm starting', 'danger'),
        () => addLog('🔥 Hot key on DB — consider caching', 'warn'),
        () => addLog('📈 p99 latency spike detected', 'warn'),
        () => {
          const live = nodes.filter(n => n.type === 'api-server' && n.health > 0);
          if (!live.length) return;
          const v = live[Math.floor(Math.random() * live.length)];
          v.health = 10; v.color = '#661111';
          addLog('💀 API server under memory pressure!', 'danger');
          setTimeout(() => { v.health = 100; v.color = NODE_TYPES['api-server'].color; addLog('// server recovered', 'good'); }, 4000);
        },
      ];
      pool[Math.floor(Math.random() * pool.length)]();
    }

    /** Main tick: orchestrates sub-functions; each does one thing. */
    function sysSimTick() {
      if (!nodes.length || trafficLevel === 0) return;
      const topo = getTopology();
      stepSimState(topo);
      const metrics = deriveMetrics(topo);
      sysMetrics = { latency: metrics.latency, error: metrics.error, throughput: metrics.throughput, cache: metrics.cacheHit };
      renderSysMetrics(metrics);
      maybeFireAutoEvent(topo.apiCount);

      if (simState.queueDepth > 500) addLog(`⚠ Queue depth: ${Math.round(simState.queueDepth)} — requests backing up`, 'danger');
      if (metrics.latency > 1500 && trafficLevel > 20) addLog('⚠ Latency critical — add capacity', 'danger');
    }

    /** Trigger immediate metric update when topology changes. */
    function updateSysMetrics() { sysSimTick(); }

    // ── Canvas rendering ─────────────────────────────────────────────────────────

    /** Draw the full system canvas: grid, connections, animated packets, nodes. */
    function drawSystem() {
      if (!sysCtx) return;
      const w = sysCanvas.clientWidth, h = sysCanvas.clientHeight;
      sysCtx.clearRect(0, 0, w, h);

      // Background grid
      sysCtx.strokeStyle = 'rgba(42,21,21,0.4)';
      sysCtx.lineWidth = 0.5;
      for (let x = 0; x < w; x += 40) { sysCtx.beginPath(); sysCtx.moveTo(x, 0); sysCtx.lineTo(x, h); sysCtx.stroke(); }
      for (let y = 0; y < h; y += 40) { sysCtx.beginPath(); sysCtx.moveTo(0, y); sysCtx.lineTo(w, y); sysCtx.stroke(); }

      // Connections
      connections.forEach(conn => {
        const a = conn.a, b = conn.b;
        sysCtx.beginPath();
        sysCtx.strokeStyle = trafficLevel > 0
          ? `rgba(220,20,60,${0.3 + trafficLevel * 0.004})`
          : 'rgba(139,0,0,0.35)';
        sysCtx.lineWidth = 1.5;
        sysCtx.moveTo(a.x, a.y);
        sysCtx.lineTo(b.x, b.y);
        sysCtx.stroke();

        // Animated data packets
        if (trafficLevel > 0) {
          const t = (Date.now() % 1200) / 1200;
          const px = a.x + (b.x - a.x) * t;
          const py = a.y + (b.y - a.y) * t;
          sysCtx.beginPath();
          sysCtx.fillStyle = '#C9A84C';
          sysCtx.arc(px, py, 3, 0, Math.PI * 2);
          sysCtx.fill();
        }
      });

      // Nodes
      nodes.forEach(node => {
        const alive = node.health > 50;
        const r = 28;
        const glowAmt = trafficLevel * 0.006;

        // Glow ring when traffic is active
        if (trafficLevel > 0 && alive) {
          sysCtx.beginPath();
          sysCtx.arc(node.x, node.y, r + 6, 0, Math.PI * 2);
          sysCtx.fillStyle = node.color + '22';
          sysCtx.fill();
        }

        // Node body
        sysCtx.beginPath();
        sysCtx.arc(node.x, node.y, r, 0, Math.PI * 2);
        sysCtx.fillStyle = alive ? node.color + 'cc' : '#440000';
        sysCtx.strokeStyle = alive ? node.color : '#660000';
        sysCtx.lineWidth = 2;
        sysCtx.fill();
        sysCtx.stroke();

        // Health bar (shows when degraded)
        if (node.health < 100) {
          sysCtx.fillStyle = '#220000';
          sysCtx.fillRect(node.x - r, node.y + r + 4, r * 2, 4);
          sysCtx.fillStyle = node.health > 50 ? '#ff8c00' : '#cc0000';
          sysCtx.fillRect(node.x - r, node.y + r + 4, (r * 2) * (node.health / 100), 4);
        }

        // Label
        sysCtx.fillStyle = '#fff';
        sysCtx.font = 'bold 11px Share Tech Mono';
        sysCtx.textAlign = 'center';
        sysCtx.textBaseline = 'middle';
        sysCtx.fillText(node.label, node.x, node.y);

        // Name below node
        sysCtx.fillStyle = 'rgba(200,180,160,0.75)';
        sysCtx.font = '9px Share Tech Mono';
        sysCtx.fillText(node.full, node.x, node.y + r + 16);
      });

      // Connecting-from indicator
      if (connectingFrom) {
        sysCtx.beginPath();
        sysCtx.arc(connectingFrom.x, connectingFrom.y, 34, 0, Math.PI * 2);
        sysCtx.strokeStyle = '#C9A84C';
        sysCtx.lineWidth = 2;
        sysCtx.setLineDash([4, 4]);
        sysCtx.stroke();
        sysCtx.setLineDash([]);
      }

      sysAnimFrame = requestAnimationFrame(drawSystem);
    }

    function triggerEvent(type) {
      const slider = $('traffic-slider');
      if (type === 'spike') {
        const old = parseInt(slider?.value ?? 0);
        const spiked = Math.min(100, old + 40);
        if (slider) slider.value = spiked;
        updateTraffic(spiked);
        addLog('💥 Flash sale spike! Traffic surged +40%', 'danger');
        toast('Flash Sale Spike! Handle the load!', 'warn');
        setTimeout(() => {
          if (slider) slider.value = old;
          updateTraffic(old);
          addLog('// traffic spike subsided', 'good');
        }, 8000);

      } else if (type === 'crash') {
        const apis = nodes.filter(n => n.type === 'api-server');
        if (!apis.length) { toast('No API servers to crash!', 'warn'); return; }
        const victim = apis[Math.floor(Math.random() * apis.length)];
        victim.health = 0; victim.color = '#440000';
        const msg = apis.length > 1 ? 'Others absorbing load' : 'SYSTEM DOWN';
        addLog(`💀 API Server crashed! ${msg}`, 'danger');
        toast(apis.length > 1 ? 'Worker crashed — others absorbing!' : 'System down!', 'warn');
        setTimeout(() => { victim.health = 100; victim.color = NODE_TYPES['api-server'].color; addLog('// worker auto-restarted', 'good'); }, 5000);

      } else if (type === 'cache-miss') {
        addLog('⚡ Cache miss storm! All reads hitting DB', 'danger');
        toast('Cache miss storm!', 'warn');
        const mLat = $('m-latency');
        if (mLat) { mLat.textContent = (sysMetrics.latency * 3) + 'ms'; mLat.className = 'metric-value danger'; }
        setTimeout(() => sysSimTick(), 6000);
      }
      gainXP('sys', 15);
    }

    function addLog(msg, type = '') {
      eventLog.unshift({ msg, type });
      if (eventLog.length > 20) eventLog.pop();
      const el = $('event-log');
      if (el) el.innerHTML = eventLog.slice(0, 10)
        .map(e => `<div class="log-entry ${e.type}">${e.msg}</div>`).join('');
    }

    // ═══════════════════════════════════════
    // DATABASE DUNGEON — DYNAMIC GEMINI BOSSES
    // ═══════════════════════════════════════
    // Seed topics rotate so every session is different
    const DB_BOSS_TOPICS = [
      { concept: 'INDEXING', ms: 1200, theme: 'missing index on a high-cardinality WHERE clause' },
      { concept: 'N+1 FIX', ms: 3400, theme: 'N+1 query problem loading related records in a loop' },
      { concept: 'NORMALIZATION', ms: 47000, theme: 'cartesian product explosion from missing JOIN condition' },
      { concept: 'SHARDING', ms: 800, theme: 'single-node write bottleneck under high write load' },
      { concept: 'READ REPLICA', ms: 650, theme: 'heavy analytics reads saturating the primary write database' },
      { concept: 'CACHING', ms: 950, theme: 'repeated identical queries hammering the database with no cache layer' },
    ];

    let dbLevel = 0, dbScore = 0, dbXP = 20, dbAnswered = false;
    let unlockedConcepts = [];
    let currentDBBoss = null;
    // Shuffle topics each session
    let sessionTopics = [...DB_BOSS_TOPICS].sort(() => Math.random() - 0.5).slice(0, 5);

    function initDBRealm() {
      dbLevel = 0; dbScore = 0; dbXP = 20; dbAnswered = false; unlockedConcepts = [];
      sessionTopics = [...DB_BOSS_TOPICS].sort(() => Math.random() - 0.5).slice(0, 5);
      currentDBBoss = null;
      generateDBBoss();
    }

    async function generateDBBoss() {
      const topic = sessionTopics[dbLevel];

      setText(DOM.bossName, '// GENERATING BOSS...');
      setText(DOM.queryDisplay, '// Gemini is crafting your query scenario...');
      setText(DOM.dbFeedback, '// stand by');
      setText(DOM.dbLevel, `LEVEL ${dbLevel + 1} OF ${sessionTopics.length}`);
      DOM.solutionGrid.innerHTML = `<div style="font-family:'Share Tech Mono',monospace;font-size:0.65rem;color:var(--blood);padding:1rem;grid-column:span 2">// summoning boss from the void...</div>`;

      const prompt = `You are generating a database query boss fight for a gamified developer portfolio.

Topic: ${topic.theme}
Concept to teach: ${topic.concept}
Base query time: ${topic.ms}ms

Return ONLY valid JSON (no markdown, no extra text) in this exact structure:
{
  "bossName": "THE [DRAMATIC ALL-CAPS NAME]",
  "query": "the SQL query showing the problem (4-8 lines with comments showing row counts and timing)",
  "stat": "⚠ one-line description of the problem",
  "solutions": [
    { "label": "🔧 Short Action", "sub": "technical detail", "correct": true, "feedback": "✅ explanation with specific performance improvement" },
    { "label": "🔧 Short Action", "sub": "technical detail", "correct": false, "feedback": "❌ why this misses the root cause" },
    { "label": "🔧 Short Action", "sub": "technical detail", "correct": false, "feedback": "❌ why this misses the root cause" },
    { "label": "🔧 Short Action", "sub": "technical detail", "correct": false, "feedback": "❌ explanation" }
  ]
}

Use real SQL. The correct solution must directly address the ${topic.concept} concept. Use emojis like 🗂 🔗 📋 ⚡ 🧩 📊 for labels.`;

      try {
        const text = await callGemini(prompt, GEMINI_TEMP_BOSS);
        const boss = JSON.parse(text);
        boss.ms = topic.ms;
        boss.concept = topic.concept;
        currentDBBoss = boss;
        renderDBBoss(boss);
      } catch (e) {
        console.warn('generateDBBoss fallback:', e.message);
        currentDBBoss = getFallbackBoss(topic);
        renderDBBoss(currentDBBoss);
      }
    }

    /** Complete offline fallbacks — one per concept so no concept ever repeats. */
    function getFallbackBoss(topic) {
      const FALLBACKS = {
        'INDEXING': {
          bossName: 'THE FULL TABLE SCAN',
          query: `SELECT * FROM users WHERE email = 'x@test.com';\n\n-- 847,293 rows scanned\n-- No index found\n-- Query time: 1200ms`,
          stat: '⚠ Sequential scan on 847K-row table — O(n) on every lookup',
          solutions: [
            { label: '🗂 Add Index', sub: 'CREATE INDEX ON users(email)', correct: true, feedback: '✅ B-tree index cuts lookup from O(n) to O(log n). 1200ms → 2ms.' },
            { label: '📦 Add Cache', sub: 'Redis/Memcached layer', correct: false, feedback: '❌ Cold cache still hits the slow query. Index first.' },
            { label: '📐 Normalize', sub: 'Split the users table', correct: false, feedback: '❌ Normalization reduces redundancy but doesn\'t replace a missing index.' },
            { label: '📋 Read Replica', sub: 'Offload to replica', correct: false, feedback: '❌ Same slow query runs on the replica too.' },
          ],
        },
        'N+1 FIX': {
          bossName: 'THE N+1 HYDRA',
          query: `-- Fetching 100 orders, then for each:\nSELECT * FROM order_items WHERE order_id = ?;\n\n-- 1 + 100 = 101 queries fired\n-- Total time: 3400ms`,
          stat: '⚠ N+1 pattern: one query per record in a loop',
          solutions: [
            { label: '🔗 JOIN Query', sub: 'SELECT o.*, i.* FROM orders o JOIN order_items i', correct: true, feedback: '✅ One JOIN replaces 101 queries. 3400ms → ~45ms.' },
            { label: '🔥 Eager Load', sub: 'Batch-fetch associations', correct: true, feedback: '✅ Eager loading issues 2 batched queries instead of 101.' },
            { label: '🗂 Add Index', sub: 'Index order_id on items', correct: false, feedback: '⚠ Speeds each query but 101 round-trips remain — N+1 is still there.' },
            { label: '🧩 Denormalize', sub: 'Store item count on order', correct: false, feedback: '❌ Works only for counts. Full item data still requires fetching.' },
          ],
        },
        'NORMALIZATION': {
          bossName: 'THE CARTESIAN EXPLOSION',
          query: `SELECT * FROM orders o\nJOIN products p ON p.id > 0\nJOIN categories c ON c.id > 0;\n\n-- Missing proper ON condition!\n-- 50K × 10K × 200 = 100B rows\n-- Query time: 47,000ms`,
          stat: '⚠ Implicit cartesian product — rows multiplied across all tables',
          solutions: [
            { label: '🔗 Fix JOIN', sub: 'Add proper ON p.id = o.product_id', correct: true, feedback: '✅ Correct join condition eliminates the cartesian product. ~80ms.' },
            { label: '⚡ Add Cache', sub: 'Cache the result set', correct: false, feedback: '❌ Caching a 47s query doesn\'t fix it — the explosion must be prevented.' },
            { label: '🗂 Add Indexes', sub: 'Index all foreign keys', correct: false, feedback: '⚠ Important, but indexes can\'t fix a missing JOIN condition.' },
            { label: '🧊 Pagination', sub: 'LIMIT the output', correct: false, feedback: '⚠ LIMIT reduces rows returned but the cartesian is still computed in full.' },
          ],
        },
        'SHARDING': {
          bossName: 'THE WRITE BOTTLENECK',
          query: `INSERT INTO events (user_id, payload, ts)\nVALUES (?, ?, NOW());\n\n-- 50,000 writes/sec to one node\n-- Write queue depth: 8,000\n-- Avg write latency: 800ms`,
          stat: '⚠ Single-node write bottleneck — queue growing unbounded',
          solutions: [
            { label: '🗄 Shard by key', sub: 'Hash user_id across N nodes', correct: true, feedback: '✅ Sharding spreads writes across nodes — throughput scales linearly.' },
            { label: '📬 Write Queue', sub: 'Buffer with async queue', correct: true, feedback: '✅ Buffering + batch inserts absorbs spikes and reduces DB pressure.' },
            { label: '🗂 Add Index', sub: 'Index the ts column', correct: false, feedback: '❌ More indexes slow writes further — each INSERT must update every index.' },
            { label: '📋 Read Replica', sub: 'Add replica', correct: false, feedback: '❌ Replicas help reads. This is a write throughput problem.' },
          ],
        },
        'READ REPLICA': {
          bossName: 'THE ANALYTICS CRUSHER',
          query: `-- 200 concurrent dashboard users running:\nSELECT user_id, COUNT(*), AVG(total)\nFROM orders\nGROUP BY user_id;\n\n-- Primary DB CPU: 94%\n-- Avg latency: 650ms`,
          stat: '⚠ Heavy analytics reads saturating write-DB CPU',
          solutions: [
            { label: '📋 Read Replica', sub: 'Route analytics to replica', correct: true, feedback: '✅ Offloading reads drops primary CPU from 94% to ~15%.' },
            { label: '📊 Materialized', sub: 'Pre-aggregate into a view', correct: true, feedback: '✅ Pre-computing aggregates means the GROUP BY runs once — reads become instant.' },
            { label: '🔗 Tune Query', sub: 'Rewrite the SQL', correct: false, feedback: '⚠ Helps marginally but 200 concurrent users still swamp one DB node.' },
            { label: '🗂 Add Index', sub: 'Index user_id + total', correct: false, feedback: '⚠ Helps scans but GROUP BY on 50M rows with one DB still crushes CPU.' },
          ],
        },
        'CACHING': {
          bossName: 'THE STAMPEDE',
          query: `-- 500 req/s all hitting:\nSELECT * FROM product_catalog\nWHERE category = 'electronics';\n\n-- Same query, no cache\n-- DB CPU: 88%\n-- Query time: 950ms`,
          stat: '⚠ Identical queries hammering DB — no cache layer',
          solutions: [
            { label: '⚡ Add Redis', sub: 'Cache result with TTL', correct: true, feedback: '✅ Cache-aside with Redis serves 500 req/s from memory. DB load drops 95%.' },
            { label: '🗂 Add Index', sub: 'Index category column', correct: false, feedback: '⚠ Speeds each query but 500 identical queries/s still all hit the DB.' },
            { label: '📋 Read Replica', sub: 'Add replica', correct: false, feedback: '⚠ Distributes load but identical uncached queries still hammer both nodes.' },
            { label: '🧩 Denormalize', sub: 'Store category in each row', correct: false, feedback: '❌ Already denormalized. The problem is repeated identical reads, not schema.' },
          ],
        },
      };

      const boss = FALLBACKS[topic.concept] ?? FALLBACKS['INDEXING'];
      return { ...boss, ms: topic.ms, concept: topic.concept };
    }

    function renderDBBoss(boss) {
      dbAnswered = false;
      setText(DOM.bossName, boss.bossName);
      setText(DOM.bossMs, boss.ms + 'ms');
      setText($('boss-hp-text'), boss.ms + 'ms');
      setText(DOM.queryDisplay, boss.query);
      setText($('query-stat'), boss.stat);
      setText(DOM.dbFeedback, '// choose a solution to defeat the boss');
      DOM.bossHp.style.width = '100%';

      const shuffled = [...boss.solutions].sort(() => Math.random() - 0.5);
      DOM.solutionGrid.innerHTML = shuffled.map((s, i) => `
    <button class="solution-btn" onclick="attemptSolution(${i})">
      <span class="btn-icon">${s.label.split(' ')[0]}</span>
      ${s.label.slice(s.label.indexOf(' ') + 1)}
      <span class="btn-label">${s.sub}</span>
    </button>
  `).join('');
      DOM.solutionGrid._shuffled = shuffled;
    }

    /** Alias kept for backwards-compat (called from HTML onclick) */
    function renderDBLevel() { generateDBBoss(); }

    function attemptSolution(idx) {
      if (dbAnswered) return;
      if (!currentDBBoss) return;

      const grid = DOM.solutionGrid;
      const sol = grid._shuffled[idx];
      const btns = grid.querySelectorAll('.solution-btn');
      btns[idx].classList.add(sol.correct ? 'correct' : 'wrong');

      setText(DOM.dbFeedback, sol.feedback);

      if (sol.correct) {
        dbAnswered = true;
        const newMs = Math.round(currentDBBoss.ms * 0.03);
        DOM.bossHp.style.width = '0%';
        setText(DOM.bossMs, newMs + 'ms');
        setText($('boss-hp-text'), newMs + 'ms');

        const pts = Math.round((currentDBBoss.ms / 100) * 10);
        dbScore += pts;
        setText(DOM.dbScore, String(dbScore));

        if (!unlockedConcepts.includes(currentDBBoss.concept)) {
          unlockedConcepts.push(currentDBBoss.concept);
          updateKnowledgeTags();
        }

        gainXP('db', 30);
        toast(`⚔ Boss Defeated! +${pts} pts`, 'success');

        setTimeout(() => {
          if (dbLevel < sessionTopics.length - 1) {
            dbLevel++;
            generateDBBoss();
          } else {
            setText(DOM.dbFeedback, '🏆 ALL BOSSES DEFEATED. Database Dungeon complete!');
            toast('🏆 Database Dungeon Cleared!', 'success');
          }
        }, 2500);
      } else {
        toast('Wrong approach — try again', 'warn');
      }
    }

    function updateKnowledgeTags() {
      const tagEls = document.querySelectorAll('#knowledge-tags .knowledge-tag');
      const concepts = ['INDEXING', 'CACHING', 'NORMALIZATION', 'READ REPLICA', 'N+1 FIX', 'SHARDING'];
      tagEls.forEach((tag, i) => {
        tag.style.opacity = unlockedConcepts.includes(concepts[i]) ? '1' : '0.3';
        if (unlockedConcepts.includes(concepts[i])) tag.style.borderColor = '#00cc66';
      });
    }

    // ═══════════════════════════════════════
    // ═══════════════════════════════════════
    // ML LAB — DYNAMIC SIMULATION ENGINE
    // ═══════════════════════════════════════
    // All scores computed at runtime with noise — never hardcoded

    // Module-level state (reset in initMLRealm)
    let mlModule = 'regression';
    let selectedAlgo = null;
    let mlCanvas, mlCtx;
    let mlCleared = [];
    let mlTargets = {};
    let mlRunCount = {};

    const ML_ALGO_PARAMS = {
      regression: {
        'Linear Regression': { baseR2: 0.72, noiseR2: 0.04, overfitGap: 0.02, biasLevel: 2, varLevel: 1 },
        'Polynomial (d=2)': { baseR2: 0.88, noiseR2: 0.03, overfitGap: 0.03, biasLevel: 1, varLevel: 1 },
        'Polynomial (d=8)': { baseR2: 0.62, noiseR2: 0.08, trainBoost: 0.37, overfitGap: 0.38, biasLevel: 0, varLevel: 3 },
        'SVR': { baseR2: 0.84, noiseR2: 0.03, overfitGap: 0.02, biasLevel: 1, varLevel: 1 },
        'Decision Tree': { baseR2: 0.78, noiseR2: 0.05, trainBoost: 0.22, overfitGap: 0.22, biasLevel: 0, varLevel: 2 },
        'Random Forest': { baseR2: 0.91, noiseR2: 0.02, overfitGap: 0.06, biasLevel: 0, varLevel: 1 },
      },
      classification: {
        'Logistic Regression': { baseF1: 0.88, noiseF1: 0.02, overfitGap: 0.01, biasLevel: 1, varLevel: 1 },
        'KNN (k=3)': { baseF1: 0.85, noiseF1: 0.04, trainBoost: 0.14, overfitGap: 0.14, biasLevel: 0, varLevel: 2 },
        'KNN (k=15)': { baseF1: 0.87, noiseF1: 0.03, overfitGap: 0.02, biasLevel: 1, varLevel: 1 },
        'SVM Linear': { baseF1: 0.87, noiseF1: 0.02, overfitGap: 0.02, biasLevel: 1, varLevel: 1 },
        'SVM RBF': { baseF1: 0.93, noiseF1: 0.02, overfitGap: 0.02, biasLevel: 0, varLevel: 1 },
        'Naive Bayes': { baseF1: 0.82, noiseF1: 0.03, overfitGap: 0.01, biasLevel: 1, varLevel: 0 },
        'Random Forest': { baseF1: 0.94, noiseF1: 0.02, overfitGap: 0.03, biasLevel: 0, varLevel: 1 },
      },
      clustering: {
        'K-Means k=2': { baseSil: 0.51, noiseSil: 0.04, biasLevel: 2, varLevel: 1 },
        'K-Means k=4': { baseSil: 0.71, noiseSil: 0.03, biasLevel: 1, varLevel: 1 },
        'K-Means k=8': { baseSil: 0.48, noiseSil: 0.05, biasLevel: 0, varLevel: 2 },
        'K-Means k=12': { baseSil: 0.31, noiseSil: 0.06, biasLevel: 0, varLevel: 3 },
        'Hierarchical': { baseSil: 0.68, noiseSil: 0.03, biasLevel: 1, varLevel: 1 },
        'DBSCAN': { baseSil: 0.73, noiseSil: 0.04, biasLevel: 0, varLevel: 1 },
      },
      rl: {
        'Greedy (ε=0)': { baseReward: 420, noiseReward: 40, biasLevel: 2, varLevel: 1 },
        'ε-Greedy (ε=0.1)': { baseReward: 610, noiseReward: 30, biasLevel: 1, varLevel: 1 },
        'UCB1': { baseReward: 680, noiseReward: 25, biasLevel: 0, varLevel: 1 },
        'Thompson Sampling': { baseReward: 720, noiseReward: 20, biasLevel: 0, varLevel: 0 },
        'Random Baseline': { baseReward: 310, noiseReward: 50, biasLevel: 2, varLevel: 3 },
      },
      nn: {
        '1 Layer (32)': { baseAcc: 0.91, noiseAcc: 0.015, trainBoost: 0.01, overfitGap: 0.01, biasLevel: 2, varLevel: 0 },
        '2 Layers (64,32)': { baseAcc: 0.96, noiseAcc: 0.01, trainBoost: 0.01, overfitGap: 0.01, biasLevel: 1, varLevel: 0 },
        '3 Layers (256,128,64)': { baseAcc: 0.977, noiseAcc: 0.008, trainBoost: 0.013, overfitGap: 0.013, biasLevel: 0, varLevel: 1 },
        'Deep (512×4)': { baseAcc: 0.964, noiseAcc: 0.01, trainBoost: 0.034, overfitGap: 0.034, biasLevel: 0, varLevel: 2 },
        'CNN': { baseAcc: 0.991, noiseAcc: 0.004, trainBoost: 0.004, overfitGap: 0.004, biasLevel: 0, varLevel: 0 },
        'Dropout+BN': { baseAcc: 0.988, noiseAcc: 0.004, trainBoost: 0.004, overfitGap: 0.004, biasLevel: 0, varLevel: 0 },
      }
    };

    const BIAS_LABELS = ['LOW', 'LOW', 'MED', 'HIGH'];
    const VAR_LABELS = ['LOW', 'LOW', 'MED', 'HIGH', 'EXTREME'];
    const OVERFIT_LABELS = ['NONE', 'LOW', 'MED', 'SEVERE'];

    const ML_META = {
      regression: { title: 'Regression Arena', subtitle: '// Predict house prices. Minimize RMSE. Target changes each run.', metric: 'R²', target: () => +(0.83 + Math.random() * 0.04).toFixed(2) },
      classification: { title: 'Classification Arena', subtitle: '// Classify medical data. Maximize F1 score.', metric: 'F1', target: () => +(0.88 + Math.random() * 0.04).toFixed(2) },
      clustering: { title: 'Clustering Zone', subtitle: '// Segment customers. No labels — find the natural groups.', metric: 'Silhouette', target: () => +(0.62 + Math.random() * 0.06).toFixed(2) },
      rl: { title: 'Reinforcement Learning Arena', subtitle: '// Multi-armed bandit. 1000 pulls. Maximise cumulative reward.', metric: 'Reward', target: () => Math.floor(620 + Math.random() * 60) },
      nn: { title: 'Neural Net Lab', subtitle: '// MNIST digit recognition. Beat the val accuracy target.', metric: 'Val Acc', target: () => +(0.965 + Math.random() * 0.02).toFixed(3) },
    };

    function simulateMLResult(module, algo) {
      const p = ML_ALGO_PARAMS[module]?.[algo];
      if (!p) return null;
      const runKey = module + ':' + algo;
      mlRunCount[runKey] = (mlRunCount[runKey] || 0) + 1;
      const runNoise = (Math.random() - 0.5) * 2; // -1..1

      if (module === 'regression') {
        const testR2 = Math.min(0.99, Math.max(0.01, p.baseR2 + runNoise * p.noiseR2));
        const trainR2 = Math.min(0.99, testR2 + (p.trainBoost || 0) + Math.random() * 0.02);
        const overfitLevel = trainR2 - testR2 > 0.25 ? 3 : trainR2 - testR2 > 0.12 ? 2 : trainR2 - testR2 > 0.04 ? 1 : 0;
        return {
          score: +testR2.toFixed(3),
          train: (trainR2 * 100).toFixed(1) + '%', test: (testR2 * 100).toFixed(1) + '%',
          overfit: OVERFIT_LABELS[overfitLevel],
          bias: BIAS_LABELS[p.biasLevel], variance: VAR_LABELS[p.varLevel],
          insight: genInsight(module, algo, testR2, trainR2, overfitLevel)
        };
      }
      if (module === 'classification') {
        const testF1 = Math.min(0.99, Math.max(0.01, p.baseF1 + runNoise * p.noiseF1));
        const trainF1 = Math.min(0.99, testF1 + (p.trainBoost || 0) + Math.random() * 0.02);
        const overfitLevel = trainF1 - testF1 > 0.1 ? 2 : trainF1 - testF1 > 0.04 ? 1 : 0;
        return {
          score: +testF1.toFixed(3),
          train: (trainF1 * 100).toFixed(1) + '%', test: (testF1 * 100).toFixed(1) + '%',
          overfit: OVERFIT_LABELS[overfitLevel],
          bias: BIAS_LABELS[p.biasLevel], variance: VAR_LABELS[p.varLevel],
          insight: genInsight(module, algo, testF1, trainF1, overfitLevel)
        };
      }
      if (module === 'clustering') {
        const sil = Math.min(0.99, Math.max(0.01, p.baseSil + runNoise * p.noiseSil));
        return {
          score: +sil.toFixed(3),
          train: '—', test: '—', overfit: '—',
          bias: BIAS_LABELS[p.biasLevel], variance: VAR_LABELS[p.varLevel],
          insight: genInsight(module, algo, sil, null, 0)
        };
      }
      if (module === 'rl') {
        const reward = Math.round(Math.max(50, p.baseReward + runNoise * p.noiseReward));
        return {
          score: reward,
          train: '—', test: '—', overfit: 'N/A',
          bias: BIAS_LABELS[p.biasLevel], variance: VAR_LABELS[p.varLevel],
          insight: genInsight(module, algo, reward, null, 0)
        };
      }
      if (module === 'nn') {
        const testAcc = Math.min(0.999, Math.max(0.01, p.baseAcc + runNoise * p.noiseAcc));
        const trainAcc = Math.min(0.999, testAcc + (p.trainBoost || 0) + Math.random() * 0.003);
        const overfitLevel = trainAcc - testAcc > 0.025 ? 2 : trainAcc - testAcc > 0.01 ? 1 : 0;
        return {
          score: +testAcc.toFixed(4),
          train: (trainAcc * 100).toFixed(1) + '%', test: (testAcc * 100).toFixed(1) + '%',
          overfit: OVERFIT_LABELS[overfitLevel],
          bias: BIAS_LABELS[p.biasLevel], variance: VAR_LABELS[p.varLevel],
          insight: genInsight(module, algo, testAcc, trainAcc, overfitLevel)
        };
      }
      return null;
    }

    /**
     * Module-level insight generators, keyed by [module][algo].
     * Each is a function so runtime values (score, train, gap) are injected at call time.
     * Separated from simulateMLResult (SRP): simulation produces numbers, this produces prose.
     */
    const ML_INSIGHT_GENERATORS = {
      regression: {
        'Linear Regression': (s, t, gap, ol) => `Linear fit on non-linear data. Test R²: ${fmtS(s)}. High bias — the model can't capture curvature.`,
        'Polynomial (d=2)': (s, t, gap, ol) => `Good bias-variance balance. R²: ${fmtS(s)}. Captures the curve without memorising noise.`,
        'Polynomial (d=8)': (s, t, gap, ol) => `⚠ Classic overfit! Train: ${fmtS(t)} → Test: ${fmtS(s)}. Gap of ${(gap * 100).toFixed(1)}% — memorising noise.`,
        'SVR': (s, t, gap, ol) => `SVR margin ignores outliers. Test R²: ${fmtS(s)}. Robust generalisation.`,
        'Decision Tree': (s, t, gap, ol) => `${ol >= 2 ? '⚠ Overfitting:' : 'Tree fit:'} Train ${fmtS(t)} vs Test ${fmtS(s)}. ${ol >= 2 ? 'Use max_depth to control.' : 'Reasonable split quality.'}`,
        'Random Forest': (s, t, gap, ol) => `✅ Ensemble of trees reduces variance via bagging. R²: ${fmtS(s)}. Best generalisation.`,
      },
      classification: {
        'Logistic Regression': (s, t, gap, ol) => `Solid linear classifier. F1: ${fmtS(s)}. Works well when classes are separable.`,
        'KNN (k=3)': (s, t, gap, ol) => `Small k = sensitive to noise. Train: ${fmtS(t)} Test: ${fmtS(s)}. ${ol >= 1 ? 'Overfitting — increase k.' : 'Low bias but watch variance.'}`,
        'KNN (k=15)': (s, t, gap, ol) => `Larger k smooths decision boundary. F1: ${fmtS(s)}. More robust than k=3.`,
        'SVM Linear': (s, t, gap, ol) => `Linear kernel for linearly separable data. F1: ${fmtS(s)}. Good margin, needs feature scaling.`,
        'SVM RBF': (s, t, gap, ol) => `✅ RBF kernel maps to higher dimensions. F1: ${fmtS(s)}. Handles non-linear boundaries.`,
        'Naive Bayes': (s, t, gap, ol) => `Fast but assumes feature independence. F1: ${fmtS(s)}. Works well despite naive assumption.`,
        'Random Forest': (s, t, gap, ol) => `✅ 100 trees, majority vote. F1: ${fmtS(s)}. Low variance, strong generalization.`,
      },
      clustering: {
        'K-Means k=2': (s) => `Under-segmenting. Silhouette: ${s}. Only 2 clusters merges distinct groups.`,
        'K-Means k=4': (s) => `${s > 0.65 ? '✅ Natural cluster count found' : '⚠ Close but not quite'}. Silhouette: ${s}.`,
        'K-Means k=8': (s) => `Over-segmenting. Silhouette: ${s}. Splitting natural groups creates noise.`,
        'K-Means k=12': (s) => `⚠ Severe over-segmentation. Silhouette: ${s}. Most clusters are artefacts.`,
        'Hierarchical': (s) => `${s > 0.65 ? '✅' : '⚠'} Dendrogram approach. Silhouette: ${s}. No need to predefine K.`,
        'DBSCAN': (s) => `${s > 0.65 ? '✅' : '⚠'} Density-based — handles arbitrary shapes. Silhouette: ${s}.`,
      },
      rl: {
        'Greedy (ε=0)': (s) => `Pure exploitation. Reward: ${s}. Locks on first good arm — never explores better ones.`,
        'ε-Greedy (ε=0.1)': (s) => `${s >= 650 ? '✅' : '⚠'} 10% exploration. Reward: ${s}. Classic tradeoff — finds better arms over time.`,
        'UCB1': (s) => `${s >= 650 ? '✅' : '⚠'} Upper confidence bound. Reward: ${s}. Explores uncertain arms, exploits known ones.`,
        'Thompson Sampling': (s) => `${s >= 650 ? '🏆' : '✅'} Bayesian sampling. Reward: ${s}. Naturally balances explore/exploit via posterior.`,
        'Random Baseline': (s) => `No learning. Reward: ${s}. Lower bound baseline only.`,
      },
      nn: {
        '1 Layer (32)': (s, t, gap, ol) => `Too shallow. Val: ${fmtS(s)}. Can't learn complex digit patterns. Underfitting.`,
        '2 Layers (64,32)': (s, t, gap, ol) => `Good start. Val: ${fmtS(s)}. Two layers extract richer features.`,
        '3 Layers (256,128,64)': (s, t, gap, ol) => `${s >= 0.975 ? '✅' : '⚠'} Depth pays off. Val: ${fmtS(s)}. Train: ${fmtS(t)}.`,
        'Deep (512×4)': (s, t, gap, ol) => `${ol >= 2 ? '⚠ Overfitting without regularization:' : 'Deep network:'} Train ${fmtS(t)} vs Val ${fmtS(s)}.`,
        'CNN': (s, t, gap, ol) => `✅ Convolutional layers exploit spatial structure. Val: ${fmtS(s)}. Superior for vision.`,
        'Dropout+BN': (s, t, gap, ol) => `🏆 Regularization master. Val: ${fmtS(s)}. Dropout + BatchNorm prevent co-adaptation.`,
      },
    };

    /** Format a score: percentages if < 2, round int otherwise. */
    function fmtS(s) { return s == null ? '—' : s < 2 ? (s * 100).toFixed(1) + '%' : Math.round(s).toString(); }

    /** Dispatch to the correct insight generator. */
    function genInsight(module, algo, score, trainScore, overfitLevel) {
      const gap = trainScore != null ? trainScore - score : 0;
      const gen = ML_INSIGHT_GENERATORS[module]?.[algo];
      return gen ? gen(score, trainScore, gap, overfitLevel) : `Score: ${fmtS(score)}`;
    }

    const ML_MODULES = {
      regression: { algos: ['Linear Regression', 'Polynomial (d=2)', 'Polynomial (d=8)', 'SVR', 'Decision Tree', 'Random Forest'] },
      classification: { algos: ['Logistic Regression', 'KNN (k=3)', 'KNN (k=15)', 'SVM Linear', 'SVM RBF', 'Naive Bayes', 'Random Forest'] },
      clustering: { algos: ['K-Means k=2', 'K-Means k=4', 'K-Means k=8', 'K-Means k=12', 'Hierarchical', 'DBSCAN'] },
      rl: { algos: ['Greedy (ε=0)', 'ε-Greedy (ε=0.1)', 'UCB1', 'Thompson Sampling', 'Random Baseline'] },
      nn: { algos: ['1 Layer (32)', '2 Layers (64,32)', '3 Layers (256,128,64)', 'Deep (512×4)', 'CNN', 'Dropout+BN'] },
    };

    function initMLRealm() {
      mlCanvas = $('ml-canvas');
      mlCtx = mlCanvas.getContext('2d');
      mlModule = 'regression';
      selectedAlgo = null;
      mlCleared = [];
      mlRunCount = {};
      mlTargets = {};
      Object.keys(ML_META).forEach(m => { mlTargets[m] = ML_META[m].target(); });
      renderMLModule();
    }

    function renderMLModule() {
      const meta = ML_META[mlModule];
      const m = ML_MODULES[mlModule];
      const targetVal = mlTargets[mlModule];
      const targetStr = mlModule === 'rl' ? `Reward > ${targetVal}`
        : mlModule === 'nn' ? `Val Acc > ${(targetVal * 100).toFixed(1)}%`
          : `${meta.metric} > ${(targetVal * 100).toFixed(0)}%`;

      setText(DOM.mlTitle, meta.title);
      setText(DOM.mlSubtitle, meta.subtitle);
      setText(DOM.mlTarget, `🎯 TARGET: ${targetStr}`);

      DOM.algoGrid.innerHTML = m.algos.map(a =>
        `<button class="algo-btn ${selectedAlgo === a ? 'selected' : ''}" onclick="selectAlgo('${a}')">${a}</button>`
      ).join('');

      DOM.accuracyDisplay.style.display = 'none';
      setText(DOM.mlRunStatus, '');
      setText(DOM.mlTrain, '—');
      setText(DOM.mlTest, '—');
      setText(DOM.mlOverfit, '—');
      setText(DOM.mlBias, '—');
      setText(DOM.mlVar, '—');
      setText(DOM.mlInsight, '// select an algorithm and run to see analysis');

      drawMLCanvas();
    }

    function selectAlgo(algo) {
      selectedAlgo = algo;
      renderMLModule();
    }

    function runML() {
      if (!selectedAlgo) { toast('Select an algorithm first!', 'warn'); return; }

      setText(DOM.mlRunStatus, '// training...');

      const COMPLEXITY_MS = { 'Random Forest': 1600, 'CNN': 2000, 'Deep (512×4)': 1800, 'Thompson Sampling': 1400 };
      const trainTime = COMPLEXITY_MS[selectedAlgo] ?? (1000 + Math.random() * 400);

      setTimeout(() => {
        const result = simulateMLResult(mlModule, selectedAlgo);
        if (!result) return;

        setText(DOM.mlRunStatus, '// training complete');

        const meta = ML_META[mlModule];
        const targetVal = mlTargets[mlModule];
        const scoreDisplay = mlModule === 'rl' ? result.score.toString()
          : mlModule === 'nn' ? (result.score * 100).toFixed(2) + '%'
            : (result.score * 100).toFixed(1) + '%';

        setText(DOM.accuracyNumber, scoreDisplay);
        setText(DOM.accuracyLabel, meta.metric + ' SCORE');
        DOM.accuracyDisplay.style.display = 'block';

        const overfitCls = result.overfit === 'NONE' || result.overfit === 'LOW' ? 'good'
          : result.overfit === 'MED' ? 'warn' : 'danger';

        setText(DOM.mlTrain, result.train);
        setText(DOM.mlTest, result.test);
        setText(DOM.mlOverfit, result.overfit, 'metric-value ' + overfitCls);
        setText(DOM.mlBias, result.bias);
        setText(DOM.mlVar, result.variance);
        setText(DOM.mlInsight, result.insight);

        drawMLResults(result);

        const targetMet = result.score >= targetVal;

        if (targetMet && !mlCleared.includes(mlModule)) {
          mlCleared.push(mlModule);
          gainXP('ml', 50);
          toast(`🏆 Module Cleared: ${meta.title}`, 'success');
          updateMLCleared();
          unlockNextMLModule();
        } else if (targetMet) {
          gainXP('ml', 10);
          toast(`✅ Target hit! (${scoreDisplay})`, 'success');
        } else {
          const targetFmt = mlModule === 'rl' ? targetVal : (targetVal * 100).toFixed(1) + '%';
          toast(`Target not met (${scoreDisplay} < ${targetFmt}) — try another algorithm`, 'warn');
        }
      }, trainTime);
    }

    function switchML(mod) {
      if (mod !== 'regression' && !mlCleared.includes(getMLPrev(mod))) {
        toast('Complete the previous module first!', 'warn'); return;
      }
      mlModule = mod; selectedAlgo = null;
      document.querySelectorAll('.ml-nav-item').forEach(i => i.classList.remove('active'));
      $('nav-' + mod)?.classList.add('active');
      renderMLModule();
    }

    function getMLPrev(mod) {
      const i = ML_ORDER.indexOf(mod);
      return i > 0 ? ML_ORDER[i - 1] : null;
    }

    // ML order constant — used by switchML, getMLPrev, unlockNextMLModule
    const ML_ORDER = ['regression', 'classification', 'clustering', 'rl', 'nn'];

    function unlockNextMLModule() {
      const idx = ML_ORDER.indexOf(mlModule);
      if (idx < ML_ORDER.length - 1) {
        const next = ML_ORDER[idx + 1];
        const navEl = $('nav-' + next);
        if (navEl) navEl.style.opacity = '1';
        toast(`🔓 Unlocked: ${ML_META[next].title}`, 'success');
      }
    }

    function updateMLCleared() {
      const el = $('ml-cleared');
      if (!el) return;
      el.innerHTML = mlCleared
        .map(m => `<div style="font-family:'Share Tech Mono',monospace;font-size:0.6rem;color:#00cc66;margin-bottom:0.3rem">✅ ${ML_META[m].title}</div>`)
        .join('');
    }

    function drawMLCanvas() {
      if (!mlCtx) return;

      const dpr = window.devicePixelRatio || 1;
      const w = mlCanvas.clientWidth;
      const h = mlCanvas.clientHeight;

      mlCanvas.width = w * dpr;
      mlCanvas.height = h * dpr;
      mlCtx.setTransform(dpr, 0, 0, dpr, 0, 0);

      mlCtx.clearRect(0, 0, w, h);

      // Background grid
      mlCtx.strokeStyle = 'rgba(42,21,21,0.4)';
      mlCtx.lineWidth = 0.5;
      for (let x = 0; x < w; x += 30) { mlCtx.beginPath(); mlCtx.moveTo(x, 0); mlCtx.lineTo(x, h); mlCtx.stroke(); }
      for (let y = 0; y < h; y += 30) { mlCtx.beginPath(); mlCtx.moveTo(0, y); mlCtx.lineTo(w, y); mlCtx.stroke(); }

      // Axes
      mlCtx.strokeStyle = 'rgba(139,0,0,0.6)';
      mlCtx.lineWidth = 1;
      mlCtx.beginPath(); mlCtx.moveTo(40, h - 40); mlCtx.lineTo(w - 20, h - 40); mlCtx.stroke();
      mlCtx.beginPath(); mlCtx.moveTo(40, 20); mlCtx.lineTo(40, h - 40); mlCtx.stroke();

      // Generate data points based on module
      const pts = generateDataPoints(mlModule, w, h);
      pts.forEach(p => {
        mlCtx.beginPath();
        mlCtx.fillStyle = p.color || 'rgba(220,20,60,0.7)';
        mlCtx.arc(p.x, p.y, 3, 0, Math.PI * 2);
        mlCtx.fill();
      });

      // Label
      mlCtx.fillStyle = 'rgba(160,152,144,0.4)';
      mlCtx.font = '10px Share Tech Mono';
      mlCtx.textAlign = 'left';
      mlCtx.fillText('// select algorithm to see fit', 50, 25);
    }

    function generateDataPoints(module, w, h) {
      const pts = [];
      const rng = seededRng(42);
      const pad = 60;
      const uw = w - pad * 2, uh = h - pad * 2;

      if (module === 'regression') {
        for (let i = 0; i < 80; i++) {
          const x = rng() * uw + pad;
          const norm = (x - pad) / uw;
          const y = (h - pad) - (Math.sin(norm * Math.PI * 2) * 0.4 + norm * 0.5 + (rng() - 0.5) * 0.2) * uh * 0.8;
          pts.push({ x, y, color: 'rgba(220,20,60,0.7)' });
        }
      } else if (module === 'classification') {
        const clusters = [
          { cx: 0.3, cy: 0.35, color: 'rgba(220,20,60,0.75)' },
          { cx: 0.7, cy: 0.65, color: 'rgba(68,136,255,0.75)' }
        ];
        clusters.forEach(c => {
          for (let i = 0; i < 40; i++) {
            const x = (c.cx + (rng() - 0.5) * 0.3) * uw + pad;
            const y = (h - pad) - (c.cy + (rng() - 0.5) * 0.3) * uh;
            pts.push({ x, y, color: c.color });
          }
        });
      } else if (module === 'clustering') {
        const cs = [{ x: 0.25, y: 0.3 }, { x: 0.7, y: 0.25 }, { x: 0.3, y: 0.7 }, { x: 0.72, y: 0.72 }];
        const colors = ['rgba(220,20,60,0.7)', 'rgba(0,204,102,0.7)', 'rgba(255,140,0,0.7)', 'rgba(68,136,255,0.7)'];
        cs.forEach((c, ci) => {
          for (let i = 0; i < 20; i++) {
            const x = (c.x + (rng() - 0.5) * 0.2) * uw + pad;
            const y = (h - pad) - (c.y + (rng() - 0.5) * 0.2) * uh;
            pts.push({ x, y, color: colors[ci] });
          }
        });
      } else if (module === 'rl') {
        // Cumulative reward over steps
        for (let i = 0; i < 100; i++) {
          const x = (i / 99) * uw + pad;
          const y = (h - pad) - (i / 99 * 0.5 + rng() * 0.3) * uh * 0.8;
          pts.push({ x, y, color: 'rgba(201,168,76,0.6)' });
        }
      } else if (module === 'nn') {
        // Loss curves
        for (let i = 0; i < 50; i++) {
          const x = (i / 49) * uw + pad;
          const loss = 0.9 * Math.exp(-i / 15) + rng() * 0.05;
          const y = (h - pad) - (1 - loss) * uh * 0.7;
          pts.push({ x, y, color: 'rgba(220,20,60,0.6)' });
        }
      }
      return pts;
    }

    function drawMLResults(result) {
      if (!mlCtx) return;
      const w = mlCanvas.clientWidth, h = mlCanvas.clientHeight;
      drawMLCanvas();

      const pad = 60, uw = w - pad * 2, uh = h - pad * 2;

      if (mlModule === 'regression') {
        // Draw fit line
        mlCtx.beginPath();
        mlCtx.strokeStyle = result.overfit === 'SEVERE' ? 'rgba(255,68,68,0.9)' : 'rgba(201,168,76,0.9)';
        mlCtx.lineWidth = 2;

        if (selectedAlgo?.includes('Polynomial (d=8)')) {
          // Wiggly overfit curve
          for (let x = pad; x < w - pad; x += 2) {
            const t = (x - pad) / uw;
            const base = Math.sin(t * Math.PI * 2) * 0.4 + t * 0.5;
            const overfit = Math.sin(t * 25) * 0.15 + Math.cos(t * 18) * 0.1;
            const y = (h - pad) - (base + overfit) * uh * 0.8;
            x === pad ? mlCtx.moveTo(x, y) : mlCtx.lineTo(x, y);
          }
        } else {
          for (let x = pad; x < w - pad; x += 2) {
            const t = (x - pad) / uw;
            const y = (h - pad) - (Math.sin(t * Math.PI * 2) * 0.4 + t * 0.5) * uh * 0.75;
            x === pad ? mlCtx.moveTo(x, y) : mlCtx.lineTo(x, y);
          }
        }
        mlCtx.stroke();
      } else if (mlModule === 'classification') {
        // Decision boundary
        mlCtx.beginPath();
        mlCtx.strokeStyle = 'rgba(201,168,76,0.8)';
        mlCtx.lineWidth = 2;
        mlCtx.setLineDash([5, 3]);
        const midX = w * 0.5, midY = h * 0.5;
        mlCtx.moveTo(pad, h - pad - uh * 0.95);
        mlCtx.lineTo(w - pad, h - pad - uh * 0.05);
        mlCtx.stroke();
        mlCtx.setLineDash([]);
      } else if (mlModule === 'rl') {
        // Draw strategy reward curve
        const rng = seededRng(123);
        mlCtx.beginPath();
        mlCtx.strokeStyle = 'rgba(0,204,102,0.9)';
        mlCtx.lineWidth = 2;
        const maxR = { 'Thompson Sampling': 720, 'UCB1': 680, 'ε-Greedy (ε=0.1)': 610, 'Greedy (ε=0)': 420, 'Random Baseline': 310 };
        const maxVal = maxR[selectedAlgo] || 500;
        for (let i = 0; i < 100; i++) {
          const x = (i / 99) * uw + pad;
          const prog = maxVal * (1 - Math.exp(-i / 20)) + rng() * 20;
          const y = (h - pad) - (prog / 800) * uh * 0.85;
          i === 0 ? mlCtx.moveTo(x, y) : mlCtx.lineTo(x, y);
        }
        mlCtx.stroke();
      }
    }

    function seededRng(seed) {
      let s = seed;
      return () => { s = (s * 1664525 + 1013904223) & 0xffffffff; return (s >>> 0) / 0xffffffff; };
    }

    // ═══════════════════════════════════════
    // DEVOPS REALM
    // ═══════════════════════════════════════
    let pipelineStages = [];
    let deployStreak = 0, deployCount = 0;    // deployCount kept for backward compat; doraMetrics is source of truth

    function initDevOps() {
      pipelineStages = [];
      deployStreak = 0;
      deployCount = 0;
      doraMetrics = { deploys: 0, successes: 0, failures: 0, totalLeadTime: 0, totalMttr: 0, mttrCount: 0 };
      setupDragDrop();
    }

    function setupDragDrop() {
      const pool = $('stage-pool');
      const track = $('pipeline-track');

      pool.querySelectorAll('.pipeline-stage').forEach(stage => {
        stage.addEventListener('dragstart', e => {
          e.dataTransfer.setData('stage', stage.dataset.stage);
          stage.classList.add('dragging');
        });
        stage.addEventListener('dragend', () => stage.classList.remove('dragging'));
      });

      track.addEventListener('dragover', e => { e.preventDefault(); track.classList.add('drag-over'); });
      track.addEventListener('dragleave', () => track.classList.remove('drag-over'));
      track.addEventListener('drop', e => {
        e.preventDefault();
        track.classList.remove('drag-over');
        const stageId = e.dataTransfer.getData('stage');
        if (stageId && !pipelineStages.includes(stageId)) {
          pipelineStages.push(stageId);
          renderTrack();
        }
      });
    }

    function renderTrack() {
      const track = $('pipeline-track');
      if (pipelineStages.length === 0) {
        track.classList.add('empty');
        track.innerHTML = '';
        return;
      }
      track.classList.remove('empty');
      const labels = {
        'source': '📁 SOURCE', 'lint': '🔍 LINT', 'unit-test': '🧪 UNIT TESTS',
        'integration': '🔗 INTEGRATION', 'security': '🔐 SECURITY', 'build': '🏗 BUILD',
        'docker': '🐳 DOCKERIZE', 'staging': '🌐 STAGING', 'canary': '🐦 CANARY',
        'prod': '🚀 PROD', 'monitor': '📊 MONITOR'
      };
      track.innerHTML = pipelineStages.map((s, i) => `
    <div class="pipeline-stage-placed" id="placed-${s}" onclick="removePipelineStage('${s}')">
      ${labels[s] || s}
    </div>
    ${i < pipelineStages.length - 1 ? '<span style="color:var(--blood);font-size:0.8rem">→</span>' : ''}
  `).join('');
    }

    function removePipelineStage(stage) {
      pipelineStages = pipelineStages.filter(s => s !== stage);
      renderTrack();
    }

    function clearPipeline() {
      pipelineStages = [];
      renderTrack();
      $('pipeline-result').innerHTML = '';
    }

    // Stage failure probabilities — based on real CI/CD failure patterns
    const STAGE_FAIL_BASE = {
      'source': 0.02, 'lint': 0.08, 'unit-test': 0.12, 'integration': 0.20,
      'security': 0.15, 'build': 0.05, 'docker': 0.04, 'staging': 0.10,
      'canary': 0.06, 'prod': 0.04, 'monitor': 0.01
    };

    // Stage durations (ms) simulate real build time
    const STAGE_DURATION = {
      'source': 300, 'lint': 500, 'unit-test': 900, 'integration': 1400,
      'security': 800, 'build': 1100, 'docker': 700, 'staging': 600,
      'canary': 500, 'prod': 400, 'monitor': 300
    };

    // Session-accumulated DORA metrics
    let doraMetrics = { deploys: 0, successes: 0, failures: 0, totalLeadTime: 0, totalMttr: 0, mttrCount: 0 };

    /** Contextual failure reasons per stage — used by _executePipeline. */
    const STAGE_FAIL_REASONS = {
      'unit-test': ['assertion failed: expected 200 got 500', 'NullPointerException in UserService.java:143', '3 tests failed, 47 passed'],
      'integration': ['timeout: external service 504', 'DB connection pool exhausted', 'schema mismatch on v2 endpoint'],
      'security': ['CVE-2024-1234 in dependency', 'hardcoded secret detected', 'OWASP: SQL injection risk'],
      'lint': ['line 247: unused import', 'max line length exceeded (142 > 100)', '2 linting violations'],
      'build': ['compilation error: missing dependency', 'OOM during build: heap exhausted', 'module resolution failed'],
      'prod': ['health check failed (3/3 attempts)', 'rollout timeout exceeded', 'pod CrashLoopBackoff'],
    };

    /** Success log message per stage. Functions receive stage duration for realistic timing. */
    const STAGE_SUCCESS_MSGS = {
      source: _dur => `📁 source cloned — ${Math.floor(Math.random() * 50 + 20)} files changed`,
      lint: _dur => `🔍 lint clean — ${Math.floor(Math.random() * 200 + 800)} lines checked`,
      'unit-test': dur => `🧪 ${Math.floor(Math.random() * 20 + 80)} tests passed (${(dur / 1000).toFixed(1)}s)`,
      integration: _dur => `🔗 integration OK — 12 endpoints verified`,
      security: _dur => '🔐 no critical CVEs — scan complete',
      build: _dur => `🏗 build succeeded — ${(Math.random() * 2 + 1).toFixed(1)}MB artifact`,
      docker: _dur => '🐳 image pushed to registry',
      staging: _dur => `🌐 staging healthy — p95 latency ${Math.floor(Math.random() * 30 + 20)}ms`,
      canary: _dur => `🐦 canary stable — error rate ${(Math.random() * 0.5).toFixed(2)}%`,
      prod: _dur => `🚀 prod deployed — ${Math.floor(Math.random() * 3 + 1)} replicas updated`,
      monitor: _dur => '📊 dashboards live — alerting armed',
    };

    /** Module-level pipeline logger — prepends entries to the pipeline log panel. */
    function plog(msg, type = '') {
      const pipLog = $('pipeline-log');
      if (!pipLog) return;
      const d = document.createElement('div');
      d.className = 'log-entry ' + type;
      d.textContent = msg;
      pipLog.prepend(d);
    }

    async function runPipeline() {
      if (pipelineStages.length < 3) { toast('Add at least 3 stages!', 'warn'); return; }

      try {
        await _executePipeline();
      } catch (err) {
        toast('Pipeline runner encountered an unexpected error', 'warn');
        plog('❌ Pipeline runner error — check console', 'danger');
        console.error('runPipeline:', err);
      }
    }

    /** Inner pipeline execution — separated so try/catch in runPipeline stays readable. */
    async function _executePipeline() {
      // Analyse pipeline shape — affects failure multipliers
      const has = s => pipelineStages.includes(s);
      const hasTests = has('unit-test') || has('integration');
      const hasBuild = has('build') || has('docker');
      const hasMonitor = has('monitor');
      const hasSecurity = has('security');
      const hasCanary = has('canary');
      const hasStaging = has('staging');
      const correctOrder = pipelineStages.indexOf('source') <= 0;

      // Failure probability multipliers driven by pipeline quality
      const failMult = {
        'prod': hasBuild && hasTests ? 0.3 : !hasTests ? 3.5 : !hasBuild ? 4.0 : 1.0,
        'integration': hasTests ? 1.0 : 1.8,
        'canary': hasStaging ? 0.5 : 1.4,
        'unit-test': correctOrder ? 1.0 : 1.5,
      };

      const pipLog = $('pipeline-log');
      if (pipLog) pipLog.innerHTML = '';

      doraMetrics.deploys++;
      deployCount++;
      const runStart = Date.now();
      const commitHash = ['a3f9c12', 'b72e841', 'c91d3f7', 'd45ab20', 'e18c63f'][Math.floor(Math.random() * 5)];

      plog(`// commit ${commitHash} triggered pipeline`, 'good');
      setText($('dv-freq'), doraMetrics.deploys + ' this session');

      let failed = false;
      let failedStage = null;

      for (const s of pipelineStages) {
        const el = $('placed-' + s);
        if (el) el.classList.add('running');

        const dur = (STAGE_DURATION[s] || 600) + Math.floor(Math.random() * 300);
        await delay(dur);

        const baseChance = STAGE_FAIL_BASE[s] || 0.05;
        const mult = failMult[s] || 1.0;
        const fatigue = Math.min(1.5, 1 + doraMetrics.deploys * 0.03);
        const failChance = Math.min(0.95, baseChance * mult * fatigue);

        if (Math.random() < failChance) {
          if (el) { el.classList.remove('running'); el.classList.add('failed'); }
          const reasons = STAGE_FAIL_REASONS[s] || ['unexpected error'];
          const reason = reasons[Math.floor(Math.random() * reasons.length)];
          plog(`❌ ${s.toUpperCase()} FAILED — ${reason}`, 'danger');
          failed = true;
          failedStage = s;
          break;
        }

        if (el) { el.classList.remove('running'); el.classList.add('passed'); }
        plog(STAGE_SUCCESS_MSGS[s]?.(dur) ?? `✅ ${s} passed`, 'good');
      }

      const leadTime = ((Date.now() - runStart) / 1000).toFixed(1);
      doraMetrics.totalLeadTime += parseFloat(leadTime);

      if (failed) {
        _handlePipelineFailure(failedStage, hasTests, hasStaging);
      } else {
        _handlePipelineSuccess(hasTests, hasBuild, hasMonitor, hasSecurity, hasCanary, hasStaging);
      }
    }

    function _handlePipelineFailure(failedStage, hasTests, hasStaging) {
      doraMetrics.failures++;
      deployStreak = 0;
      const mttr = Math.floor(Math.random() * 20 + 5);
      doraMetrics.totalMttr += mttr;
      doraMetrics.mttrCount++;

      setText($('deploy-streak'), '0');
      setText($('dv-fail'), Math.round(doraMetrics.failures / doraMetrics.deploys * 100) + '%');
      setText($('dv-mttr'), Math.round(doraMetrics.totalMttr / doraMetrics.mttrCount) + 'min');
      setText($('dv-lead'), (doraMetrics.totalLeadTime / doraMetrics.deploys).toFixed(1) + 's');

      plog(`// MTTR estimate: ${mttr}min — fix ${failedStage} and redeploy`, 'warn');
      toast(`❌ Failed at ${failedStage}! Streak reset.`, 'warn');

      if (failedStage === 'prod' && !hasTests) plog('💡 Add unit-test + integration before prod', 'warn');
      if (failedStage === 'security') plog('💡 Run security scan before build stage', 'warn');
      if (failedStage === 'integration' && !hasStaging) plog('💡 Add staging before integration tests', 'warn');
    }

    function _handlePipelineSuccess(hasTests, hasBuild, hasMonitor, hasSecurity, hasCanary, hasStaging) {
      doraMetrics.successes++;
      deployStreak++;

      const avgLead = (doraMetrics.totalLeadTime / doraMetrics.deploys).toFixed(1);
      const failRate = Math.round(doraMetrics.failures / doraMetrics.deploys * 100);
      const avgMttr = doraMetrics.mttrCount > 0
        ? Math.round(doraMetrics.totalMttr / doraMetrics.mttrCount) + 'min'
        : 'N/A';

      setText($('deploy-streak'), String(deployStreak));
      setText($('dv-lead'), avgLead + 's');
      setText($('dv-fail'), failRate + '%');
      setText($('dv-mttr'), hasMonitor ? avgMttr : '?');

      let quality = 0;
      if (hasTests) quality += 30;
      if (hasBuild) quality += 20;
      if (hasMonitor) quality += 20;
      if (hasSecurity) quality += 15;
      if (hasCanary) quality += 10;
      if (hasStaging) quality += 5;

      gainXP('devops', Math.round(quality * 0.5));
      plog(`🚀 DEPLOY SUCCESS — quality: ${quality}% — streak: ${deployStreak}`, 'good');
      toast(`✅ Deployed! Quality: ${quality}% | Streak: ${deployStreak}`, 'success');

      if (!hasMonitor) plog('⚠ No monitor — flying blind in prod', 'warn');
      if (!hasSecurity) plog('⚠ No security scan — unknown vulnerabilities', 'warn');
      if (!hasCanary && !hasStaging) plog('⚠ Direct to prod — consider canary or staging', 'warn');
      if (!hasTests) plog('⚠ No tests — lucky this time', 'warn');
    }

    function delay(ms) { return new Promise(r => setTimeout(r, ms)); }

    // ═══════════════════════════════════════
    // XP SYSTEM
    // ═══════════════════════════════════════
    const xpState = { sys: 0, db: 20, ml: 0, devops: 0 };

    function gainXP(realm, amount) {
      xpState[realm] = Math.min(100, xpState[realm] + amount);
      const map = { sys: 'sys', db: 'db', ml: 'ml', devops: 'devops' };
      const key = map[realm];
      const fill = $(key + '-xp-fill');
      const val = $(key + '-xp-val');
      if (fill) fill.style.width = xpState[realm] + '%';
      if (val) val.textContent = xpState[realm];
    }

    // ═══════════════════════════════════════
    // CHATBOT (GEMINI)
    // ═══════════════════════════════════════
    let chatOpen = false;
    let chatMode = 'explain';

    function toggleChat() {
      chatOpen = !chatOpen;
      $('chat-panel').classList.toggle('open', chatOpen);
    }

    function setChatMode(mode) {
      chatMode = mode;
      document.querySelectorAll('.chat-mode-btn').forEach(b => b.classList.remove('active'));
      $('mode-' + mode)?.classList.add('active');

      const hints = {
        explain: 'Ask me to explain any concept from this arcade — algorithms, system design, DB optimisation, CI/CD. Or ask about Zakhir\'s projects and experience.',
        interview: 'I\'ll run a mock backend or ML interview with you. Answer my questions and I\'ll give honest, scored feedback. Type "start" to begin.',
        about: 'Ask me anything about Zakhir — his skills, projects, experience at COGENT, or why you should hire him.',
      };
      addChatMsg('bot', hints[mode]);
    }

    function addChatMsg(role, text) {
      const msgs = DOM.chatMessages;
      const div = document.createElement('div');
      div.className = `chat-msg ${role}`;
      div.textContent = text;
      msgs.appendChild(div);
      msgs.scrollTop = msgs.scrollHeight;
      return div;
    }

    // ── Zakhir's profile — injected into every prompt so The Oracle knows who built this ──
    const ZAKHIR_PROFILE = `
ABOUT THE DEVELOPER — Zakhir Keane McKinnon:
- Junior software developer based in South Africa
- Diploma: ICT in Applications Development, Cape Peninsula University of Technology (2025)
- 5 months Work Integrated Learning at COGENT (Aug–Dec 2025): Azure DevOps, C#, ABP Framework, Blue Prism RPA, AI-assisted automation with Copilot agents
- Has been coding since high school
- Email: Zakhirmckinnon2016@gmail.com | Portfolio: https://flyinginsectsunpig.github.io/Personal-Website/

TECHNICAL SKILLS:
- Languages: Java, Python, TypeScript, HTML/CSS, SQL, C#
- Frameworks/Libraries: React, Spring Boot, Three.js, Node.js, Pandas, NumPy, Scikit-learn, Keras, Matplotlib
- Tools: Azure DevOps, Git/GitHub, Blue Prism RPA, REST APIs
- Concepts: Machine Learning, Data Analysis, OOP, Design Patterns, CI/CD

PROJECTS:
1. Backend Arcade (this portfolio) — interactive gamified single-page portfolio built in vanilla JS/Canvas. Features: live system design simulator with real queueing math, DB Dungeon boss fights with Gemini-generated SQL scenarios, ML Lab with formula-based algorithm scoring, DevOps Arena pipeline builder with DORA metrics, Gemini-powered AI chatbot. Proves backend depth through playable simulations.

2. PrintIt101 & PrintIt101client — Collaborative 3D T-shirt customisation platform (team project)
   - Frontend: TypeScript, React, Three.js for real-time 3D rendering and logo placement
   - Backend: Java Spring Boot, file upload handling, transformation calculations, REST APIs
   - Design patterns: Builder and Factory for clean, extensible architecture
   - Team workflow: Git, code reviews

3. LoL-Skin-Buff-Nerf — League of Legends patch changes viewer
   - Python scraping/parsing of official patch notes to extract champion buffs/nerfs and skin changes
   - Frontend: HTML/CSS for clean, focused display
   - ML classification to predict buff/nerf impact
   - Shows data processing and real-time web data skills

COURSES COMPLETED:
- Machine Learning A-Z: AI, Python & R
- Ethereum Blockchain Developer Bootcamp with Solidity
- Azure Fundamentals (AZ900)

PERSONALITY / HOW TO REPRESENT HIM:
Zakhir is enthusiastic, self-driven, and deeply passionate about building things that work well. He doesn't just follow tutorials — he builds real projects that demonstrate depth. The Backend Arcade itself is proof: every realm is a playable simulation of a real engineering concept, not a slide deck. He is looking for junior developer roles where he can grow fast and contribute immediately.
`.trim();

    const CHAT_SYSTEM_PROMPTS = {
      explain: () => `You are The Oracle — a technical guide embedded in "Backend Arcade", the gamified portfolio of Zakhir McKinnon.

${ZAKHIR_PROFILE}

Current realm the visitor is exploring: ${currentRealm || 'main menu'}.

Your job: explain technical concepts clearly and concisely — algorithms, system design, database patterns, CI/CD, ML. Be slightly dramatic and engaging, like a guide in an arcade. If asked about concepts demonstrated in the current realm, tie your explanation back to what Zakhir built. Keep replies under 5 sentences unless real depth is needed. Never be vague — give specific, accurate technical answers.`,

      interview: () => `You are a senior backend engineering interviewer running a mock interview inside "Backend Arcade", the gamified portfolio of Zakhir McKinnon.

${ZAKHIR_PROFILE}

Current realm: ${currentRealm || 'main menu'}.
Topic area: ${currentRealm === 'ml' ? 'ML algorithms, model evaluation, bias-variance tradeoff, overfitting' : currentRealm === 'db' ? 'SQL, indexing, query optimisation, N+1 problem, normalisation' : currentRealm === 'devops' ? 'CI/CD, DORA metrics, deployment strategies, pipeline design' : 'backend systems, scalability, distributed systems, APIs, Java/Spring Boot'}.

Your job: Either ask ONE tough, specific technical interview question relevant to the topic area — OR if the user has just answered a question, give them a rating (1–5) with specific, honest feedback referencing what a strong answer would have included. Be direct. Don't be easy on them. If they answer well, say so. If not, explain exactly what was missing. After feedback, ask the next question.`,

      about: () => `You are The Oracle — the voice of "Backend Arcade", the gamified portfolio built by Zakhir McKinnon. A visitor is asking about Zakhir.

${ZAKHIR_PROFILE}

Your job: Answer questions about Zakhir warmly but factually. Sell his strengths genuinely — don't oversell, but do make the case for why he'd be a great hire. If asked about something not in his profile, be honest about what you don't know rather than inventing details. If a visitor asks whether Zakhir is a good fit for a role, assess it honestly based on his actual skills. Keep replies concise — 3–5 sentences max unless a detailed answer is clearly needed.`,
    };

    async function sendChat() {
      const input = DOM.chatInput;
      const text = input.value.trim();
      if (!text) return;
      input.value = '';

      addChatMsg('user', text);
      const typing = addChatMsg('bot', '// thinking...');
      typing.classList.add('typing');

      const systemPrompt = CHAT_SYSTEM_PROMPTS[chatMode]?.() ?? '';
      const fullPrompt = `${systemPrompt}\n\nUser: ${text}`;

      try {
        const reply = await callGemini(fullPrompt, GEMINI_TEMP_CHAT, 400);
        typing.classList.remove('typing');
        typing.textContent = reply || 'The Oracle stirs but returns no answer. Try again.';
      } catch (e) {
        typing.classList.remove('typing');
        typing.textContent = `Oracle error: ${e.message}. (Works on GitHub Pages — browser sandbox blocks fetch here.)`;
        console.error('sendChat Gemini error:', e);
      }

      DOM.chatMessages.scrollTop = 999_999;
    }

    // ═══════════════════════════════════════
    // HIRE ME PAGE
    // ═══════════════════════════════════════
    const HIRE_MODES = {
      automation: {
        tag: 'AUTOMATION & AI LENS',
        headline: 'I automate the tedious<br>and accelerate the complex.',
        subline: `I blend backend systems thinking with <strong>enterprise RPA, Azure DevOps, and AI-assisted tooling</strong>. I build intelligent workflows that save hours of human effort.`,
        cards: [
          { icon: '🤖', title: 'AI & Copilot Agents', body: 'Accelerated development and automated complex tasks using Copilot agents, Stubber, and LLM API integrations.', proof: '→ Integrated Gemini API here' },
          { icon: '⚙', title: 'Enterprise RPA & Blue Prism', body: 'Translated business requirements into technical SDDs and built robust RPA solutions handling enterprise logic.', proof: '→ COGENT Automation Team' },
          { icon: '🚀', title: 'Azure DevOps & CI/CD', body: 'Collaborated in Agile teams using Azure DevOps, managing version control, CI/CD pipelines, and C# ABP Framework backend tasks.', proof: '→ COGENT DevOps Team' },
          { icon: '🧠', title: 'Machine Learning', body: 'Trained in regression, classification trees, SVMs, and neural networks. I know how to preprocess data and evaluate models correctly.', proof: '→ ML Lab (Regression/Classification)' },
          { icon: '📋', title: 'Systems Planning & PDDs', body: 'Gathered client requirements, mapped business processes, and wrote detailed Process Definition Documents (PDDs) before writing a single line of code.', proof: '→ COGENT Analyst Team' },
          { icon: '🔗', title: 'Full-Stack Integration', body: 'Seamlessly connect automated bots and AI models directly into scalable React/TypeScript and Java/C# backends.', proof: '→ Full-Stack Project Experience' },
        ],
        evidence: [
          { title: 'Enterprise Automation Lifecycle', body: 'Handled end-to-end automation from PDD gathering to SDD architecture to Blue Prism implementation' },
          { title: 'AI-Powered Job Matching', body: 'Developed an AI tool that matched job requirements with candidate profiles using NLP' },
          { title: 'League Patch Note Scraper', body: 'Built a Python script to scrape and parse complex patch note data into a consumable format' },
          { title: '3D E-Commerce Platform', body: 'Built PrintIt101 utilizing Three.js and Spring Boot, showcasing complex full-stack architecture' },
        ]
      },

      backend: {
        tag: 'BACKEND ENGINEER LENS',
        headline: 'I build APIs and systems<br>that don\'t break under pressure.',
        subline: `Give me a complex backend problem — a slow query, a traffic spike, a race condition — and I\'ll <strong>diagnose it, architect a fix, and ship it</strong>. That\'s the kind of engineer this arcade proves I am.`,
        cards: [
          { icon: '⚖', title: 'Load Balancing & Scaling', body: 'Designed round-robin load balancers in Java. Understand horizontal vs vertical scaling tradeoffs, sticky sessions, and connection draining.', proof: '→ Playable in System Realm' },
          { icon: '🗄', title: 'Database Optimisation', body: 'Indexing strategies, N+1 elimination, query plan analysis, read replicas, sharding patterns. Can turn a 1200ms query into 2ms.', proof: '→ 5 boss fights in DB Dungeon' },
          { icon: '📬', title: 'Async Architecture', body: 'Message queues, async workers, backpressure handling. Understands when to decouple writes from reads and why.', proof: '→ Queue node in System Realm' },
          { icon: '🔐', title: 'Production Thinking', body: 'CI/CD pipelines, canary deploys, rollback strategies, monitoring. Doesn\'t treat "works on my machine" as a finish line.', proof: '→ DevOps Arena pipeline builder' },
          { icon: '☕', title: 'Java', body: 'OOP, collections, concurrency, JDBC, HTTP servers. Wrote the LoadBalancer and ConnectionPool from scratch.', proof: '→ View Code in System Realm' },
          { icon: '🐍', title: 'Python', body: 'Flask/FastAPI patterns, psycopg2, Redis integration, benchmarking scripts. Comfortable with both scripting and backend service work.', proof: '→ View Code in DB Dungeon' },
        ],
        evidence: [
          { title: 'Diagnosed query bottlenecks', body: 'Benchmarked before/after index creation: 1200ms → 2ms on 847K row table' },
          { title: 'Built connection pooling', body: 'Java ConnectionPool with blocking queue, acquire/release lifecycle, configurable pool size' },
          { title: 'Implemented caching patterns', body: 'Cache-aside in Python with Redis, TTL management, decorator pattern for clean DX' },
          { title: 'Wrote CI/CD pipelines', body: 'Bash pipeline with lint → test → build → canary → prod with auto-rollback on error rate' },
        ]
      },
      fullstack: {
        tag: 'FULL STACK ENGINEER LENS',
        headline: 'I build the whole thing —<br>from database query to what you see on screen.',
        subline: `I don\'t hand off at the API boundary. I own the data model, the service layer, and the interface. <strong>Systems thinking applied end-to-end</strong> — that\'s the differentiator.`,
        cards: [
          { icon: '🎨', title: 'Canvas & Creative UI', body: 'Built a full RPG engine on the HTML5 Canvas API from scratch. Character movement, collision detection, interactive zone triggers, achievement systems.', proof: '→ The site you\'re on right now' },
          { icon: '⚡', title: 'Vanilla JS & DOM Mastery', body: 'No framework crutches. Custom animation loops, drag-and-drop, real-time metric rendering, CSS variable theming — all hand-rolled.', proof: '→ All 6 realms in this arcade' },
          { icon: '⚙', title: 'Backend Architecture', body: 'REST APIs, database design, caching, async processing. Can design a system end-to-end and reason about where each piece lives.', proof: '→ System Realm + DB Dungeon' },
          { icon: '🤖', title: 'AI Integration', body: 'Integrated Gemini API with context-aware prompting, mode switching, and live realm state injection. The Oracle chatbot adapts to where you are.', proof: '→ Press 🔮 bottom-right' },
          { icon: '📐', title: 'System Design Thinking', body: 'Approaches every feature asking: how does this scale, where does it break, what\'s the bottleneck? That thinking shows in every realm here.', proof: '→ Entire arcade architecture' },
          { icon: '🚀', title: 'Deployment & DevOps', body: 'Docker, bash pipelines, canary deployments. Ships code that\'s production-aware from day one.', proof: '→ DevOps Arena' },
        ],
        evidence: [
          { title: 'Built end-to-end interactive system', body: 'Canvas engine + simulation logic + real-time metrics + AI chatbot — all in one cohesive product' },
          { title: 'State management without a framework', body: 'All realm state, XP tracking, drawer logic, and UI transitions built with vanilla JS and clean separation' },
          { title: 'Context-aware AI integration', body: 'Gemini chatbot knows which realm you\'re in and adjusts its persona (Explain / Interview / Advisor)' },
          { title: 'Pixel-perfect dark system UI', body: 'Custom CSS variables, animated particles, warp tunnel transition, scanline effects, custom cursor' },
        ]
      },
      ml: {
        tag: 'ML ENGINEER LENS',
        headline: 'I understand the math,<br>the pipeline, and what actually ships.',
        subline: `ML work that never leaves a Jupyter notebook is a hobby. I build <strong>pipelines that run in production</strong>, understand tradeoffs between models, and can explain every decision in an interview.`,
        cards: [
          { icon: '📈', title: 'Supervised Learning', body: 'Linear/polynomial regression, SVM, decision trees, random forests, KNN. Understands bias-variance tradeoff from first principles — not just definitions.', proof: '→ Regression + Classification Arena' },
          { icon: '🔵', title: 'Unsupervised Learning', body: 'K-Means, hierarchical clustering, DBSCAN. Knows when K is too high, how silhouette scores work, and what over-segmentation looks like.', proof: '→ Clustering Zone in ML Lab' },
          { icon: '🎰', title: 'Reinforcement Learning', body: 'Multi-armed bandit problem, UCB1, Thompson Sampling. Understands exploration-exploitation tradeoff and Bayesian posterior sampling.', proof: '→ RL Arena — rare in junior portfolios' },
          { icon: '🧬', title: 'Neural Networks', body: 'Architecture tuning, batch normalisation, dropout regularisation, CNN advantages for vision. Knows why deeper ≠ better without regularisation.', proof: '→ Neural Net Lab in ML Lab' },
          { icon: '🔧', title: 'sklearn Pipelines', body: 'End-to-end pipelines: imputation → scaling → model → GridSearchCV. Wrote cross-validation model comparison from scratch.', proof: '→ View Code in ML Lab' },
          { icon: '📊', title: 'Evaluation & Analysis', body: 'F1, precision/recall, confusion matrices, R², silhouette scores, RMSE. Doesn\'t just report accuracy — reports the right metric for the problem.', proof: '→ Model Stats panel in ML Lab' },
        ],
        evidence: [
          { title: 'Demonstrated overfitting live', body: 'Polynomial d=8: train R² 0.99 vs test R² 0.61 — bias-variance tradeoff made visible and interactive' },
          { title: 'Implemented RL from scratch', body: 'Thompson Sampling and UCB1 in Python — rare at junior level, proven in the RL Arena' },
          { title: 'Full sklearn pipeline with GridSearchCV', body: 'Preprocessing → model → hyperparameter tuning → cross-validation, all in production-ready pipeline code' },
          { title: 'ML knowledge is playable', body: 'Every algorithm in the ML Lab has real accuracy numbers, real insights, and real code behind the "Run" button' },
        ]
      }
    };

    let hireMode = 'backend';

    function setHireMode(mode) {
      hireMode = mode;
      document.querySelectorAll('.hire-toggle').forEach(b => b.classList.remove('active'));
      $('toggle-' + mode)?.classList.add('active');
      renderHireContent();
    }

    function renderHireContent() {
      const m = HIRE_MODES[hireMode];
      const cardsHtml = m.cards.map(c => `
    <div class="hire-card">
      <div class="hire-card-icon">${c.icon}</div>
      <div class="hire-card-title">${c.title}</div>
      <div class="hire-card-body">
        ${c.body}
        <span class="proof">${c.proof}</span>
      </div>
    </div>
  `).join('');

      const evidenceHtml = m.evidence.map(e => `
    <div class="evidence-item">
      <span class="evidence-check">✓</span>
      <div class="evidence-text">
        <strong>${e.title}</strong>
        ${e.body}
      </div>
    </div>
  `).join('');

      $('hire-content').innerHTML = `
    <div style="margin-bottom:2rem">
      <div class="hire-mode-tag">${m.tag}</div>
      <div class="hire-headline">${m.headline}</div>
      <div class="hire-subline">${m.subline}</div>
    </div>

    <div style="font-family:'Cinzel',serif;font-size:0.7rem;letter-spacing:0.2em;color:var(--crimson);margin-bottom:1rem">WHAT I BRING</div>
    <div class="hire-grid">${cardsHtml}</div>

    <div style="font-family:'Cinzel',serif;font-size:0.7rem;letter-spacing:0.2em;color:var(--crimson);margin-bottom:1rem">PROOF POINTS</div>
    <div class="hire-evidence">${evidenceHtml}</div>

    <div class="hire-cta">
      <a href="mailto:zakhirmckinnon2016@gmail.com" class="hire-cta-btn">✉ GET IN TOUCH</a>
      <a href="https://www.linkedin.com/in/zakhir-mckinnon-ba20ab300" target="_blank" class="hire-cta-btn">💼 LINKEDIN</a>
      <a href="https://github.com/flyinginsectsunpig" target="_blank" class="hire-cta-btn">⌥ GITHUB</a>
      <span class="hire-cta-note">// Available for full-time roles · Open to remote</span>
    </div>
  `;
    }

    function initHireRealm() {
      hireMode = 'backend';
      document.querySelectorAll('.hire-toggle').forEach(b => b.classList.remove('active'));
      $('toggle-backend')?.classList.add('active');
      renderHireContent();
    }

    const CODE_SNIPPETS = {
      system: [
        {
          tab: 'LoadBalancer.java',
          lang: 'java',
          title: 'Load Balancer (Java)',
          desc: 'Round-robin load balancer implemented in Java. Distributes requests across a pool of backend servers, tracking health and connection counts.',
          stack: ['java'],
          code: `<span class="cm">// LoadBalancer.java — Round-Robin implementation</span>
<span class="kw">import</span> java.util.*;
<span class="kw">import</span> java.util.concurrent.atomic.AtomicInteger;

<span class="kw">public class</span> <span class="cls">LoadBalancer</span> {
    <span class="kw">private final</span> List&lt;<span class="cls">ServerNode</span>&gt; nodes;
    <span class="kw">private final</span> AtomicInteger counter = <span class="kw">new</span> AtomicInteger(<span class="num">0</span>);

    <span class="kw">public</span> <span class="fn">LoadBalancer</span>(List&lt;<span class="cls">ServerNode</span>&gt; nodes) {
        this.nodes = nodes;
    }

    <span class="kw">public</span> <span class="cls">ServerNode</span> <span class="fn">getNext</span>() {
        List&lt;<span class="cls">ServerNode</span>&gt; healthy = nodes.stream()
            .filter(<span class="cls">ServerNode</span>::isHealthy)
            .toList();
        <span class="kw">if</span> (healthy.isEmpty()) <span class="kw">throw new</span> <span class="cls">RuntimeException</span>(<span class="str">"No healthy nodes"</span>);
        <span class="kw">int</span> idx = counter.getAndIncrement() % healthy.size();
        <span class="kw">return</span> healthy.get(idx);
    }

    <span class="kw">public void</span> <span class="fn">routeRequest</span>(<span class="cls">HttpRequest</span> req) {
        <span class="cls">ServerNode</span> target = <span class="fn">getNext</span>();
        target.<span class="fn">handle</span>(req);
    }
}`
        },
        {
          tab: 'cache_layer.py',
          lang: 'python',
          title: 'Redis Cache Layer (Python)',
          desc: 'Python cache-aside pattern implementation using Redis. Checks cache before DB, handles TTL and cache invalidation.',
          stack: ['python'],
          code: `<span class="cm"># cache_layer.py — Cache-aside pattern with Redis</span>
<span class="kw">import</span> redis
<span class="kw">import</span> json
<span class="kw">from</span> functools <span class="kw">import</span> wraps

r = redis.<span class="cls">Redis</span>(host=<span class="str">'localhost'</span>, port=<span class="num">6379</span>)

<span class="kw">def</span> <span class="fn">cached</span>(ttl=<span class="num">300</span>):
    <span class="kw">def</span> <span class="fn">decorator</span>(func):
        <span class="dec">@wraps</span>(func)
        <span class="kw">def</span> <span class="fn">wrapper</span>(*args, **kwargs):
            key = <span class="str">f"cache:{func.__name__}:{args}:{kwargs}"</span>
            cached_val = r.<span class="fn">get</span>(key)
            <span class="kw">if</span> cached_val:
                <span class="kw">return</span> json.<span class="fn">loads</span>(cached_val)
            result = <span class="fn">func</span>(*args, **kwargs)
            r.<span class="fn">setex</span>(key, ttl, json.<span class="fn">dumps</span>(result))
            <span class="kw">return</span> result
        <span class="kw">return</span> wrapper
    <span class="kw">return</span> decorator

<span class="dec">@cached</span>(ttl=<span class="num">60</span>)
<span class="kw">def</span> <span class="fn">get_user</span>(user_id: int) -> dict:
    <span class="cm"># Without cache: ~200ms DB query</span>
    <span class="cm"># With cache:    ~2ms Redis lookup</span>
    <span class="kw">return</span> db.<span class="fn">query</span>(<span class="str">f"SELECT * FROM users WHERE id = {user_id}"</span>)`
        }
      ],
      database: [
        {
          tab: 'indexing.sql',
          lang: 'sql',
          title: 'Index Optimization (SQL)',
          desc: 'Real PostgreSQL index strategies used in the DB Dungeon bosses. Shows B-tree, composite, and partial indexes with EXPLAIN output.',
          stack: ['sql'],
          code: `<span class="cm">-- indexing.sql — Index strategies demonstrated in DB Dungeon</span>

<span class="cm">-- BOSS 1: Full table scan — 1200ms without index</span>
<span class="kw">EXPLAIN ANALYZE</span>
<span class="kw">SELECT</span> * <span class="kw">FROM</span> users <span class="kw">WHERE</span> email = <span class="str">'user@test.com'</span>;
<span class="cm">-- Seq Scan on users  (cost=0.00..18450.00 rows=1)
--   Execution Time: 1204.321 ms</span>

<span class="cm">-- FIX: Create B-tree index</span>
<span class="kw">CREATE INDEX CONCURRENTLY</span> idx_users_email
    <span class="kw">ON</span> users(email);

<span class="cm">-- After index: 2ms</span>
<span class="cm">-- Index Scan using idx_users_email
--   Execution Time: 2.041 ms  ✅</span>

<span class="cm">-- BOSS 3: Cartesian explosion fix</span>
<span class="cm">-- BAD: Missing join condition</span>
<span class="kw">SELECT</span> * <span class="kw">FROM</span> orders o
<span class="kw">JOIN</span> order_items oi <span class="kw">ON</span> o.id = oi.order_id  <span class="cm">-- ✅ this was missing</span>
<span class="kw">JOIN</span> products p    <span class="kw">ON</span> oi.product_id = p.id;

<span class="cm">-- BOSS 5: Composite index for analytics</span>
<span class="kw">CREATE INDEX</span> idx_orders_analytics
    <span class="kw">ON</span> orders(user_id, created_at <span class="kw">DESC</span>)
    <span class="kw">WHERE</span> status = <span class="str">'completed'</span>;  <span class="cm">-- partial index</span>`
        },
        {
          tab: 'QueryOptimizer.java',
          lang: 'java',
          title: 'Query Optimizer (Java)',
          desc: 'Java implementation of N+1 query detection and batch loading using JDBC. Shows how ORMs fix N+1 at the framework level.',
          stack: ['java', 'sql'],
          code: `<span class="cm">// QueryOptimizer.java — Fix N+1 with batched queries</span>
<span class="kw">public class</span> <span class="cls">UserOrderRepository</span> {

    <span class="cm">// ❌ BAD: N+1 problem — 101 queries for 100 users</span>
    <span class="kw">public</span> List&lt;<span class="cls">UserWithOrders</span>&gt; <span class="fn">loadNaive</span>() {
        List&lt;<span class="cls">User</span>&gt; users = <span class="fn">executeQuery</span>(<span class="str">"SELECT * FROM users"</span>);
        <span class="kw">for</span> (<span class="cls">User</span> u : users) {
            u.orders = <span class="fn">executeQuery</span>(
                <span class="str">"SELECT * FROM orders WHERE user_id = "</span> + u.id
            ); <span class="cm">// 100 extra queries!</span>
        }
        <span class="kw">return</span> users;
    }

    <span class="cm">// ✅ GOOD: Single JOIN — 1 query</span>
    <span class="kw">public</span> List&lt;<span class="cls">UserWithOrders</span>&gt; <span class="fn">loadOptimized</span>() {
        <span class="cls">String</span> sql = <span class="str">"""
            SELECT u.id, u.name, o.id AS order_id, o.total
            FROM users u
            LEFT JOIN orders o ON u.id = o.user_id
            ORDER BY u.id
        """</span>;
        <span class="kw">return</span> <span class="fn">executeQuery</span>(sql);
    }
}`
        },
        {
          tab: 'db_bench.py',
          lang: 'python',
          title: 'DB Benchmarking (Python)',
          desc: 'Python script to benchmark query performance before and after optimizations. Uses psycopg2 and timing utilities.',
          stack: ['python', 'sql'],
          code: `<span class="cm"># db_bench.py — Query performance benchmarking</span>
<span class="kw">import</span> psycopg2, time, statistics

<span class="kw">def</span> <span class="fn">benchmark</span>(query: str, runs: int = <span class="num">50</span>) -> dict:
    conn = psycopg2.<span class="fn">connect</span>(<span class="str">"dbname=testdb user=postgres"</span>)
    cur = conn.<span class="fn">cursor</span>()
    times = []
    <span class="kw">for</span> _ <span class="kw">in range</span>(runs):
        start = time.<span class="fn">perf_counter</span>()
        cur.<span class="fn">execute</span>(query)
        cur.<span class="fn">fetchall</span>()
        times.<span class="fn">append</span>((time.<span class="fn">perf_counter</span>() - start) * <span class="num">1000</span>)
    <span class="kw">return</span> {
        <span class="str">'mean_ms'</span>: statistics.<span class="fn">mean</span>(times),
        <span class="str">'p95_ms'</span>:  sorted(times)[<span class="kw">int</span>(runs * <span class="num">0.95</span>)],
        <span class="str">'min_ms'</span>:  <span class="fn">min</span>(times)
    }

before = <span class="fn">benchmark</span>(<span class="str">"SELECT * FROM users WHERE email='a@b.com'"</span>)
<span class="cm"># {'mean_ms': 1204.3, 'p95_ms': 1350.1, 'min_ms': 1180.2}</span>
<span class="cm"># → CREATE INDEX idx_users_email ON users(email);</span>
after = <span class="fn">benchmark</span>(<span class="str">"SELECT * FROM users WHERE email='a@b.com'"</span>)
<span class="cm"># {'mean_ms': 1.9,  'p95_ms': 2.4,    'min_ms': 1.7}  ✅</span>`
        }
      ],
      ml: [
        {
          tab: 'regression.py',
          lang: 'python',
          title: 'Regression Models (Python)',
          desc: 'Python implementation of all regression algorithms in the ML Lab. Uses scikit-learn with bias-variance analysis.',
          stack: ['python', 'sklearn', 'numpy'],
          code: `<span class="cm"># regression.py — All regression models from ML Lab</span>
<span class="kw">import</span> numpy <span class="kw">as</span> np
<span class="kw">from</span> sklearn.linear_model <span class="kw">import</span> LinearRegression
<span class="kw">from</span> sklearn.preprocessing <span class="kw">import</span> PolynomialFeatures
<span class="kw">from</span> sklearn.pipeline <span class="kw">import</span> Pipeline
<span class="kw">from</span> sklearn.ensemble <span class="kw">import</span> RandomForestRegressor
<span class="kw">from</span> sklearn.model_selection <span class="kw">import</span> cross_val_score

X_train, X_test, y_train, y_test = <span class="fn">train_test_split</span>(X, y, test_size=<span class="num">0.2</span>)

<span class="cm"># Degree-8 polynomial: OVERFIT example</span>
overfit_model = <span class="cls">Pipeline</span>([
    (<span class="str">'poly'</span>, <span class="cls">PolynomialFeatures</span>(degree=<span class="num">8</span>)),
    (<span class="str">'reg'</span>,  <span class="cls">LinearRegression</span>())
])
overfit_model.<span class="fn">fit</span>(X_train, y_train)
<span class="kw">print</span>(<span class="str">f"Train R²: {overfit_model.score(X_train, y_train):.3f}"</span>)  <span class="cm"># 0.99</span>
<span class="kw">print</span>(<span class="str">f"Test  R²: {overfit_model.score(X_test, y_test):.3f}"</span>)   <span class="cm"># 0.61 ⚠ overfit</span>

<span class="cm"># Random Forest: best generalisation</span>
rf = <span class="cls">RandomForestRegressor</span>(n_estimators=<span class="num">100</span>, max_depth=<span class="num">8</span>)
cv_scores = <span class="fn">cross_val_score</span>(rf, X, y, cv=<span class="num">5</span>, scoring=<span class="str">'r2'</span>)
<span class="kw">print</span>(<span class="str">f"CV R²:    {cv_scores.mean():.3f} ± {cv_scores.std():.3f}"</span>) <span class="cm"># 0.91 ✅</span>`
        },
        {
          tab: 'classification.py',
          lang: 'python',
          title: 'Classification (Python)',
          desc: 'SVM, KNN, and Random Forest classifiers with confusion matrix output and F1 optimization — exactly what runs in the Classification Arena.',
          stack: ['python', 'sklearn'],
          code: `<span class="cm"># classification.py — Arena classifiers + evaluation</span>
<span class="kw">from</span> sklearn.svm <span class="kw">import</span> SVC
<span class="kw">from</span> sklearn.metrics <span class="kw">import</span> (classification_report,
                               confusion_matrix, f1_score)
<span class="kw">from</span> sklearn.preprocessing <span class="kw">import</span> StandardScaler

<span class="cm"># Scale features (critical for SVM & KNN)</span>
scaler = <span class="cls">StandardScaler</span>()
X_train_s = scaler.<span class="fn">fit_transform</span>(X_train)
X_test_s  = scaler.<span class="fn">transform</span>(X_test)

<span class="cm"># SVM with RBF kernel — best in class</span>
svm = <span class="cls">SVC</span>(kernel=<span class="str">'rbf'</span>, C=<span class="num">1.0</span>, gamma=<span class="str">'scale'</span>, probability=<span class="kw">True</span>)
svm.<span class="fn">fit</span>(X_train_s, y_train)
y_pred = svm.<span class="fn">predict</span>(X_test_s)

f1 = <span class="fn">f1_score</span>(y_test, y_pred, average=<span class="str">'weighted'</span>)
<span class="kw">print</span>(<span class="str">f"F1 Score: {f1:.3f}"</span>)  <span class="cm"># 0.930 ✅</span>
<span class="kw">print</span>(<span class="fn">classification_report</span>(y_test, y_pred))
<span class="kw">print</span>(<span class="fn">confusion_matrix</span>(y_test, y_pred))`
        },
        {
          tab: 'rl_bandit.py',
          lang: 'python',
          title: 'RL: Multi-Armed Bandit (Python)',
          desc: 'Thompson Sampling and UCB1 implementations for the Reinforcement Learning Arena. Demonstrates exploration-exploitation tradeoff.',
          stack: ['python', 'numpy'],
          code: `<span class="cm"># rl_bandit.py — Multi-armed bandit algorithms</span>
<span class="kw">import</span> numpy <span class="kw">as</span> np

<span class="kw">class</span> <span class="cls">ThompsonSampling</span>:
    <span class="cm">"""Bayesian exploration — best performer in RL Arena"""</span>
    <span class="kw">def</span> <span class="fn">__init__</span>(self, n_arms):
        self.alpha = np.<span class="fn">ones</span>(n_arms)   <span class="cm"># successes + 1</span>
        self.beta  = np.<span class="fn">ones</span>(n_arms)   <span class="cm"># failures + 1</span>

    <span class="kw">def</span> <span class="fn">select_arm</span>(self) -> int:
        samples = np.random.<span class="fn">beta</span>(self.alpha, self.beta)
        <span class="kw">return</span> int(np.<span class="fn">argmax</span>(samples))

    <span class="kw">def</span> <span class="fn">update</span>(self, arm: int, reward: int):
        self.alpha[arm] += reward
        self.beta[arm]  += (<span class="num">1</span> - reward)

<span class="kw">class</span> <span class="cls">UCB1</span>:
    <span class="cm">"""Upper Confidence Bound — provably near-optimal"""</span>
    <span class="kw">def</span> <span class="fn">__init__</span>(self, n_arms):
        self.counts  = np.<span class="fn">zeros</span>(n_arms)
        self.rewards = np.<span class="fn">zeros</span>(n_arms)
        self.t = <span class="num">0</span>

    <span class="kw">def</span> <span class="fn">select_arm</span>(self) -> int:
        self.t += <span class="num">1</span>
        ucb = self.rewards + np.<span class="fn">sqrt</span>(
            <span class="num">2</span> * np.<span class="fn">log</span>(self.t) / (self.counts + <span class="num">1e-5</span>)
        )
        <span class="kw">return</span> int(np.<span class="fn">argmax</span>(ucb))`
        }
      ],
      devops: [
        {
          tab: 'pipeline.sh',
          lang: 'bash',
          title: 'CI/CD Pipeline (Bash)',
          desc: 'Bash pipeline script that mirrors the DevOps Arena. Each stage runs, checks exit code, and fails fast on errors.',
          stack: ['bash', 'docker'],
          code: `<span class="cm">#!/bin/bash
# pipeline.sh — CI/CD pipeline mirroring the DevOps Arena</span>
<span class="kw">set</span> -eo pipefail

<span class="fn">log</span>() { echo <span class="str">"[$(date +%H:%M:%S)] $1"</span>; }
<span class="fn">stage</span>() { echo; echo <span class="str">"━━━ $1 ━━━"</span>; }

<span class="fn">stage</span> <span class="str">"SOURCE CHECKOUT"</span>
git <span class="fn">fetch</span> origin main && git <span class="fn">checkout</span> main

<span class="fn">stage</span> <span class="str">"LINT"</span>
<span class="fn">flake8</span> src/ --max-line-length=<span class="num">100</span>
<span class="fn">log</span> <span class="str">"✅ Lint passed"</span>

<span class="fn">stage</span> <span class="str">"UNIT TESTS"</span>
<span class="fn">pytest</span> tests/unit/ --cov=src --cov-fail-under=<span class="num">80</span>
<span class="fn">log</span> <span class="str">"✅ Coverage > 80%"</span>

<span class="fn">stage</span> <span class="str">"BUILD & DOCKERIZE"</span>
docker <span class="fn">build</span> -t app:<span class="str">"$GIT_SHA"</span> .
docker <span class="fn">push</span> registry/app:<span class="str">"$GIT_SHA"</span>

<span class="fn">stage</span> <span class="str">"CANARY DEPLOY (10%)"</span>
kubectl <span class="fn">set</span> image deployment/app-canary app=app:<span class="str">"$GIT_SHA"</span>
sleep <span class="num">30</span>
ERROR_RATE=$(<span class="fn">curl</span> -s metrics/canary/error_rate)
<span class="kw">if</span> (( <span class="fn">$(echo "$ERROR_RATE > 0.01" | bc -l)</span> )); <span class="kw">then</span>
    <span class="fn">log</span> <span class="str">"❌ Canary error rate high — rolling back"</span>
    kubectl <span class="fn">rollout</span> undo deployment/app-canary; exit <span class="num">1</span>
<span class="kw">fi</span>

<span class="fn">stage</span> <span class="str">"FULL PRODUCTION DEPLOY"</span>
kubectl <span class="fn">set</span> image deployment/app app=app:<span class="str">"$GIT_SHA"</span>
<span class="fn">log</span> <span class="str">"🚀 Deployed successfully"</span>`
        },
        {
          tab: 'Dockerfile',
          lang: 'docker',
          title: 'Dockerfile',
          desc: 'Multi-stage Docker build for a Python backend — minimizes final image size and uses non-root user for security.',
          stack: ['docker', 'bash'],
          code: `<span class="cm"># Dockerfile — Multi-stage production build</span>

<span class="cm"># Stage 1: Build dependencies</span>
<span class="kw">FROM</span> python:<span class="str">3.12-slim</span> <span class="kw">AS</span> builder
<span class="kw">WORKDIR</span> /build
<span class="kw">COPY</span> requirements.txt .
<span class="kw">RUN</span> pip install --user --no-cache-dir -r requirements.txt

<span class="cm"># Stage 2: Runtime — no build tools, smaller attack surface</span>
<span class="kw">FROM</span> python:<span class="str">3.12-slim</span>
<span class="kw">WORKDIR</span> /app

<span class="cm"># Non-root user for security</span>
<span class="kw">RUN</span> useradd --uid <span class="num">1000</span> --no-create-home appuser

<span class="cm"># Copy only installed packages from builder</span>
<span class="kw">COPY</span> --from=builder /root/.local /home/appuser/.local
<span class="kw">COPY</span> --chown=appuser:appuser src/ .

<span class="kw">USER</span> appuser
<span class="kw">EXPOSE</span> <span class="num">8000</span>
<span class="kw">HEALTHCHECK</span> --interval=30s --timeout=3s \
    <span class="kw">CMD</span> curl -f http://localhost:8000/health || exit 1

<span class="cm"># Graceful shutdown supported</span>
<span class="kw">CMD</span> [<span class="str">"python"</span>, <span class="str">"-m"</span>, <span class="str">"uvicorn"</span>, <span class="str">"main:app"</span>, \
     <span class="str">"--host"</span>, <span class="str">"0.0.0.0"</span>, <span class="str">"--port"</span>, <span class="str">"8000"</span>]`
        }
      ]
    };

    let codeDrawerRealm = null;
    let codeTabIdx = 0;

    function openCodeDrawer(realm) {
      codeDrawerRealm = realm;
      codeTabIdx = 0;
      renderCodeDrawer();
      $('code-drawer').classList.add('open');
    }

    function closeCodeDrawer() {
      $('code-drawer').classList.remove('open');
    }

    function renderCodeDrawer() {
      const snippets = CODE_SNIPPETS[codeDrawerRealm];
      if (!snippets) return;

      // Tabs
      $('code-tabs').innerHTML = snippets.map((s, i) =>
        `<button class="code-tab ${i === codeTabIdx ? 'active' : ''}" onclick="switchCodeTab(${i})">${s.tab}</button>`
      ).join('');

      const s = snippets[codeTabIdx];

      // Info panel
      const stackBadges = s.stack.map(t => `<span class="tech-badge ${t}">${t}</span>`).join('');
      $('code-info').innerHTML = `
    <h4>${s.title}</h4>
    <p>${s.desc}</p>
    <div class="stack-row">${stackBadges}</div>
    <div style="font-family:'Share Tech Mono',monospace;font-size:0.55rem;color:var(--blood);letter-spacing:0.08em;margin-top:0.5rem">
      // This is the actual implementation behind the ${codeDrawerRealm} realm
    </div>
  `;

      $('code-area').innerHTML = s.code;
    }

    function switchCodeTab(idx) {
      codeTabIdx = idx;
      renderCodeDrawer();
    }

    // ═══════════════════════════════════════
    // PROJECTS CODE VIEWER
    // ═══════════════════════════════════════
    const PROJECT_CODE = [
      {
        tabs: ['canvas_engine.js', 'zone_system.py'],
        info: {
          title: 'RPG Portfolio Engine',
          desc: 'Canvas-based RPG world. Character movement uses requestAnimationFrame with grid collision detection. Zone proximity triggers interactive modals.',
          stack: ['js', 'canvas', 'python']
        },
        snippets: [
          `<span class="cm">// canvas_engine.js — Character movement + collision</span>
<span class="kw">const</span> TILE = <span class="num">32</span>;
<span class="kw">const</span> player = { x: <span class="num">5</span>, y: <span class="num">5</span>, speed: <span class="num">0.15</span> };

<span class="kw">function</span> <span class="fn">gameLoop</span>(ts) {
  ctx.<span class="fn">clearRect</span>(<span class="num">0</span>, <span class="num">0</span>, canvas.width, canvas.height);
  <span class="fn">drawMap</span>();

  <span class="kw">if</span> (keys.ArrowUp && !<span class="fn">isBlocked</span>(player.x, player.y - player.speed))
    player.y -= player.speed;
  <span class="kw">if</span> (keys.ArrowDown && !<span class="fn">isBlocked</span>(player.x, player.y + player.speed))
    player.y += player.speed;

  <span class="fn">checkZoneProximity</span>(player);
  <span class="fn">drawPlayer</span>(player.x * TILE, player.y * TILE);
  requestAnimationFrame(gameLoop);
}

<span class="kw">function</span> <span class="fn">isBlocked</span>(x, y) {
  <span class="kw">const</span> tile = MAP[<span class="fn">Math.floor</span>(y)][<span class="fn">Math.floor</span>(x)];
  <span class="kw">return</span> tile === <span class="num">1</span>; <span class="cm">// 1 = wall</span>
}`,
          `<span class="cm"># zone_system.py — Generates zone data loaded by the canvas engine</span>
<span class="kw">from</span> dataclasses <span class="kw">import</span> dataclass
<span class="kw">from</span> typing <span class="kw">import</span> List
<span class="kw">import</span> json

<span class="dec">@dataclass</span>
<span class="kw">class</span> <span class="cls">Zone</span>:
    name: str
    x: int; y: int
    width: int; height: int
    modal_type: str
    unlock_xp: int = <span class="num">0</span>

zones: List[<span class="cls">Zone</span>] = [
    <span class="cls">Zone</span>(<span class="str">"ML Lab"</span>,      <span class="num">8</span>,  <span class="num">3</span>,  <span class="num">5</span>, <span class="num">4</span>, <span class="str">"regression"</span>),
    <span class="cls">Zone</span>(<span class="str">"DB Dungeon"</span>,  <span class="num">16</span>, <span class="num">8</span>,  <span class="num">4</span>, <span class="num">4</span>, <span class="str">"sql_boss"</span>),
    <span class="cls">Zone</span>(<span class="str">"DevOps Bay"</span>,  <span class="num">4</span>,  <span class="num">14</span>, <span class="num">6</span>, <span class="num">3</span>, <span class="str">"pipeline"</span>),
]

<span class="kw">with</span> <span class="fn">open</span>(<span class="str">'zones.json'</span>, <span class="str">'w'</span>) <span class="kw">as</span> f:
    json.<span class="fn">dump</span>([vars(z) <span class="kw">for</span> z <span class="kw">in</span> zones], f, indent=<span class="num">2</span>)`
        ]
      },
      {
        tabs: ['pipeline.py', 'model_select.py'],
        info: {
          title: 'ML Pipeline Project',
          desc: 'End-to-end ML pipeline. Data preprocessing through model selection and cross-validation. Mirrors exactly what you interact with in the ML Lab.',
          stack: ['python', 'sklearn', 'numpy']
        },
        snippets: [
          `<span class="cm"># pipeline.py — Full sklearn ML pipeline</span>
<span class="kw">from</span> sklearn.pipeline <span class="kw">import</span> Pipeline
<span class="kw">from</span> sklearn.preprocessing <span class="kw">import</span> StandardScaler, LabelEncoder
<span class="kw">from</span> sklearn.impute <span class="kw">import</span> SimpleImputer
<span class="kw">from</span> sklearn.ensemble <span class="kw">import</span> RandomForestClassifier
<span class="kw">from</span> sklearn.model_selection <span class="kw">import</span> GridSearchCV

preprocessor = Pipeline([
    (<span class="str">'impute'</span>,  <span class="cls">SimpleImputer</span>(strategy=<span class="str">'median'</span>)),
    (<span class="str">'scale'</span>,   <span class="cls">StandardScaler</span>()),
])

model = Pipeline([
    (<span class="str">'pre'</span>,   preprocessor),
    (<span class="str">'clf'</span>,   <span class="cls">RandomForestClassifier</span>(n_estimators=<span class="num">100</span>)),
])

param_grid = {
    <span class="str">'clf__max_depth'</span>:     [<span class="num">5</span>, <span class="num">10</span>, <span class="num">None</span>],
    <span class="str">'clf__n_estimators'</span>: [<span class="num">50</span>, <span class="num">100</span>, <span class="num">200</span>],
}
search = <span class="cls">GridSearchCV</span>(model, param_grid, cv=<span class="num">5</span>, scoring=<span class="str">'f1_weighted'</span>)
search.<span class="fn">fit</span>(X_train, y_train)
<span class="kw">print</span>(<span class="str">f"Best F1: {search.best_score_:.3f}"</span>)`,
          `<span class="cm"># model_select.py — Cross-validation model comparison</span>
<span class="kw">import</span> numpy <span class="kw">as</span> np
<span class="kw">from</span> sklearn.model_selection <span class="kw">import</span> cross_validate

models = {
    <span class="str">'Random Forest'</span>: <span class="cls">RandomForestClassifier</span>(),
    <span class="str">'SVM RBF'</span>:       <span class="cls">SVC</span>(kernel=<span class="str">'rbf'</span>),
    <span class="str">'Logistic Reg'</span>:  <span class="cls">LogisticRegression</span>(),
}

results = {}
<span class="kw">for</span> name, clf <span class="kw">in</span> models.<span class="fn">items</span>():
    cv = <span class="fn">cross_validate</span>(clf, X, y, cv=<span class="num">5</span>,
                        scoring=[<span class="str">'f1_weighted'</span>, <span class="str">'accuracy'</span>])
    results[name] = {
        <span class="str">'f1'</span>:  cv[<span class="str">'test_f1_weighted'</span>].<span class="fn">mean</span>(),
        <span class="str">'acc'</span>: cv[<span class="str">'test_accuracy'</span>].<span class="fn">mean</span>(),
    }
<span class="cm"># Random Forest → F1: 0.940  ✅
# SVM RBF       → F1: 0.928
# Logistic Reg  → F1: 0.883</span>`
        ]
      },
      {
        tabs: ['ApiServer.java', 'ConnectionPool.java'],
        info: {
          title: 'Backend API System',
          desc: 'Java REST API with PostgreSQL, JDBC connection pooling, and request routing. Implements the same patterns shown in the System Realm.',
          stack: ['java', 'sql', 'docker']
        },
        snippets: [
          `<span class="cm">// ApiServer.java — Lightweight HTTP server with routing</span>
<span class="kw">import</span> com.sun.net.httpserver.*;
<span class="kw">import</span> java.io.*;
<span class="kw">import</span> java.net.InetSocketAddress;

<span class="kw">public class</span> <span class="cls">ApiServer</span> {
    <span class="kw">private final</span> <span class="cls">HttpServer</span> server;
    <span class="kw">private final</span> <span class="cls">Router</span> router;

    <span class="kw">public</span> <span class="fn">ApiServer</span>(int port) <span class="kw">throws</span> <span class="cls">IOException</span> {
        server = <span class="cls">HttpServer</span>.<span class="fn">create</span>(<span class="kw">new</span> <span class="cls">InetSocketAddress</span>(port), <span class="num">0</span>);
        router = <span class="kw">new</span> <span class="cls">Router</span>();
        server.<span class="fn">createContext</span>(<span class="str">"/"</span>, exchange -> {
            <span class="cls">String</span> path   = exchange.getRequestURI().getPath();
            <span class="cls">String</span> method = exchange.getRequestMethod();
            router.<span class="fn">handle</span>(path, method, exchange);
        });
        server.<span class="fn">setExecutor</span>(<span class="cls">Executors</span>.<span class="fn">newVirtualThreadPerTaskExecutor</span>());
    }

    <span class="kw">public void</span> <span class="fn">start</span>() {
        server.<span class="fn">start</span>();
        <span class="cls">System</span>.out.<span class="fn">println</span>(<span class="str">"API server running on port "</span> + server.<span class="fn">getAddress</span>().getPort());
    }
}`,
          `<span class="cm">// ConnectionPool.java — JDBC connection pool</span>
<span class="kw">import</span> java.sql.*;
<span class="kw">import</span> java.util.concurrent.*;

<span class="kw">public class</span> <span class="cls">ConnectionPool</span> {
    <span class="kw">private final</span> BlockingQueue&lt;<span class="cls">Connection</span>&gt; pool;
    <span class="kw">private final int</span> MAX_SIZE = <span class="num">10</span>;

    <span class="kw">public</span> <span class="fn">ConnectionPool</span>(<span class="cls">String</span> url) <span class="kw">throws</span> <span class="cls">SQLException</span> {
        pool = <span class="kw">new</span> <span class="cls">ArrayBlockingQueue</span>&lt;&gt;(MAX_SIZE);
        <span class="kw">for</span> (<span class="kw">int</span> i = <span class="num">0</span>; i &lt; MAX_SIZE; i++)
            pool.<span class="fn">offer</span>(<span class="cls">DriverManager</span>.<span class="fn">getConnection</span>(url));
    }

    <span class="kw">public</span> <span class="cls">Connection</span> <span class="fn">acquire</span>() <span class="kw">throws</span> <span class="cls">InterruptedException</span> {
        <span class="kw">return</span> pool.<span class="fn">poll</span>(<span class="num">5</span>, <span class="cls">TimeUnit</span>.SECONDS);
    }

    <span class="kw">public void</span> <span class="fn">release</span>(<span class="cls">Connection</span> conn) {
        pool.<span class="fn">offer</span>(conn); <span class="cm">// return to pool</span>
    }
}`
        ]
      }
    ];

    function openProjectCode(idx) {
      const proj = PROJECT_CODE[idx];
      if (!proj) return;

      const tabsHtml = proj.tabs.map((t, i) =>
        `<button class="code-tab ${i === 0 ? 'active' : ''}" onclick="switchProjectCodeTab(${idx}, ${i}, this)">${t}</button>`
      ).join('');

      $('code-tabs').innerHTML = tabsHtml;

      const stackBadges = proj.info.stack.map(t => `<span class="tech-badge ${t}">${t}</span>`).join('');
      $('code-info').innerHTML = `
    <h4>${proj.info.title}</h4>
    <p>${proj.info.desc}</p>
    <div class="stack-row">${stackBadges}</div>
  `;
      $('code-area').innerHTML = proj.snippets[0];
      $('code-drawer').classList.add('open');
    }

    function switchProjectCodeTab(projIdx, tabIdx, btn) {
      document.querySelectorAll('.code-tab').forEach(t => t.classList.remove('active'));
      btn.classList.add('active');
      $('code-area').innerHTML = PROJECT_CODE[projIdx].snippets[tabIdx] || '';
    }


    // ═══════════════════════════════════════
    // SCROLL REVEAL ANIMATIONS
    // ═══════════════════════════════════════
    const revealObserver = new IntersectionObserver((entries, observer) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add("active");
          observer.unobserve(entry.target);
        }
      });
    }, { rootMargin: "0px 0px -50px 0px", threshold: 0.1 });

    function initReveals() {
      document.querySelectorAll(".reveal").forEach(el => revealObserver.observe(el));
    }
    // Initialize after a short delay to ensure DOM is ready
        // Watch for dynamically added .reveal elements
    const bodyObserver = new MutationObserver(mutations => {
      mutations.forEach(mut => {
        mut.addedNodes.forEach(node => {
          if (node.nodeType === 1) {
            if (node.classList && node.classList.contains('reveal')) revealObserver.observe(node);
            const reveals = node.querySelectorAll('.reveal');
            if (reveals && reveals.length) reveals.forEach(el => revealObserver.observe(el));
          }
        });
      });
    });
    bodyObserver.observe(document.body, { childList: true, subtree: true });
    
    // Initial run
    initReveals();

    // ═══════════════════════════════════════
    // KEYBOARD SHORTCUTS
    // ═══════════════════════════════════════
    document.addEventListener('keydown', e => {
      if (e.key === 'Escape' && currentScreen !== 'intro' && currentScreen !== 'card-select') {
        backToCards();
      }
      if (e.key === 'c' && currentScreen === 'realm-system') {
        clearConnecting();
      }
      if (e.key === '`') toggleChat();
    });

    // ═══════════════════════════════════════
    // WEBGL COSMIC NEURAL BACKGROUND ("WOW FACTOR")
    // ═══════════════════════════════════════
    function initWebGLBackground() {
      const canvas = $('webgl-bg');
      if (!canvas) return;

      const gl = canvas.getContext('webgl', { alpha: true });
      if (!gl) {
        console.warn("WebGL not supported, falling back to static background.");
        return;
      }

      // Vertex Shader: simply passing through coordinates
      const vsSource = `
        attribute vec2 position;
        varying vec2 vUv;
        void main() {
          vUv = position * 0.5 + 0.5;
          gl_Position = vec4(position, 0.0, 1.0);
        }
      `;

      // Fragment Shader: complex cosmic/neural fluid-like effect
      const fsSource = `
        precision highp float;
        varying vec2 vUv;
        uniform float uTime;
        uniform vec2 uResolution;
        uniform vec2 uMouse;

        // Psuedo-random noise function
        float random(vec2 st) {
            return fract(sin(dot(st.xy, vec2(12.9898,78.233))) * 43758.5453123);
        }

        // 2D Noise based on Morgan McGuire @morgan3d
        float noise(vec2 st) {
            vec2 i = floor(st);
            vec2 f = fract(st);

            // Four corners in 2D of a tile
            float a = random(i);
            float b = random(i + vec2(1.0, 0.0));
            float c = random(i + vec2(0.0, 1.0));
            float d = random(i + vec2(1.0, 1.0));

            vec2 u = f * f * (3.0 - 2.0 * f);

            return mix(a, b, u.x) + 
                   (c - a)* u.y * (1.0 - u.x) + 
                   (d - b) * u.x * u.y;
        }

        // Fractional Brownian Motion (fBm)
        #define OCTAVES 5
        float fbm(vec2 st) {
            float value = 0.0;
            float amplitude = 0.5;
            float frequency = 0.;
            for (int i = 0; i < OCTAVES; i++) {
                value += amplitude * noise(st);
                st *= 2.0;
                amplitude *= 0.5;
            }
            return value;
        }

        void main() {
            vec2 st = gl_FragCoord.xy / uResolution.xy;
            st.x *= uResolution.x / uResolution.y;

            vec2 mouse = uMouse / uResolution.xy;
            mouse.x *= uResolution.x / uResolution.y;

            vec3 color = vec3(0.0);

            // Fluid-like domain warping
            vec2 q = vec2(0.);
            q.x = fbm( st + 0.00 * uTime);
            q.y = fbm( st + vec2(1.0));

            vec2 r = vec2(0.);
            r.x = fbm( st + 1.0*q + vec2(1.7, 9.2) + 0.15*uTime );
            r.y = fbm( st + 1.0*q + vec2(8.3, 2.8) + 0.126*uTime );

            // Introduce mouse interaction
            float dist = distance(st, mouse);
            r += vec2(0.3 / (dist * 10.0 + 1.0)) * vec2(cos(uTime), sin(uTime));

            float f = fbm(st + r);

            // Color palette (Crimson, Deep Red, Dark Void)
            color = mix(vec3(0.05, 0.0, 0.0),
                        vec3(0.5, 0.0, 0.0),
                        clamp((f*f)*4.0, 0.0, 1.0));

            color = mix(color,
                        vec3(0.86, 0.08, 0.24), // Crimson highlights
                        clamp(length(q), 0.0, 1.0));

            color = mix(color,
                        vec3(1.0, 0.2, 0.2), // Bright core 
                        clamp(length(r.x), 0.0, 1.0));

            // Add subtle neural connection lines
            float network = noise(st * 10.0 + uTime * 0.5);
            network = smoothstep(0.45, 0.5, network) * smoothstep(0.55, 0.5, network);
            color += vec3(network * 0.3, network * 0.1, network * 0.1);
            
            // Mouse glow
            float glow = smoothstep(0.3, 0.0, dist);
            color += vec3(glow * 0.5, glow * 0.1, glow * 0.1);

            // Output with modulated opacity (keeps background visible)
            gl_FragColor = vec4((f*f*f + 0.6 * f*f + 0.5 * f) * color, 0.8 * f);
        }
      `;

      function compileShader(gl, source, type) {
        const shader = gl.createShader(type);
        gl.shaderSource(shader, source);
        gl.compileShader(shader);
        if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {
          console.error('An error occurred compiling the shaders: ' + gl.getShaderInfoLog(shader));
          gl.deleteShader(shader);
          return null;
        }
        return shader;
      }

      const vertexShader = compileShader(gl, vsSource, gl.VERTEX_SHADER);
      const fragmentShader = compileShader(gl, fsSource, gl.FRAGMENT_SHADER);

      const shaderProgram = gl.createProgram();
      gl.attachShader(shaderProgram, vertexShader);
      gl.attachShader(shaderProgram, fragmentShader);
      gl.linkProgram(shaderProgram);

      if (!gl.getProgramParameter(shaderProgram, gl.LINK_STATUS)) {
        console.error('Unable to initialize the shader program: ' + gl.getProgramInfoLog(shaderProgram));
        return;
      }

      gl.useProgram(shaderProgram);

      // Buffer setup
      const positionBuffer = gl.createBuffer();
      gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);
      const positions = [
        -1.0, 1.0,
        1.0, 1.0,
        -1.0, -1.0,
        1.0, -1.0,
      ];
      gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(positions), gl.STATIC_DRAW);

      const positionLocation = gl.getAttribLocation(shaderProgram, 'position');
      gl.enableVertexAttribArray(positionLocation);
      gl.vertexAttribPointer(positionLocation, 2, gl.FLOAT, false, 0, 0);

      const timeLocation = gl.getUniformLocation(shaderProgram, 'uTime');
      const resolutionLocation = gl.getUniformLocation(shaderProgram, 'uResolution');
      const mouseLocation = gl.getUniformLocation(shaderProgram, 'uMouse');

      const startTime = Date.now();
      let webglMouse = { x: 0, y: 0 };

      // Update mouse for webgl (with slight damping)
      document.addEventListener('mousemove', (e) => {
        webglMouse.x = e.clientX;
        // WebGL coordinates are usually Y-up, but since we map to screen, we invert Y usually or keep it relative
        webglMouse.y = window.innerHeight - e.clientY;
      });

      function render(time) {
        if (currentScreen !== 'card-select') {
          requestAnimationFrame(render);
          return;
        }

        const dpr = window.devicePixelRatio || 1;

        // Only resize if necessary to save performance
        const displayWidth = window.innerWidth;
        const displayHeight = window.innerHeight;

        if (canvas.width !== displayWidth * dpr || canvas.height !== displayHeight * dpr) {
          canvas.width = displayWidth * dpr;
          canvas.height = displayHeight * dpr;
          gl.viewport(0, 0, gl.drawingBufferWidth, gl.drawingBufferHeight);
        }

        const t = (Date.now() - startTime) / 1000.0;

        gl.uniform1f(timeLocation, t);
        gl.uniform2f(resolutionLocation, gl.canvas.width, gl.canvas.height);

        // Interpolate mouse for smoother shader reaction
        gl.uniform2f(mouseLocation, webglMouse.x * dpr, webglMouse.y * dpr);

        gl.clearColor(0.0, 0.0, 0.0, 0.0);
        gl.clear(gl.COLOR_BUFFER_BIT);

        // Blending for opacity
        gl.enable(gl.BLEND);
        gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);

        gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);

        requestAnimationFrame(render);
      }

      requestAnimationFrame(render);
    }

    // Initialize WebGL background
    setTimeout(initWebGLBackground, 500);

    function setMode(mode) {
      const recBtn = document.getElementById("btn-rec-mode");
      const arcBtn = document.getElementById("btn-arcade-mode");
      const recContainer = document.getElementById("recruiter-mode");
      
      if (mode === "recruiter") {
        recBtn.classList.add("active");
        arcBtn.classList.remove("active");
        recContainer.classList.remove("hidden");
      } else {
        arcBtn.classList.add("active");
        recBtn.classList.remove("active");
        recContainer.classList.add("hidden");
      }
    }
  </script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <script>
    lucide.createIcons();
  </script>
</body>
</html>
